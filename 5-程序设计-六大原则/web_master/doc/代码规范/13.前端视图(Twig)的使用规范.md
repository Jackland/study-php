# 13.前端视图(Twig)的使用规范

## 必要说明

twig 中的代码（html,css,js）的规范需要符合前端开发规范，以下规范不做相关说明

请先阅读以下文档，详细了解 twig 中的各种写法与支持

- [官方文档](https://twig.symfony.com/doc/2.x/templates.html)

- [支持的 Filters](https://twig.symfony.com/doc/2.x/filters/index.html)

- [支持的 Functions](https://twig.symfony.com/doc/2.x/functions/index.html)

- [非官方中文文档](https://www.kancloud.cn/yunye/twig-cn/159454)

## 当前项目相关的扩展说明

### 额外支持的扩展

支持的扩展见文件：`src/Components/TwigExtensions/ExtensionScanner.php`，可以通过该文件，参考其他已有的 extension 的写法扩展其他方法等

简单举例说明（例子：`StringExtension`）：

变量 `$filters` 定义了支持通过 filter 的形式在 twig 中处理数据，如：`{{ 'abcd'|truncate(2) }}`，参数参考该类下的 `function truncate`

变量 `$functions` 定义了支持通过 function 的形式在 twig 中处理数据，如：`{{ truncate('abcd', 2) }}`，参数参考该类下的 `function truncate`

其他复杂用法可以深入研究后使用，一般了解以上两种即可

### twig 页面常见操作说明

举例说明（例子：`catalog/view/theme/yzcTheme/template/customerpartner/seller_center/recommend_detail.twig`）

- `{% trans_default_category '翻译的category' %}` 定义了该页面的翻译分组，配合 `{{ __('需要翻译的内容') }}` 完成翻译

- `{{ this.title('页面标题') }}` 定义了页面的 title

- `{{ this.params('breadcrumbs', []) }}` 定义了向 layout 传参的方法，此处向 layout 传递 breadcrumbs

- `{{ css(['css文件']) }}` 和 `{{ cssOrigin(['css文件']) }}` 定义了页面使用的 css 文件，
  `css()` 相对目录为 `public`，`cssOrigin()` 相对目录为`项目根目录`

- 如果有js文件需要引入，使用 `js()` 或 `jsOrigin()`，区别同 css

- `{{ asset('静态资源文件') }}` 可以引入任何静态资源，一般用于引入图片等

- 页面无 `{{header}}`、`{{footer}}`、`{{column_left}}` 等 layout 结构性的变量，
  因为已经在 php 控制器中通过 render 第三个参数指定使用什么 layout，
  举例见 `catalog/controller/customerpartner/seller_center/recommend.php`

- 所有 twig 页面共享变量 `this`、`app`、`app_version`（即所有页面都能使用这些变量），共享变量见：`App\Providers\ViewProvider`

***注意：***

1. 以前 title,description,meta,css,js 等页面或前端信息，很多都在 php 端控制，以后全部在 twig 中进行控制

2. `cssOrigin()` 仅是为了兼容以前的资源文件，新的业务或页面写的 css 等，均放到 public 目录下，使用 `css()` 引入，js 同理

3. `css()`、`cssOrigin()`、`js()`、`jsOrigin()`、`asset()` 引入的静态资源无需添加版本号，会自动处理

4. `css()`、`cssOrigin()` 会自动被提取到页面的 head 中，按照定义的顺序

5. `js()`、`jsOrigin()` 默认会被放到页面的最后，body 之前，
   可以通过第二个参数修改到 `head`、`body开始`、`body结束`，见 `Framework\View\Enums\ViewWebPosition`

6. 静态图片的引入，使用 `asset('图片地址')`，并将文件放在 public 目录下，不建议在 img src 下直接相对路径或绝对路径

7. php 中建议使用 render 和 layout 指定页面布局，便于以后扩展，支持的 layout 见 `App\Providers\ViewProvider`

8. 使用 `{% apply script %}` 和 `{% endapply %}` 包裹页面内的 `<script></script>` 内容，可以提取相关内容到指定位置，
`<style></style>` 使用 `{% apply style %}` 和 `{% endapply %}` 包裹
   
9. `css()`、`cssOrigin()`、`js()`、`jsOrigin()`、`asset()`、`{% apply script %}`、`{% apply style %}` 处理的内容均会自动排重，
即在同一个页面，被多次重复引入（或者被多次include），仅会渲染一次

### 命令行说明

建议使用命令行创建视图文件：

  - buyer 视图：`php console make:view account/view_name`

  - seller 视图：`php console make:view account/test/view_name --seller`

# 会话Session使用规范

## 错误使用以及原因

1. 使用系统中原 `$this->session->data['xx']` 数组的形式

    - 指定默认值时经常需要的操作，但是如果使用数据，需要判断有则取，无则使用默认，将导致多写很多行代码
    
    - 删除 Session 中的值得使用 unset，后续实际是无法追踪到哪些地方 session 被删除或者清空掉的
    
    - 简单的数组操作，容易出现数组越界，键不存在等问题
    
2. 使用 Session 存储很大的数据
    
    - Session 最终会存储到一个存储器中（例如：File,DB,Redis），这些存储器一般都是有长度限制的，而且一般
    不建议太长，因此存储很大数据将会导致不可预见的异常

    - 每次请求都会将 Session 读取，处理再保存，如果数据量很大对性能存在一定影响
    
3. 使用 Session 存储数组或对象

    - 对象或者复杂数组（数组中有对象的），已经是非结构化数据，不建议存储到 Session 中，有可能会在取出时发生变化
    
    - 对 Session 的操作应该是类一维数组的操作，存入数组后就形成了二维数组，二维数组下值的变化比较难以反映该 Session
    值是否发生了变化，如果存入数据，建议对该数组的操作是整体性的
    
## 正确的使用方式

1. 使用标准 API 操作 Session，详见 【框架使用/会话-Session】

2. 如果在两次请求（或者跨请求）需要传递对象数据的，建议传递对象在库中的id信息，而非整个对象

3. 如果是一次性的会话数据，如上一个请求处理成功或失败后往 Session 里存一个提示，到下一个页面读取该数据，有就提示，
无则忽略，应该使用 `session->flash`

4. Session 的键（或 name）请不要使用数字，否则容易造成异常问题，请使用标准的，有意义的名字

5. 存入数组的情况，对该数组的操作应该是整体性的，即如果需要删除该数组下的某个值，操作流程应该为：取出该 Session，
删除数组下的值，重新保存该 Session

# 前端视图(Twig)中组件的使用规范.md

## 起因

前端有很多组件化的需求，尤其是囊括 css/js/html 的，因此封装成一个完整的组件是非常有必要的

## 解决办法

使用 macro 或 include 或 widget

### 比较

| | macro | include | widget |
| ---- | ---- | ---- | ---- |
| 介绍 | [官网](https://twig.symfony.com/doc/1.x/templates.html#macros) | [官网](https://twig.symfony.com/doc/1.x/templates.html#including-other-templates) | [框架使用](../框架使用/17.视图组件-Widget.md) |
| 封装内容 | html | html/js/css | html/js/css/php |
| 封装难度 | 不方便 | 简单 | 简单/复杂 |
| 适用范围 | twig | twig | twig/php |

综合考虑：

前端后期使用 widget 做组件封装，由于 widget 比较偏 php，因此在此基础上实现了 `DynamicWidget`，可以由前端完全掌控，类似 include，
但是后期可以更加快速的切换到 widget 来实现部分后端逻辑

## DynamicWidget 动态组件介绍

### 使用

1. 在 resources/views/widgets/ 目录下建立一个 twig 文件，如：dynamic_widget_example.twig

2. 在 dynamic_widget_example.twig 内实现相关的内容，与此组件相关的 css/js/script/style 等引入建议参考 【13.前端视图(Twig)的使用规范.md】

3. 在需要引入的页面的 twig 中通过 `{{ dynamicWidget('dynamic_widget_example', { a: 'x' }) }}` 的形式引入组件

### 使用建议

- 关于动态 _id

每个组件都存在一个动态的 _id，用于在同一个页面多次引入同一个组件时的 _id 处理，在 twig 中使用如：`<div id="{{ _id }}"></div>`

请注意: 在传参时传递 _id，会覆盖动态 _id

- 关于传参

所有在 `{{ dynamicWidget('dynamic_widget_example', { a: 'x' }) }}` 中通过第二个参数传递的参数，都可以直接在组件的 twig 中直接使用

- 关于组件内 js 的写法

1. 比如同一个页面对同一个组件存在如下js:

```js
var a = new CountDown('#ida');
a.start();
var b = new CountDOnw('#idb');
b.start();
```

封装到 twig 组件内建议如下：

```twig
{% apply script %}
;(function(name) {
    name = new CountDown('#{{ _id }}');
    name.start();
})('count{{ _id }}');
{% endapply %}
```

*注意*：立即执行函数前一般加一个分号，否则若前一个表达式未用分号结尾时，会导致 js 错误！

2. 比如有组件需要 js 回调传参的：

```js
var a = new CountDown('#ida');
a.start();
a.on('end', function () {
    // 一些针对当前页面的逻辑回调
})
```

封装到 twig 组件内如下：

```twig
{% apply script %}
;(function(name) {
    name = new CountDown('#{{ _id }}');
    name.start();
    name.on('end', {{ endCB }});
})('count{{ _id }}');
{% endapply %}
```

外部调用：

```twig
{{ dynamicWidget('dynamic_widget_example', { endCB: 'dynamicWidgetExample.endCB' }) }}

{% apply script %}
<script>
    var dynamicWidgetExample.endCB = function() {
        // 一些针对当前页面的逻辑回调
    }
</script>
{% endapply %}
```

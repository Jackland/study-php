# 表单防重复提交检查 FormSubmitRepeatChecker

针对表单重复提交，在后台服务端的处理组件

## 对于防重复提交的一般做法

1. 前端 js 控制，点击提交后立即设为 disabled，不允许再操作

2. 后端对提交进行校验，只允许提交一次，否则提示重复提交表单

3. 数据库设置字段为 unique，防止重复插入数据

*FormSubmitRepeatChecker 为针对第 2 点进行的封装*

## 思路介绍

1. 进入表单页面时设置一个 session 数据

2. 提交表单时，校验 session 是否存在，存在表示可以提交，并立即删除该 session

3. 提交表单时，若 session 不存在表示是重复提交了

## 使用

1. 进入表单页面设置 session

```php
FormSubmitRepeatChecker::create()->initForm();
```

2. 提交表单时校验

```php
if (FormSubmitRepeatChecker::create()->isSubmitRepeat()) {
    // 重复提交
}
// 实际业务
```

## 综合例子

```php
if ($this->request->isMethod('POST')) {
   // 表单提交后校验
   if (FormSubmitRepeatChecker::create()->isSubmitRepeat()) {
        // 重复提交
        //return;
    }
    // 实际业务
    //return;
}
// 展示表单前初始化
FormSubmitRepeatChecker::create()->initForm();
return $this->render('xxx');
```

## 例子参考

`catalog/controller/common/test.php` 下的 `testFormSubmitRepeat`

## 其他说明

1. 当一个页面有多个表单时，可以通过特殊设置 key 来保证多个表单都独立防重复提交: `FormSubmitRepeatChecker::create('SOME_KEY')`

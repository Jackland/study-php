# 日志-Log

## 使用方法

### 项目中推荐写法

已对 psr 的日志做了一层封装，更便于使用

```php
use App\Logging\Logger;
use Psr\Log\LogLevel;

// 写入日志到 runtime\logs\XX\XXX-2020-09-09.log 下
Logger::app('msg');
Logger::orm('orm');

// 修改日志类别，支持类别见 Psr\Log\LogLevel
Logger::app('msg', 'error'); // 修改日志类别为 error
Logger::app('msg', LogLevel::WARNING); // 修改日志类别为 warning

// msg 支持的形式
Logger::app('msg'); // 字符串
Logger::app(['a' => 1, 'b' => 2]); // 数组
Logger::app(new Exception('aa')); // 异常，异常请勿放到数组中

// context
Logger::error('msg', 'error', [
    Logger::CONTEXT_VAR_DUMPER => ['xx' => 'XX'], // 按照可视化形式输出
    Logger::CONTEXT_WEB_SERVER_VARS => ['_GET', '_POST', '_SERVER'], // 可视化输出 $GLOBAL 中的数据
]);
```

### PSR-3 标准接口

```php
use App\Logging\LogChannel;
use Psr\Log\LoggerInterface;
use Psr\Log\LogLevel;

// 获取实例
$logger = $this->logger; // controller 和 model 中
$logger = app()->get(LoggerInterface::class);
$logger = logger(); // 推荐
$logger = logger(LogChannel::ERROR); // 推荐，指定channel

// 记录日志
$logger->emergency('msg');
$logger->alert('msg');
$logger->critical('msg');
$logger->error('msg');
$logger->warning('msg');
$logger->notice('msg');
$logger->info('msg');
$logger->debug('msg');
$logger->log(LogLevel::WARNING, 'msg');
```

## 配置

### 简单配置：

1. 修改 `src\Logging\LogChannel.php`，增加一个 channel 名

如 `const RATE_LIMIT = 'rateLimit';`

2. 修改 `src\Logging\Logger.php`，增加与上方增加的 channel 名一致的代码提示

如 `@method static void rateLimit($msg, $type = 'info', $context = [])`

3. 使用

如 `Logger::rateLimit('test')`

### 复杂配置：

修改配置文件 `config\_logging.php`

## 参考

[PSR-3 官方](https://www.php-fig.org/psr/psr-3/)

[Monolog 官方](https://github.com/Seldaek/monolog)
# Lock 锁

## 配置

- 简单的新增一个锁的业务，只需要在 App\Components\Locker 上增加一行注释

如：`@method static LockInterface someLockName($key = null, $ttl = 300, $autoRelease = true)`

- 稍微复杂点的可以在 App\Components\Locker 内自己增加一个 static 方法获取 LockInterface

## 使用

```php
use App\Components\Locker;

$lockKey = 'xjsj';
$lock = Locker::someLockName($someKey, 5); // 会创建一个锁，命名为 lock_someLockNamexjsj，锁最长有效期为 5 秒，在进程结束时会自动释放
if ($lock->acquire()) { // 获取锁，不等待
    // do something
}
if ($lock->acquire(true)) { // 获取锁，等待阻塞，直达取到锁
    // do something
}
$lock->release(); // 释放锁
$lock->refresh(); // 刷新锁时间
```

建议写法

```php
use App\Components\Locker;

$lockKey = 'xjsj';
$lock = Locker::someLockName($someKey, 30);
if (!$lock->acquire()) {
    // 提示未获取到锁
    return;
}
try {
    // 执行一些需要锁的业务
} finally {
    $lock->release();
}
```

## 参考

[Symfony Lock](https://symfony.com/doc/4.4/components/lock.html)
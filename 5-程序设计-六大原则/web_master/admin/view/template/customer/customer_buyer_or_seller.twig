<script type="text/javascript" src="view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
{# 查询条件 #}
<div class="well">
    <div class="row">
        <div class="col-sm-6">
            <div class="form-group" style="margin: 0">
                <label for="input-bos-customer-name" class="control-label">{% if is_partner %}{{ column_buyer_name }}{% else %}{{ column_seller_name }}{% endif %}</label>
                <input type="text" name="filter_bos_customer_name" value="{{ input_bos_customer_name }}" placeholder="{% if is_partner %}{{ column_buyer_name }}{% else %}{{ column_seller_name }}{% endif %}" id="input-bos-customer-name" class="form-control"/>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="form-group" style="margin: 0">
                <label for="input-bos-email" class="control-label">{{ column_email }}</label>
                <input type="text" name="filter_bos_email" value="{{ input_bos_email }}" placeholder="{{ column_email }}" id="input-bos-email" class="form-control"/>
            </div>
            <button type="button" onclick="filterData(this);" class="btn btn-primary pull-right"><i class="fa fa-search"></i> {{ button_filter }}</button>
        </div>
    </div>
</div>
{# 表格数据 #}
<div class="table-responsive">
    {% if is_partner %}
        {#Seller#}
      <table class="table table-striped table-bordered table-hover">
        <thead>
        <tr>
          <td>{{ column_num }}</td>
          <td>
              {% if sort == 'cc.`firstname`' %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_buyer_name }}');" class="{{ order|lower }}">{{ column_buyer_name }}</a>
              {% else %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_buyer_name }}');">{{ column_buyer_name }}</a>
              {% endif %}
          </td>
          <td>{{ column_email }}</td>
          <td style="width: 120px">
              {% if sort == 'bts.`buy_status`' %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_buy_status }}');" class="{{ order|lower }}"><span data-toggle="tooltip" title="{{ tip_buy_status }}">{{ column_buy_status }}</span></a>
              {% else %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_buy_status }}');"><span data-toggle="tooltip" title="{{ tip_buy_status }}">{{ column_buy_status }}</span></a>
              {% endif %}
          </td>
          <td style="width: 120px">
              {% if sort == 'bts.`price_status`' %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_price_status }}');" class="{{ order|lower }}"><span data-toggle="tooltip" title="{{ tip_price_status }}">{{ column_price_status }}</span></a>
              {% else %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_price_status }}');"><span data-toggle="tooltip" title="{{ tip_price_status }}">{{ column_price_status }}</span></a>
              {% endif %}
          </td>
          <td><span data-toggle="tooltip" title="{{ tip_discount }}">{{ column_discount }}<i class="giga icon-V10-wenhaotishi"></i></span></td>
          <td style="width: 120px">
              {% if sort == 'bts.`seller_control_status`' %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_seller }}');" class="{{ order|lower }}"><span data-toggle="tooltip" title="{{ tip_coop_status_seller }}">{{ column_coop_status_seller }}</span></a>
              {% else %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_seller }}');"><span data-toggle="tooltip" title="{{ tip_coop_status_seller }}">{{ column_coop_status_seller }}</span></a>
              {% endif %}
          </td>
          <td style="width: 120px">
              {% if sort == 'bts.`buyer_control_status`' %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_buyer }}');" class="{{ order|lower }}"><span data-toggle="tooltip" title="{{ tip_coop_status_buyer }}">{{ column_coop_status_buyer }}</span></a>
              {% else %}
                  <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_buyer }}');"><span data-toggle="tooltip" title="{{ tip_coop_status_buyer }}">{{ column_coop_status_buyer }}</span></a>
              {% endif %}
          </td>
          <td style="width: 105px" class="text-center">{{ column_action }}</td>
        </tr>
        </thead>
        <tbody>
        {% for data in tableData  %}
            <tr id="data_{{ data.id }}">
                <td>
                    <input hidden value="{{ data.id }}" name="id" type="text"/>
                    {{ data.num }}
                </td>
                <td>{{ data.buyer_name }}</td>
                <td>{{ data.buyer_email }}</td>
                <td>
                    {% if data.buy_status == 1 %}
                        <span class="form-display">{{ button_enable }}</span>
                    {% elseif data.buy_status == 0 %}
                        <span class="form-display">{{ button_disable }}</span>
                    {% endif %}
                    <select class="form-edit form-control" style="display: none" name="buy_status">
                        <option value="0" {% if data.buy_status == 0 %} selected {% endif %}>{{ button_disable }}</option>
                        <option value="1" {% if data.buy_status == 1 %} selected {% endif %}>{{ button_enable }}</option>
                    </select>
                </td>
                <td>
                    {% if data.price_status == 1 %}
                        <span class="form-display">{{ button_enable }}</span>
                    {% elseif data.price_status == 0 %}
                        <span class="form-display">{{ button_disable }}</span>
                    {% endif %}
                    <select class="form-edit form-control" style="display: none" name="price_status">
                        <option value="0" {% if data.price_status == 0 %} selected {% endif %}>{{ button_disable }}</option>
                        <option value="1" {% if data.price_status == 1 %} selected {% endif %}>{{ button_enable }}</option>
                    </select>
                </td>
                <td>
                    <span class="form-display">{{ data.discount }}</span>
                    <input class="form-edit form-control" value="{{ data.discount }}" style="display: none" name="discount" type="number" max="1" min="0" step="0.1"/>
                </td>
                <td>
                    {% if data.coop_status_seller == 1 %}
                        <span class="form-display">{{ button_enable }}</span>
                    {% elseif data.coop_status_seller == 0 %}
                        <span class="form-display">{{ button_disable }}</span>
                    {% endif %}
                    <select class="form-edit form-control" style="display: none" name="coop_status_seller">
                        <option value="0" {% if data.coop_status_seller == 0 %} selected {% endif %}>{{ button_disable }}</option>
                        <option value="1" {% if data.coop_status_seller == 1 %} selected {% endif %}>{{ button_enable }}</option>
                    </select>
                </td>
                <td>
                    {% if data.coop_status_buyer == 1 %}
                        <span class="form-display">{{ button_enable }}</span>
                    {% elseif data.coop_status_buyer == 0 %}
                        <span class="form-display">{{ button_disable }}</span>
                    {% endif %}
                    <select class="form-edit form-control" style="display: none" name="coop_status_buyer">
                        <option value="0" {% if data.coop_status_buyer == 0 %} selected {% endif %}>{{ button_disable }}</option>
                        <option value="1" {% if data.coop_status_buyer == 1 %} selected {% endif %}>{{ button_enable }}</option>
                    </select>
                </td>
                <td>
                    <a onclick="edit('data_{{ data.id }}');" data-toggle="tooltip" title="{{ button_edit }}" class="btn btn-primary btn-form-display"><i class="fa fa-pencil"></i></a>
                    <a onclick="deleteData({{ data.id }}, this);" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger btn-form-display"><i class="fa fa-trash-o"></i></a>
                    <a style="display: none" onclick="save('data_{{ data.id }}',this);" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary btn-form-edit"><i class="fa fa-save"></i></a>
                    <a style="display: none" onclick="back('data_{{ data.id }}');" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default btn-form-edit"><i class="fa fa-reply"></i></a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
      </table>
        <div class="row" style="margin-right: 0">
            <div class="col-sm-6 text-left">
                <ul id="bos_pagination">
                    <!--里面什么都不用写-->
                </ul></div>
            <div class="col-sm-6 text-right">{{ results}}</div>
        </div>
    {% else %}
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr>
                    <td>{{ column_num }}</td>
                    <td>
                        {% if sort == 'sc.`firstname`' %}
                            <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_seller_name }}');" class="{{ order|lower }}">{{ column_seller_name }}</a>
                        {% else %}
                            <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_seller_name }}');">{{ column_seller_name }}</a>
                        {% endif %}
                    </td>
                    <td>{{ column_email }}</td>
                    <td>{{ column_account }}</td>
                    <td>{{ column_password }}</td>
                    <td style="width: 120px">
                        {% if sort == 'bts.`seller_control_status`' %}
                            <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_seller }}');" class="{{ order|lower }}"><span data-toggle="tooltip" title="{{ tip_coop_status_seller }}">{{ column_coop_status_seller }}</span></a>
                        {% else %}
                            <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_seller }}');"><span data-toggle="tooltip" title="{{ tip_coop_status_seller }}">{{ column_coop_status_seller }}</span></a>
                        {% endif %}
                    </td>
                    <td style="width: 120px">
                        {% if sort == 'bts.`buyer_control_status`' %}
                            <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_buyer }}');" class="{{ order|lower }}"><span data-toggle="tooltip" title="{{ tip_coop_status_buyer }}">{{ column_coop_status_buyer }}</span></a>
                        {% else %}
                            <a style="cursor: pointer" onclick="$('#sellerOrBuyer').load('{{ sort_coop_status_buyer }}');"><span data-toggle="tooltip" title="{{ tip_coop_status_buyer }}">{{ column_coop_status_buyer }}</span></a>
                        {% endif %}
                    </td>
                    <td style="width: 105px" class="text-center">{{ column_action }}</td>
                </tr>
            </thead>
            <tbody>
            {% for data in tableData  %}
                <tr id="data_{{ data.id }}">
                    <td>
                        <input hidden value="{{ data.id }}" name="id" type="text"/>
                        {{ data.num }}
                    </td>
                    <td>{{ data.seller_name }}</td>
                    <td>{{ data.seller_email }}</td>
                    <td>
                        <span class="form-display">{{ data.account }}</span>
                        <input type="text" value="{{ data.account }}" class="form-edit form-control" style="display: none" name="account"/>
                    </td>
                    <td>
                        <span  class="form-display">{{ data.password }}</span>
                        <input type="text" value="{{ data.password }}" class="form-edit form-control" style="display: none" name="pwd"/>
                    </td>
                    <td>
                        {% if data.coop_status_seller == 1 %}
                            <span class="form-display">{{ button_enable }}</span>
                        {% elseif data.coop_status_seller == 0 %}
                            <span class="form-display">{{ button_disable }}</span>
                        {% endif %}
                        <select class="form-edit form-control" style="display: none" name="coop_status_seller">
                            <option value="0" {% if data.coop_status_seller == 0 %} selected {% endif %}>{{ button_disable }}</option>
                            <option value="1" {% if data.coop_status_seller == 1 %} selected {% endif %}>{{ button_enable }}</option>
                        </select>
                    </td>
                    <td>
                        {% if data.coop_status_buyer == 1 %}
                            <span class="form-display">{{ button_enable }}</span>
                        {% elseif data.coop_status_buyer == 0 %}
                            <span class="form-display">{{ button_disable }}</span>
                        {% endif %}
                        <select class="form-edit form-control" style="display: none" name="coop_status_buyer">
                            <option value="0" {% if data.coop_status_buyer == 0 %} selected {% endif %}>{{ button_disable }}</option>
                            <option value="1" {% if data.coop_status_buyer == 1 %} selected {% endif %}>{{ button_enable }}</option>
                        </select>
                    </td>
                    <td>
                        <a onclick="edit('data_{{ data.id }}');" data-toggle="tooltip" title="{{ button_edit }}" class="btn btn-primary btn-form-display"><i class="fa fa-pencil"></i></a>
                        <a onclick="deleteData({{ data.id }}, this);" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger btn-form-display"><i class="fa fa-trash-o"></i></a>
                        <a style="display: none" onclick="save('data_{{ data.id }}',this);" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary btn-form-edit"><i class="fa fa-save"></i></a>
                        <a style="display: none" onclick="back('data_{{ data.id }}');" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default btn-form-edit"><i class="fa fa-reply"></i></a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="row" style="margin-right: 0">
            <div class="col-sm-6 text-left">
                <ul id="bos_pagination">
                    <!--里面什么都不用写-->
                </ul></div>
            <div class="col-sm-6 text-right">{{ results}}</div>
        </div>
    {% endif %}
</div>

<legend style="margin-top: 20px">
    {% if is_partner %}
        {{ text_add_buyers }}
    {% else %}
        {{ text_add_sellers }}
    {% endif %}
</legend>
<div class="container">
    <div class="form-group">
        <div class="row" style="margin-bottom: 15px">
            <label class="col-sm-2 control-label"></label>
            <div class="col-sm-8">
                <input type="text" name="filter_add_customer_email" placeholder="{{ entry_customer_email }}" id="input-add-customer-email" class="form-control" />
            </div>
            <div class="col-sm-1">
                <button type="button" onclick="filterCustomer(this);" class="btn btn-primary pull-right"><i class="fa fa-search"></i> {{ button_filter }}</button>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-2 text-right">
                <div>
                <label class="control-label"><span data-toggle="tooltip" title="{{ text_add_seller_or_buyer}}">{% if is_partner %}{{ text_other_buyers }}{% else %}{{ text_other_sellers }}{% endif %}<i class="giga icon-V10-wenhaotishi"></i></span></label>
                </div>
                <div>
                <label><span>{{ checkbox_selectAll }}<input type="checkbox" onclick="$('input[name*=\'customer_ids\']').prop('checked', this.checked);"/></span></label>
                </div>
            </div>
            <div class="col-sm-9">
                <div class="well well-sm" style="height:300px;overflow:auto" id="customer-well">
                    {% if customers %}
                        {% for key, customer in customers %}
                            <div class="checkbox">
                                <label for="customer_{{ customer['id']}}">
                                    <input type="checkbox" name="customer_ids" value="{{ customer['id']}}" id="customer_{{ customer['id']}}" />
                                    <span style="display: inline-block;width: 230px;margin-left: 10px">
                                        <span style="font-weight: bold">{% if is_partner %}{{ column_buyer_name }}: {% else %}{{ column_seller_name }}: {% endif %}</span>
                                        <span>{{ customer['name'] }}</span>
                                    </span>
                                    <span style="display: inline-block;">
                                        <span style="font-weight: bold">{{ column_email }}: </span>
                                        <span>{{ customer['email'] }}</span>
                                    </span>
                                </label>
                            </div>
                        {% endfor %}
                    {% else %}
                        {{ text_no_buyer_assign}}
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-10"></div>
            <div class="col-sm-1">
                <button type="button" class="btn btn-primary pull-right" onclick="addBuyerOrSeller({{ is_partner }}, {{ customer_id }}, this);">
                    {% if is_partner %}
                        {{ text_add_buyers }}
                    {% else %}
                        {{ text_add_sellers }}
                    {% endif %}
                </button>
            </div>
        </div>
    </div>
    {#<div class="row">#}
        {#<div class="row" style="margin-right: 0">#}
            {#<div class="col-sm-6 text-left">#}
                {#<ul id="bos_pagination_other">#}
                    {#<!--里面什么都不用写-->#}
                {#</ul>#}
            {#</div>#}
            {#<div id="result_other_pageMsg" class="col-sm-6 text-right">{{ results_other}}</div>#}
        {#</div>#}
    {#</div>#}
</div>
<script>
    if ({{ other_total_pages }}) {
        loadPaginationOther({{ page_other_num }},{{ other_total_pages }});
    }

    if ({{ total_pages }}) {
        $('#bos_pagination').bootstrapPaginator({
            /*当前使用的是3版本的bootstrap*/
            bootstrapMajorVersion: 3,
            /*配置的字体大小是小号*/
            size: 'normal',
            /*当前页*/
            currentPage: {{ page_num }},
            /*一共多少页*/
            totalPages: {{ total_pages }},
            /*页面上最多显示几个含数字的分页按钮*/
            numberOfPages: 5,
            /*设置显示的样式，默认是箭头	*/
            // itemTexts: function(type, page, current) {
            //     switch(type) {
            //         case "first": // type值固定
            //             return `<span class="glyphicon glyphicon-fast-backward"></span>`;
            //         case "prev":
            //             return `<span class="glyphicon glyphicon-step-backward"></span>`;
            //         case "next":
            //             return `<span class="glyphicon glyphicon-step-forward"></span>`;
            //         case "last":
            //             return `<span class="glyphicon glyphicon-fast-forward"></span>`;
            //         case "page":
            //             return page;
            //     }
            // },
            onPageClicked: function(event, originalEvent, type, page) {
                let url = getPageOrFilterUrl(page);
                let pageOtherNum = $('.pagination_other').bootstrapPaginator("getPages");
                if (pageOtherNum !== undefined && pageOtherNum > 1) {
                    url += "&page_other_num=" + pageOtherNum;
                }
                $('#sellerOrBuyer').load(url);
            }
        });
    }

    function loadPaginationOther(page_num, total_pages) {
        $('#bos_pagination_other').bootstrapPaginator({
            /*当前使用的是3版本的bootstrap*/
            bootstrapMajorVersion: 3,
            /*配置的字体大小是小号*/
            size: 'normal',
            /*当前页*/
            currentPage: page_num,
            /*一共多少页*/
            totalPages: total_pages,
            /*页面上最多显示几个含数字的分页按钮*/
            numberOfPages: 5,
            onPageClicked: function(event, originalEvent, type, page) {
                let data = {};
                data["page"] = page;
                data["is_partner"] = {{ is_partner }};
                data["customer_id"] = {{ customer_id }};
                $.ajax({
                    url: 'index.php?route=customer/customer/getOtherCustomer&user_token={{ user_token }}',
                    type: 'post',
                    dataType: 'json',
                    data: data,
                    success: function(json) {
                        if (json['results_other']) {
                            $("#result_other_pageMsg").empty();
                            $("#result_other_pageMsg").append(json['results_other']);
                        }
                        if (json['customers']) {
                            var customers = json['customers'];
                            if (customers.length > 0) {
                                $("#customer-well").empty();
                                for (var i = 0; i < customers.length; i++) {
                                    var html = "";
                                    html += '<div class="checkbox">';
                                    html += '	<label for="customer_' + customers[i].id + '">';
                                    html += '		<input type="checkbox" name="customer_ids" value="' + customers[i].id + '" id="customer_' + customers[i].id + '" />';
                                    html += '		<span style="display: inline-block;width: 230px;margin-left: 10px">';
                                    html += '			<span style="font-weight: bold">{% if is_partner %}{{ column_buyer_name }}: {% else %}{{ column_seller_name }}: {% endif %}</span>';
                                    html += '			<span>' + customers[i].name + '</span>'
                                    html += '		</span>';
                                    html += '		<span style="display: inline-block;">'
                                    html += '			<span style="font-weight: bold">{{ column_email }}: </span>';
                                    html += '			<span>' + customers[i].email + '</span>'
                                    html += '		</span>';
                                    html += '	</label>';
                                    html += '</div>';
                                    $("#customer-well").append(html);
                                }
                            } else {
                                $("#customer-well").empty();
                                $("#customer-well").append("{{ text_no_buyer_assign}}");
                            }
                        }
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        });
    }
    
    function filterCustomer(button) {
        let data = {};
        data["customer_email"] = $("#input-add-customer-email").val();
        data["is_partner"] = {{ is_partner }};
        data["customer_id"] = {{ customer_id }};
        $.ajax({
            url: 'index.php?route=customer/customer/getOtherCustomer&user_token={{ user_token }}',
            type: 'post',
            dataType: 'json',
            data: data,
            beforeSend: function() {
                $(button).button('loading');
            },
            complete: function() {
                $(button).button('reset');
            },
            success: function(json) {
                if (json['other_total_pages'] && json['other_total_pages'] > 0) {
                    loadPaginationOther(json['page_other_num'], json['other_total_pages']);
                }
                if (json['results_other']) {
                    $("#result_other_pageMsg").empty();
                    $("#result_other_pageMsg").append(json['results_other']);
                }
                if (json['customers']) {
                    var customers = json['customers'];
                    if (customers.length > 0) {
                        $("#customer-well").empty();
                        for (var i = 0; i < customers.length; i++) {
                            var html = "";
                            html += '<div class="checkbox">';
                            html += '	<label for="customer_' + customers[i].id + '">';
                            html += '		<input type="checkbox" name="customer_ids" value="' + customers[i].id + '" id="customer_' + customers[i].id + '" />';
                            html += '		<span style="display: inline-block;width: 230px;margin-left: 10px">';
                            html += '			<span style="font-weight: bold">{% if is_partner %}{{ column_buyer_name }}: {% else %}{{ column_seller_name }}: {% endif %}</span>';
                            html += '			<span>' + customers[i].name + '</span>'
                            html += '		</span>';
                            html += '		<span style="display: inline-block;">'
                            html += '			<span style="font-weight: bold">{{ column_email }}: </span>';
                            html += '			<span>' + customers[i].email + '</span>'
                            html += '		</span>';
                            html += '	</label>';
                            html += '</div>';
                            $("#customer-well").append(html);
                        }
                    } else {
                        $("#customer-well").empty();
                        $("#customer-well").append("{{ text_no_buyer_assign}}");
                    }
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    }

    function edit(id) {
        // 显示编辑
        $("#" + id + " .form-edit").css("display", "block");
        $("#" + id + " .btn-form-edit").css("display", "inline-block");
        // 隐藏展示
        $("#" + id + " .form-display").css("display","none");
        $("#" + id + " .btn-form-display").css("display","none");
    }

    function deleteData(id, button) {
        let data = {};
        if (confirm('{{ text_delete_data_tip }}')) {
            data["id"] = id;
            data["is_partner"] = "{{ is_partner }}";
            data["customer_id"] = "{{ customer_id }}";
            data["sort"] = "{{ sort }}";
            data["order"] = "{{ order }}";
            data["page_limit"] = {{ page_limit }};
            data["page_num"] = {{ page_num }};
            // customer name
            let input_customer_name = $("#input-bos-customer-name").val();
            // email
            let input_email = $("#input-bos-email").val();
            data["input_customer_name"] = input_customer_name;
            data["input_email"] = input_email;
            let pageOtherNum = $('.pagination_other').bootstrapPaginator("getPages");
            if (pageOtherNum !== undefined && pageOtherNum > 1) {
                data["page_other_num"] = pageOtherNum;
            }
            $.ajax({
                url: 'index.php?route=customer/customer/deleteSellerOrBuyer&user_token={{ user_token }}',
                type: 'post',
                dataType: 'json',
                data: data,
                success: function(json) {
                    if (json['load'] !== undefined) {
                        $('#sellerOrBuyer').load(json['load']);
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                }
            });
        }
    }

    function save(id, button) {
        var data = {};
        var formData = $("#" + id + " .form-edit");
        if (formData !== undefined) {
            for (var i = 0; i < formData.length; i++) {
                data[formData[i].name] = formData[i].value;
            }
        }
        if (data["discount"] !== undefined) {
            var discount = parseInt(data["discount"]);
            if (discount < 0 || discount > 1) {
                alert("{{ error_save_discount }}");
                return;
            }
        }
        data[$("#" + id + " input[name='id']")[0].name] =  $("#" + id + " input[name='id']")[0].value;
        data["is_partner"] = "{{ is_partner }}";
        data["customer_id"] = "{{ customer_id }}";
        data["sort"] = "{{ sort }}";
        data["order"] = "{{ order }}";
        data["page_limit"] = {{ page_limit }};
        data["page_num"] = {{ page_num }};
        // customer name
        let input_customer_name = $("#input-bos-customer-name").val();
        // email
        let input_email = $("#input-bos-email").val();
        data["input_customer_name"] = input_customer_name;
        data["input_email"] = input_email;
        let pageOtherNum = $('.pagination_other').bootstrapPaginator("getPages");
        if (pageOtherNum !== undefined && pageOtherNum > 1) {
            data["page_other_num"] = pageOtherNum;
        }
        $.ajax({
            url: 'index.php?route=customer/customer/updateSellerOrBuyer&user_token={{ user_token }}',
            type: 'post',
            dataType: 'json',
            data: data,
            beforeSend: function() {
                $(button).button('loading');
            },
            complete: function() {
                $(button).button('reset');
            },
            success: function(json) {
                if (json['load'] !== undefined) {
                    $('#sellerOrBuyer').load(json['load']);
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    }

    function back(id) {
        $("#" + id + " .form-display").css("display","block");
        $("#" + id + " .btn-form-display").css("display","inline-block");
        $("#" + id + " .form-edit").css("display", "none");
        $("#" + id + " .btn-form-edit").css("display", "none");
    }

    function filterData(button) {
        let url = getPageOrFilterUrl();
        let pageOtherNum = $('.pagination_other').bootstrapPaginator("getPages");
        if (pageOtherNum !== undefined && pageOtherNum > 1) {
            url += "&page_other_num=" + pageOtherNum;
        }
        $(button).button('loading');
        $('#sellerOrBuyer').load(encodeURI(url));
    }

    function getPageOrFilterUrl(page) {
        // customer name
        let input_customer_name = $("#input-bos-customer-name").val();
        // email
        let input_email = $("#input-bos-email").val();
        let url = "index.php?route=customer/customer/sellerOrBuyer&user_token={{ user_token }}";
        if (input_customer_name !== undefined && input_customer_name != "") {
            url += "&input_customer_name=" + input_customer_name;
        }
        if (input_email !== undefined && input_email != "") {
            url += "&input_email=" + input_email;
        }
        url += "&is_partner=" + {{ is_partner }};
        url += "&customer_id=" + {{ customer_id }};
        url += "&sort=" + "{{ sort }}";
        url += "&order=" + "{{ order }}";
        url += "&page_limit=" + {{ page_limit }};
        if (page) {
            url += "&page_num=" + page;
        } else {
            url += "&page_num=" + {{ page_num }};
        }
        return url;
    }
    
    function addBuyerOrSeller(is_partner, customer_id, button) {
        let data = {};
        data['is_partner'] = is_partner;
        data['customer_id'] = customer_id;
        var input_checked = $("input:checkbox[name='customer_ids']:checked");
        if (input_checked) {
            if (input_checked.length <= 0) {
                alert("{{ error_add_buyer_or_seller }}");
                return;
            } else {
                var customer_ids = [];
                for (var i = 0; i < input_checked.length; i++) {
                    customer_ids.push(input_checked[i].value);
                }
                data["customer_ids"] = customer_ids;
                $.ajax({
                    url: 'index.php?route=customer/customer/addBuyerOrSeller&user_token={{ user_token }}',
                    type: 'post',
                    dataType: 'json',
                    data: data,
                    beforeSend: function() {
                        $(button).button('loading');
                    },
                    // ajax 先返回，此时按钮rest，但success处理结果还在加载，此时一直点按钮可以重复插入数据
                    // complete: function() {
                    //     $(button).button('reset');
                    // },
                    success: function(json) {
                        if (json['load'] !== undefined) {
                            $('#sellerOrBuyer').load(json['load']);
                        }
                    },
                    error: function(xhr, ajaxOptions, thrownError) {
                        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });
            }
        } else {
            alert("{{ error_add_buyer_or_seller }}");
        }
    }
</script>

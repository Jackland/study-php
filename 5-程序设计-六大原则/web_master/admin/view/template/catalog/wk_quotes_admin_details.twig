{{header}}
<style>
div#tab-images td{
  display: inline-table;
}
div#tab-images .thumbnail{
  margin: 3px;
}
div#alert-view div.alert{
  color : #000;
}
div#alert-view div.col-sm-10{
  padding: 0px;
}
@media (max-width: 767px) {
  div#alert-view .pull-right{
    float: none !important;
  }
}
</style>
{{column_left}}
{% if result_quoteadmin.status is defined %}
{% set statusClass =  result_quoteadmin.status == 0 ? 'text-warning' : result_quoteadmin.status == 1 ? 'text-success' : result_quoteadmin.status == 2 ? 'text-danger' : result_quoteadmin.status == 3 ? 'text-info' : 'text-danger' %}
{% else %}
{% set statusClass = 'text-danger' %}
{% endif %}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <a href="{{back}}" data-toggle="tooltip" title="{{button_back}}" class="btn btn-default"><i class="fa fa-reply"></i></a></div>
      <h1>{{heading_title}}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{breadcrumb.href}}">{{breadcrumb.text}}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="container-fluid">
    {% if  error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{error_warning}}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if  success %}
    <div class="alert alert-success"><i class="fa fa-exclamation-circle"></i>{{success}}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i>{{heading_title}}</h3>
      </div>

      <div class="panel-body">

        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab-general" data-toggle="tab">{{tab_quote}}</a></li>
          <li><a href="#tab-messages" data-toggle="tab">{{text_message}}</a></li>
        </ul>

        <div class="tab-content">
          <div id="tab-general" class="tab-pane active">
            <table class="table">
              {% if result_quoteadmin %}
                <tbody>
                  <tr>
                     <td>{{text_id}}:</td>
                     <td><input type="hidden" name="quote_id" value="{{result_quoteadmin.id}}">{{result_quoteadmin.id}}</td>
                  </tr>

                  <tr>
                    <td>{{text_status}} :</td>
                    <td class="{{statusClass}}"><b>{{result_quoteadmin.status_text}}</b></td>
                  </tr>

                  <tr>
                    <td>{{text_customer_name}} :</td>
                    <td>{{result_quoteadmin.customer_name}}</td>
                  </tr>

                  <tr>
                    <td>{{text_product_name}} :</td>
                    <td>
                      <div style="background:url({{result_quoteadmin.image}});background-repeat:no-repeat;background-position:center;min-height: 200px;">
                        <a href="{{result_quoteadmin.product_href}}">{{result_quoteadmin.product_name}}</a>
                        {% if result_quoteadmin.options%}
                            {% for key, option in result_quoteadmin %}
                            <br/>
                            &nbsp;&nbsp;  - <small>{{option.name}}{{option.value}}</small>
                            {% endfor %}
                          {% endif %}
                      </div>

                    </td>
                  </tr>

                  <tr>
                    <td>{{text_base_price}} :</td>
                    <td>{{result_quoteadmin.baseprice}}</td>
                  </tr>

                  <tr>
                    <td>{{text_ask}} :</td>
                    <td style="word-break: break-all;word-wrap: break-word">{{result_quoteadmin.message}}</td>
                  </tr>

                  <tr>
                    <td>{{text_quantity}} :</td>
                    <td>{{result_quoteadmin.quantity}}</td>
                  </tr>

                  <tr>
                    <td>{{text_quotes_price}} :</td>
                    <td>{{result_quoteadmin.price}}</td>
                  </tr>
                  {% endif %}
                  {% if result_quoteadmin.status == '3'%}
                  <tr>
                    <td colspan="2"><b class="text-info">{{text_sold_info}}</b></td>
                  </tr>

                  <tr>
                    <td><b>{{text_order_id}}</b> </td>
                    <td> # <a href="{{result_quoteadmin.orderhref}}" target="_blank">{{result_quoteadmin.order_id}}</a></td>
                  </tr>

                  <tr>
                    <td><b>{{text_discount}}</b> </td>
                    <td>{{result_quoteadmin.amount}}</td>
                  </tr>

                  <tr>
                    <td><b>{{text_date_used }}</b> </td>
                    <td>{{result_quoteadmin.date_used}}</td>
                  </tr>
                  {% endif %}
                </tbody>

            </table>
          </div>

          <!-- messages tab -->
          <div class="tab-pane" id="tab-messages">

            <div class="well">
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group">
                    <select name="filter_name" class="form-control">
                      <option value="*"></option>
                      <option value="{{ result_quoteadmin.customer_id }}"{{ filter_name == result_quoteadmin.customer_id ? 'selected' :''}}>{{result_quoteadmin.customer_name}}</option>
                      <option value="{{ result_quoteadmin.seller_id }}"{{filter_name == result_quoteadmin.seller_id ? 'selected' :''}}>{{result_quoteadmin.seller_name}}</option>
                      <option value="0"{{filter_name == '0' ? 'selected' :''}} >{{admin_name}}</option>
                    </select>
                  </div>
                </div>

                <div class="col-sm-3">
                  <div class="form-group">
                    <input type="text" name="filter_message" value="{{filter_message}}" placeholder="{{text_ask}}" id="input-msg" class="form-control" />
                  </div>
                </div>

                <div class="col-sm-3">
                  <div class="form-group date">
                    <div class='input-group date'>
                      <input type='text' name="filter_date" value="{{ filter_date }}" placeholder="{{ text_date }}" id="input-date" class="form-control" />
                      <span class="input-group-addon"><i class="fa fa-calendar"></i>
                      </span>
                    </div>
                  </div>
                </div>

                <div class="col-sm-3 text-right">

                  <div class="btn-group">
                    <button type="button" id="alert-view-button" class="btn btn-default" data-toggle="tooltip" title="{{button_alert}}"><i class="fa fa-th-list"></i></button>
                    <button type="button" id="table-view-button" class="btn btn-default" data-toggle="tooltip" title="{{button_table }}"><i class="fa fa-th"></i></button>
                    <button type="button" onclick="filter();" class="btn btn-primary"><i class="fa fa-search"></i></button>
                    <button type="button" onclick="clrfilter();" class="btn btn-danger"><i class="fa fa-eraser"></i></button>
                </div>
              </div>
            </div>

            <!-- table view -->
            <div class="table-responsive hide" id="table-view">
              <table class="table table-hove">
                <thead>
                  <tr>
                    <td class="text-left">
                      {% if  sort  ==  'pqm.writer' %}
                        <a href="{{sort_name}}" class="{{order|lower}}">{{text_customer_name}}</a>
                       {% else %}
                        <a href="{{sort_name}}" >{{text_customer_name}} </a>
                        {% endif %}
                    </td>
                    <td class="text-left">
                      {% if  sort  ==  'pqm.message' %}
                        <a href="{{sort_message}}" class="{{order|lower}}">{{text_ask}}</a>
                       {% else %}
                        <a href="{{sort_message}}" >{{text_ask}} </a>
                        {% endif %}
                    </td>
                    <td class="text-left">
                      {% if  sort  ==  'pqm.date' %}
                        <a href="{{sort_date}}" class="{{order|lower}}">{{text_date}}</a>
                       {% else %}
                        <a href="{{sort_date}}" >{{text_date}} </a>
                        {% endif %}
                    </td>
                  </tr>
                </thead>

                {% if results_message %}
                  {% for results_messages in results_message %}
                <tbody>
                  <tr>
                    <td class="text-left">{% if results_messages.writer%}{{results_messages.name}}{% else %} {{admin_name}}{% endif %}</td>
                    <td class="text-left"  style="word-wrap: break-word;word-break: break-all;">{{results_messages.message}}</td>
                    <td class="text-left">{{results_messages.date}}</td>
                  </tr>
                </tbody>
                {% endfor %}
                 {% else %}
                  <tbody>
                    <tr><td class="text-center" colspan="4">{{text_no_recored}}</td></tr>
                  </tbody>
                  {% endif %}
              </table>
            </div>

            <!-- alert view -->
            <div id="alert-view" class="hide">
              {% for res_message in results_message %}
                {% if res_message.writer %}
                  <div class="col-sm-10"  style="word-wrap: break-word;word-break: break-all;">
                    <div class="alert alert-success">
                      <label data-toggle="tooltip" title="{{res_message.name|capitalize}}"><i class="fa fa-user"></i> </label>
                      <label class="pull-right" ><i class="fa fa-clock-o"></i>{{res_message.date}}</label>
                      <br/>
                     {{res_message.message}}
                    </div>
                  </div>
                {% else %}
                  <div class="col-sm-10 pull-right"  style="word-wrap: break-word;word-break: break-all;">
                    <div class="alert alert-info">
                      <label data-toggle="tooltip" title="{{admin_name}}"><i class="fa fa-home"></i></label>
                      <label class="pull-right"><i class="fa fa-clock-o"></i>{{res_message.date}}</label>
                      <br/>
                     {{res_message.message}}
                    </div>
                  </div>
               {% endif %}
              {% endfor %}
            </div>


              {#分页#}
              <div class="row">
                <div class="col-sm-12">
                  <div class="pull-left">
                  </div>
                  <div class="pull-right">{{ pagination }}</div>
                </div>
              </div>


            </br>
            {% if result_quoteadmin %}
              <form action="{{save}}" method="post" enctype="multipart/form-data" class="form_msg">

                <div class="row required">
                  <label class="col-sm-12 text-left control-label">{{text_status}}</label>
                  <div class="col-sm-12">
                    <select name="status" class="form-control">
                    {% if quote_status %}
                      {% for key, value in quote_status %}
                        <option {% if key  ==  result_quoteadmin.status %}{{'selected'}}{% endif %} value="{{key}}">{{value}}</option>
                      {% endfor %}
                        {% else %}
                       {{text_no_option}}
                       {% endif %}
                    </select>
                  </div>
                </div>
                <br/>
                <div class="row required">
                  <label class="col-sm-12 text-left control-label">{{text_ask}}</label>
                  <div class="col-sm-12">
                    <input type="hidden" name="quote_id" value="{{result_quoteadmin.id}}">
                    <textarea name="message" rows="4" class="form-control" required></textarea>
                    <br/>
                    <button type="submit" class="btn btn-primary pull-right" data-toggle="tooltip" title="{{text_send_message}}"><i class="fa fa-envelope-o"></i></button>
                  </div>
                </div>
              </form>
              {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{{footer}}
<script type="text/javascript">
// Message Alert List
$('#alert-view-button').click(function() {
  localStorage.setItem('display', 'alert');
  $('#alert-view').removeClass('hide');
  $('#table-view').addClass('hide');
});

// Message Table Grid
$('#table-view-button').click(function() {
   localStorage.setItem('display', 'table');
    $('#table-view').removeClass('hide');
    $('#alert-view').addClass('hide');

});

if (localStorage.getItem('display') == 'alert') {
  $('#alert-view').removeClass('hide');
} else {
  $('#table-view').removeClass('hide');
}

$('.date').datetimepicker({
  pickTime: false,
  format:"YYYY-MM-DD"
});

function clrfilter() {
  location = 'index.php?route=catalog/wk_quotes_admin/update&user_token={{user_token}}&id={{result_quoteadmin.id}}';

  localStorage.setItem('tab', 'tab-messages');

}

function filter() {
  url = 'index.php?route=catalog/wk_quotes_admin/update&user_token={{user_token}}';

  var filter_name = $('select[name=\'filter_name\']').val();

  if (filter_name != '*') {
    url += '&filter_name=' + encodeURIComponent(filter_name);
  }

  var filter_message = $('input[name=\'filter_message\']').val();

  if (filter_message) {
    url += '&filter_message=' + encodeURIComponent(filter_message);
  }

  var filter_date = $('input[name=\'filter_date\']').val();

  if (filter_date) {
    url += '&filter_date=' + encodeURIComponent(filter_date);
  }

  url += "&id={{result_quoteadmin.id}}" ;

  localStorage.setItem('tab', 'tab-messages');

  location = url;
}

$(document).ready(function() {
  if(localStorage.getItem('tab')=='tab-messages' || '{{localStorage_tab}}'=='tab-messages'){
    $('a[href="#tab-messages"]').trigger('click');
    localStorage.setItem('tab', '');
  }
});
</script>

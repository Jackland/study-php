{{header}}{{column_left}}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
      </div>
      <h1>{{heading_title}}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{breadcrumb.href}}">{{breadcrumb.text}}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if  error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{error_warning}}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if  success %}
    <div class="alert alert-success"><i class="fa fa-check-circle"></i>{{success}}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-list"></i>{{text_list}}</h3>
      </div>
      <div class="panel-body">
        <div class="well">
            <div class="row">
              <div class="col-sm-4">
                <div class="form-group">
                  <label class="control-label" for="input-id">{{text_id}}</label>
                  <input type="text" name="filter_id" value="{{filter_id}}" placeholder="{{text_id}}" id="input-id" class="form-control" />
                </div>
                <div class="form-group">
                  <label class="control-label" for="input-status">{{text_status}}</label>
                  <select name="filter_status" class="form-control" id="input-status">
                    <option value="*">  </option>
                    {% if quote_status %}
                      {% for key, status_value in quote_status %}
                        <option value="{{key}}" {% if filter_status == key%}{{'selected'}}{% endif %}>{{status_value}}</option>
                      {% endfor %}
                    {% endif %}
                  </select>
                </div>
                <div class="form-group">
                  <label class="control-label" for="input-date">{{text_date}}</label>
                  <div class="input-group datetime">
                    <input type="text" name="filter_date" data-date-format="YYYY-MM-DD" class="form-control datetime" value="{{filter_date}}" id="input-date"/>
                    <span class="input-group-btn"><button class="btn btn-default"><i class="fa fa-calendar"></i></button></span>
                  </div>
                </div>
              </div>
              <div class="col-sm-4">
                <div class="form-group">
                  <label class="control-label" for="input-customer">{{text_customer_name}}</label>
                  <input type="text" name="filter_customer" value="{{filter_customer}}" placeholder="{{text_customer_name}}" id="input-customer" class="form-control" />
                </div>
                <div class="form-group">
                  <label class="control-label" for="input-price">{{text_quotes_price}}</label>
                  <input type="text" name="filter_price" value="{{filter_price}}" placeholder="{{text_quotes_price}}" id="input-price" class="form-control" />
                </div>
              </div>
              <div class="col-sm-4">
                <div class="form-group">
                  <label class="control-label" for="input-order">{{text_product_name}}</label>
                  <input type="text" name="filter_product" value="{{filter_product}}" placeholder="{{text_product_name}}" id="input-order" class="form-control" />
                </div>
                <div class="form-group">
                  <label class="control-label" for="input-qty">{{text_quantity}}</label>
                  <input type="text" name="filter_qty" value="{{filter_qty}}" placeholder="{{text_quantity}}" id="input-qty" class="form-control" />
                </div>
                <a onclick="filter();" class="btn btn-primary pull-right">{{button_filter}}</a>
                <a onclick="clrfilter();" class="btn btn-primary pull-right" style="margin-right:10px;">{{button_clrfilter}}</a>
              </div>
            </div>
          </div>
          <form action="{{delete}}" method="post" enctype="multipart/form-data" id="form-product">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <td width="1" style="text-align: center;"><input type="checkbox" onclick="$('input[name*=\'selected\']').attr('checked', this.checked);" /></td>
                    <td class="text-left">
                        {% if  sort == 'pq.id' %}
                          <a href="{{sort_id}}" class="{{order|lower}}">{{text_id}}</a>
                         {% else %}
                          <a href="{{sort_id}}" >{{text_id}} </a>
                          {% endif %}
                    </td>

                    <td class="text-left">
                        {% if  sort == 'c.firstname' %}
                          <a href="{{sort_customer}}" class="{{order|lower}}">{{text_customer_name}}</a>
                         {% else %}
                          <a href="{{sort_customer}}" >{{text_customer_name}} </a>
                          {% endif %}
                    </td>

                    <td class="text-left">
                       {% if  sort == 'pq.product_id' %}
                          <a href="{{sort_product}}" class="{{order|lower}}">{{text_product_name}}</a>
                         {% else %}
                          <a href="{{sort_product}}" >{{text_product_name}} </a>
                          {% endif %}
                    </td>
                    <td class="text-left">
                      {% if  sort == 'pq.quantity' %}
                        <a href="{{sort_qty}}" class="{{order|lower}}">{{text_quantity}}</a>
                       {% else %}
                        <a href="{{sort_qty}}" >{{text_quantity}} </a>
                        {% endif %}
                    </td>
                    <td class="text-left">
                      {% if  sort == 'pq.price' %}
                        <a href="{{sort_price}}" class="{{order|lower}}">{{text_quotes_price}}</a>
                       {% else %}
                        <a href="{{sort_price}}" >{{text_quotes_price}} </a>
                        {% endif %}
                    </td>
                    <td class="text-left">
                      {% if  sort == 'pq.status' %}
                        <a href="{{sort_status}}" class="{{order|lower}}">{{text_status}}</a>
                       {% else %}
                        <a href="{{sort_status}}" >{{text_status}} </a>
                        {% endif %}
                    </td>
                    <td class="text-left">
                      {% if  sort == 'pq.date_added' %}
                        <a href="{{sort_date}}" class="{{order|lower}}">{{text_date}}</a>
                       {% else %}
                        <a href="{{sort_date}}" >{{text_date}} </a>
                        {% endif %}
                    </td>
                    <td class="text-center">{{text_action}}</td>
                  </tr>
                </thead>

                {% if result_quotelist %}
                {% for result in result_quotelist %}
                <tbody>
                  <tr>
                    <td style="text-align: center;">{% if  result.selected %}
                      <input type="checkbox" name="selected[]" value="{{result.id}}" checked="checked" />
                      {% else %}
                      <input type="checkbox" name="selected[]" value="{{result.id}}" />
                      {% endif %}
                    </td>
                    <td class="text-left">{{result.id}}</td>
                    <td class="text-left">{{result.customer_name}}</td>
                    <td class="text-left">{{result.name}}</td>
                    <td class="text-left">{{result.quantity}}</td>
                    <td class="text-left">{{result.price}}</td>
                    <td class="text-left">
                      {% set statusClass = (result['status']==0 ? 'text-warning' : (result['status']==1 ? 'text-success' : (result['status']==2 ? 'text-danger' : (result['status']==3 ? 'text-info' : 'text-danger'))))%}


                      <span class="{{statusClass}}">{{result.status_text}}</span>
                    </td>

                    <td class="text-left" id="rma_date">{{result.date}}</td>
                    <td class="text-center">
                      <a href="{{result.action.href}}" class="btn btn-primary" data-toggle="tooltip" title="{{result.action.text }}"><i class="fa fa-eye"></i></a>
                    </td>
                  </tr>
                </tbody>
                {% endfor %}
                  {% else %}
                <tbody>
                  <tr>
                    <td colspan="9" class="text-center">{{text_no_recored}}</td>
                  </tr>
                </tbody>
                {% endif %}
              </table>
            </div>
          </form>
        {#分页#}
        <div class="row">
          <div class="col-sm-12">
            <div class="pull-left">
              {#左侧删除#}
              <div class="table-bottom-action">
                <div class="bottom-action-left">
                  <i class="fa fa-right-angle"></i>
                  <button type="button" data-toggle="tooltip" title="{{button_delete}}" class="btn btn-danger" onclick="confirm('{{text_confirm}}') ? $('#form-product').submit() : false;"><i class="fa fa-trash-o"></i></button>
                  <span class="bottom-action-detail"></span>
                </div>
              </div>
            </div>
            <div class="pull-right">{{ pagination }}</div>
          </div>
        </div>


      </div>
    </div>
  </div>
</div>
{{footer}}
<script type="text/javascript">
$('.row input').keydown(function(e) {
  if (e.keyCode == 13) {
    filter();
  }
});

$('.datetime').datetimepicker({
  pickTime: false
});

function clrfilter() {
  location = '{{action}}';
}

function filter() {
  url = '{{action}}';

  var filter_id = $('input[name=\'filter_id\']').val();

  if (filter_id) {
    url += '&filter_id=' + encodeURIComponent(filter_id);
  }

  var filter_customer = $('input[name=\'filter_customer\']').val();

  if (filter_customer) {
    url += '&filter_customer=' + encodeURIComponent(filter_customer);
  }

  var filter_product = $('input[name=\'filter_product\']').val();

  if (filter_product) {
    url += '&filter_product=' + encodeURIComponent(filter_product);
  }

  var filter_qty = $('input[name=\'filter_qty\']').val();

  if (filter_qty) {
    url += '&filter_qty=' + encodeURIComponent(filter_qty);
  }

  var filter_price = $('input[name=\'filter_price\']').val();

  if (filter_price) {
    url += '&filter_price=' + encodeURIComponent(filter_price);
  }

  var filter_status = $('select[name=\'filter_status\']').val();

  if (filter_status != '*') {
    url += '&filter_status=' + encodeURIComponent(filter_status);
  }

  var filter_date = $('input[name=\'filter_date\']').val();

  if (filter_date) {
    url += '&filter_date=' + encodeURIComponent(filter_date);
  }

  location = url;
}

$('input[name=\'filter_product\']').autocomplete({
  'source': function(request, response) {
    $.ajax({
      url: 'index.php?route=catalog/product/autocomplete&user_token={{user_token}}&filter_name=' +  encodeURIComponent(request),
      dataType: 'json',
      success: function(json) {
        response($.map(json, function(item) {
          return {
            label: item['name'],
            value: item['product_id']
          }
        }));
      }
    });
  },
  'select': function(item) {
    $('input[name=\'filter_product\']').val(item['label']);
  }
});

$('input[name=\'filter_customer\']').autocomplete({
  'source': function(request, response) {
    $.ajax({
      url: 'index.php?route=sale/customer/autocomplete&user_token={{user_token}}&filter_name=' +  encodeURIComponent(request),
      dataType: 'json',
      success: function(json) {
        response($.map(json, function(item) {
          return {
            label: item['name'],
            value: item['customer_id']
          }
        }));
      }
    });
  },
  'select': function(item) {
    $('input[name=\'filter_customer\']').val(item['label']);
  }
});
</script>

{% trans_default_category 'catalog/view/customerpartner/warehouse/inventory' %}
{{ header }}
{{ separate_column_left }}
{{ jsOrigin(['catalog/view/javascript/datetimepicker/bootstrap-datetimepicker.min.js']) }}
{{ cssOrigin(['catalog/view/javascript/datetimepicker/css/bootstrap-datetimepicker.min.css']) }}
{{ css(['css/common/common.css']) }}
<link href="/catalog/view/theme/yzcTheme/stylesheet/customerpartner/warehouse/inventory_manage_list.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="/catalog/view/javascript/bootstrap-table/bootstrap-table.min.css">
<script src="/catalog/view/javascript/bootstrap-table/bootstrap-table.min.js"></script>
<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<div class="container-fluid" id="content" style="margin-left: 235px;">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
    <h1>{{ __('盘亏管理') }}
    </h1>
  <div class="main">
      <div class="inventory-manage-box box-shadow" style="margin-right: 0;padding-bottom: 20px">
          {#     筛选条件     #}
          <div class="search-info padding19">
              <div class="row">
                  <div class="col-sm-4">
                      <div class="form-group">
                          <label class="control-label" for="itemCode">Item Code/MPN</label>
                          <input type="text" autocomplete="off" name="itemCode" id="itemCode" class="form-control" maxlength="64" placeholder="Item Code/MPN" >
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <div class="form-group">
                          <label class="control-label" for="status">{{__('处理状态')}}</label>
                          <select name="status" id="status" class="form-control">
                              <option value="">{{ __('所有') }}</option>
                            {% for key,item in status %}
                              <option value="{{ key }}">{{ item }}</option>
                            {% endfor %}
                          </select>
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <div class="form-group">
                          <label class="control-label" for="status">{{ __('生成日期') }}</label>
                          <div class="inventory-flex">
                              <div class="input-group datetime col-sm-6" id="datetimepicker1">
                                  <input type="text" name="startTime" class="form-control date_from" placeholder="{{ __('选择日期') }}" id="startTime"
                                         style="border-bottom-right-radius: 0!important;border-top-right-radius: 0!important;">
                                  <span class="input-group-addon "><i class="fa fa-calendar"></i></span>
                              </div>
                              <div class="input-group datetime col-sm-6" id="datetimepicker1">
                                  <input type="text" name="endTime" class="form-control date_to" placeholder="{{ __('选择日期') }}" id="endTime"
                                         style="border-bottom-right-radius: 0!important;border-top-right-radius: 0!important;">
                                  <span class="input-group-addon "><i class="fa fa-calendar"></i></span>
                              </div>
                          </div>

                      </div>
                  </div>
              </div>
              <div class="row">
                  <div class="col-sm-12">
                      <div class="form-group pull-right ">
                          <div class="">
                              <button type="button" class="btn btn-primary" id="filter" onclick="filter()" style="height: 40px">{{ __('查询') }} </button>
                          </div>
                      </div>
                  </div>
              </div>
          </div>

          {#     表格列表     #}
          <table id="tableList"></table>
      </div>
  </div>

</div>
{{ footer }}

<style>
    .pagination{
        display: block;
    }
</style>
<script>

    // 初始化
    $(function () {
        var date = new Date();
        date.setTime(date.getTime()+24*60*60*1000);
        // 日期初始化
        $('#startTime').datetimepicker({
            format: 'yyyy-mm-dd 00:00:00',
            minView: 2,
            autoclose: true,
            forceParse: true,
        });
        $('#endTime').datetimepicker({
            format: 'yyyy-mm-dd 23:59:59',
            minView: 2,
            autoclose: true,
            forceParse: true,
        });

        initTable();

    });

    // 初始化表格
    function initTable() {
        // 销毁
        $("#tableList").bootstrapTable('destroy');
        // 初始化表格
        $("#tableList").bootstrapTable({
            url:'{{ url('customerpartner/warehouse/inventory_loss/getList') }}',
            sidePagination: "server",
            pagination: true,
            pageNumber: 1,
            pageSize: 15,
            pageList: [5, 15, 20, 50, 100],
            formatLoadingMessage: function () {
                return '{{ __('加载中，请稍等') }}';
            },
            formatNoMatches:function () {
                return '{{ __('无数据') }}';
            },
            queryParams: function (params) {
                let data = {};
                data['page'] = (params['offset'] / params['limit'] + 1);
                data['page_limit'] = params['limit'];
                data = $.extend(data, getQueryParam());
                return data;
            },
            columns: [
                {
                    title: 'No.',
                    formatter: function (value, row, index) {
                        return index+1;
                    },
                    align:'center',
                },
                {
                    field: 'batch_number',
                    title: '{{ __('批次号') }}',
                    align:'center',
                },
                {
                    field: 'status_show',
                    title: '{{ __('处理状态') }}',
                    align:'center',
                },
                {
                    field: 'qty',
                    title: '{{ __('盘亏Item数量') }}',
                    align:'center',
                },
                {
                    field: 'create_time',
                    title: '{{ __('生成日期') }}',
                    align:'center',
                },
                {
                    field: 'remark',
                    title: '{{ __('备注') }}',
                    align:'center',
                    formatter:function (value) {
                        return `<a  class="overflow-text" data-toggle="tooltip" title="${value}" data-html="true">${value}</a>`;
                    }
                },
                {
                    title: '{{ __('操作') }}',
                    align:'center',
                    formatter:function (value,row) {
                        var url = '{{ url('customerpartner/warehouse/inventory_loss/view') }}'+'&inventory_id='+row.inventory_id;
                        if(row.status!=5){

                            return '<a class="btn btn-default" href="'+url+'" data-toggle="tooltip" title="{{ __('查看') }}"><i class="giga icon-chakan1"></i></a>';
                        }else{
                            var url2 = '{{ url('customerpartner/warehouse/inventory_loss/view') }}'+'&page_type=edit&inventory_id='+row.inventory_id
                            return '<div><a type="button" href="'+url+'" class="btn btn-default" data-toggle="tooltip" title="{{ __('查看') }}"><i class="giga icon-chakan1"></i></a>'+
                                '<a type="button" href="'+url2+'" class="btn btn-default marL20" data-toggle="tooltip" title="{{ __('编辑') }}"><i class="giga icon-edit"></i></a></div>';
                        }

                    }
                }
            ]
        })
    };

    // 查询
    function filter() {
        initTable();
    }

    // 获取筛选条件
    function getQueryParam() {
          let data = {
              sku_or_mpn: $("#itemCode").val().trim(),
              status: $("#status").val(),
              create_time_start: $("#startTime").val(),
              create_time_end: $("#endTime").val()
          };
        return data;
    }

    // 查看详情页
    function showDetail(inventory_id) {
      location.href='{{ url('customerpartner/warehouse/inventory_loss/view') }}'+'&inventory_id='+inventory_id
    }

    // 编辑详情
    function showEdit(inventory_id) {
      location.href='{{ url('customerpartner/warehouse/inventory_loss/view') }}'+'&page_type=edit&inventory_id='+inventory_id
    }

</script>

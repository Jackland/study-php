{{ header }}
{{ separate_column_left }}
<style>

  .credit {
    text-align: center;

  }

  .credit h2 {
    font-size: 16px;
    color: #aaa;
    font-weight: bold;
  }

  .credit span {
    font-size: 25px;
    font-weight: bold;
  }

  .apply p {
    text-align: center;
    margin: 25px 0px;
    font-size: 16px;
    color: #b6b6b6;
  }
</style>
<script type="text/javascript" src="/catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<script type="text/javascript" src="catalog/view/javascript/layer/layer.js"></script>
<div class="container-fluid"  id="content" style="margin-left: 16%">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
  <div class="row">
    <h1>Credit Authorization Management
      {% if(first_apply.status==5) %}
        <div class="pull-right" style="margin-right: 20px;">
          <a class="btn btn-light" href="index.php?route=customerpartner/credit_manage/editApply&type=detail"  data-toggle="tooltip" data-original-title="View credit authorization details." style="background: #fff;color: #000;" >VIEW CREDIT INFO</a>
          {% if last_apply.status in [3, 5] %}
            <a href="index.php?route=customerpartner/credit_manage/tiApply&type=ti" class="btn btn-default"  data-toggle="tooltip"  data-original-title="Request for increasing credit or having longer credit term." > CREDIT REQUEST</a>
          {% endif %}
          {% if last_apply.status in [1,6,7] %}
            <a href="index.php?route=customerpartner/credit_manage/editApply&type=ti" class="btn btn-default" > EDIT REQUEST</a>
          {% endif %}
        </div>
      {% endif %}
    </h1>
    <div class="panel panel-default" id="box-shadow">
      <div class="panel-body">
        <div class="tab-content">
          <div class="tab-pane active">
            <div class="well form-wrapper">
              <div class="row credit">
                <div class="col-sm-4 ">
                  <h2>Remaining Balance</h2>
                  <span style="color: #70D405">{% if credit %}{{ balance_credit }} {% else %}{{currency}} {% endif %}</span>
                </div>
                <div class="col-sm-4 ">
                  <h2>Used</h2>
                  <span style="color: #F59B25">{% if credit %}{{ pay_credit }} {% else %}{{currency}} {% endif %} </span>
                </div>
                <div class="col-sm-4">
                  <h2>Total Credit</h2>
                  {% if credit %}
                    <span style=" color:{% if can_credit %} #193564 {% else %}#9A9A9A {% endif %}">{{ credit.credit_amount }}</span>
                  {% else %}
                    <span style=" color:#193564"> {{ currency }}</span>
                  {% endif %}
                </div>
              </div>
              <div class="row apply">
                {% if(first_apply) %}
                  {% if(first_apply.status in [1,2,4,8]) %}
                    <p class="">The Giga Cloud Marketplace is reviewing your credit authorization application,<a href="index.php?route=customerpartner/credit_manage/editApply&type=edit"> please click here for details.</a></p>
                  {% elseif(first_apply.status in [6,7]) %}
                    <p class="">Your credit authorization application has been declined. <a href="index.php?route=customerpartner/credit_manage/editApply&type=edit">Please click here for details.</a></p>
                  {% endif %}
                {% else %}
                  <p class=""> Credit authorization has not be enabled. <a href="index.php?route=customerpartner/credit_manage/addApply&type=add">Please click here to apply.</a></p>
                {% endif %}
              </div>
              {% if(first_apply.status==5) %}
              <div class="row">
                <div class="col-sm-4">
                  <div class="form-group ">
                    <label class="control-label col-sm-10" for="input-date-from">Time</label>
                    <div class="input-group date col-sm-6 pull-left">
                      <input type="text" name="filter_date_from" value="{{ params.date_from }}" data-date-format="YYYY-MM-DD 00:00:00" placeholder="Pick a date..."
                             id="date-from" class="form-control "/>
                      <span class="input-group-btn">
                                <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                          </span>

                    </div>
                    <div class="input-group col-sm-6 date pull-left">
                      <input type="text" name="filter_date_to" value="{{ params.date_to }}" data-date-format="YYYY-MM-DD 23:59:59" placeholder="Pick a date..." id="date-to"
                             class="form-control date"/>
                      <span class="input-group-btn">
                                <button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
                            </span>
                    </div>
                  </div>
                </div>

                <div class="col-sm-4">
                  <div class="form-group ">
                    <label class="control-label" for="input-nickname">Tracking number</label>
                    <input type="text" name="serial_no" value="{{ params.serial_no }}" placeholder="Enter number here" id="serial_no" class="form-control"/>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label">STATUS</label>
                    <select id="type" class="form-control">
                      <option value="">-- {{ __('请选择', {}, 'common') }} --</option>
                      <option {% if params.type==1 %} selected {% endif %} value="1"> Out</option>
                      <option {% if params.type==2 %} selected {% endif %} value="2"> In</option>
                    </select>
                  </div>

                  <div class="form-group" style="padding-top: 37px;text-align: right">
                    <a onclick="filter();" class="btn btn-primary">{{ button_filter }}</a>
                    <a onclick="refilter();" class="btn btn-default" title="Reset"> Reset </a>
                  </div>
                </div>
              </div>
            </div>
            <table class="table  table-hover">
              <thead>
              <tr>
                <td class="text-left">Tracking Number</td>
                <td class="text-left">Time</td>
                <td class="text-left">Action</td>
                <td class="text-left">Status</td>
                <td class="text-left">Credit changed</td>
                <td class="text-left">Balance</td>
              </tr>
              </thead>
              <tbody>
              {% if bills %}
                {% for bill in bills %}
                  <tr>
                    <td class="text-left">{{ bill.serial_no }}</td>
                    <td class="text-left">{{ bill.create_time }}</td>
                    <td class="text-left">{{ bill.introduce }}</td>
                    <td class="text-left">
                      {% if(bill.type==1) %}
                        OUT
                      {% else %}
                        IN
                      {% endif %}
                    </td>
                    <td class="text-left">
                      {% if(bill.type==1) %}
                        -
                      {% else %}
                        +
                      {% endif %}
                      {% if is_japan %}
                        {{ bill.amount|round }}
                      {% else %}
                        {{ bill.amount }}
                      {% endif %}
                    </td>
                    <td class="text-left">
                      {% if is_japan %}
                        {{ bill.current_balance|round }}
                      {% else %}
                        {{ bill.current_balance }}
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td class="text-center" colspan="12">{{ text_no_results }}</td>
                </tr>
              {% endif %}
              </tbody>
            </table>
            {{ page_view }}
            {% endif %}
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
{{ footer }}
<script>
    $('#date-from').datetimepicker({
        pickDate: true,
        pickTime: false
    });
    $('#date-to').datetimepicker({
        pickDate: true,
        pickTime: false
    });


    function refilter() {
        location.href = "index.php?route=customerpartner/credit_manage";
    }

    function handlePage(event, originalEvent, type, page) {
        filter(page, originalEvent.page_info);
    }

    function filter(page, page_info) {
        var date_from = $("#date-from").val();
        var date_to = $("#date-to").val();
        var type = $("#type").val();
        var serial_no = $("#serial_no").val();
        var url = "index.php?route=customerpartner/credit_manage";
        if (serial_no) {
            url += "&serial_no=" + serial_no;
        }
        if (date_from) {
            url += "&date_from=" + date_from;
        }
        if (date_to) {
            url += "&date_to=" + date_to;
        }
        if (type) {
            url += "&type=" + type;
        }
        if (page) {
            url += "&page=" + page;
        }
        if (page_info) {
            for (let i in page_info) {
                url += '&' + i + '=' + page_info[i];
            }
        }
        location.href = url;
    }
</script>

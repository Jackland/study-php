<style>

  .text-center .btn-primary{
    border: #eee;
    color: #333;
    background-color: #eee;
    width: 30px;
    height: 30px;
    padding: 6px 0;
  }
  .text-center .btn-primary:hover{
    color: #fff;
    background-color: #FA6400;
    border: #fff;
  }
  /* 左侧标题栏 */
  .left-ul li a:hover{
    color: #FF5722;
  }
  .table tbody tr td .btn:hover{
    border: 1px solid #FA6400;
  }
</style>
<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<script src="catalog/view/javascript/jquery/magnific/jquery.magnific-popup.min.js" type="text/javascript"></script>
<link href="catalog/view/javascript/jquery/magnific/magnific-popup.css" type="text/css" rel="stylesheet"/>
<style>
  .header-right-dot {
    position: relative;
    display: inline-block;
    font-size: 12px;
    text-align: center;
    background-color: #FF5722;
    color: #fff;
    width: 6px;
    height: 6px;
    padding: 0;
    border-radius: 50%;
    top: -5px;
    margin: -7px 3px 0 1px;
  }
  .row .form-group input:not([type=checkbox]):not([type=radio]), .row .form-group select {
    height: 40px !important;
    border-radius: 4px !important;
    background-color: #f3f5f7;
  }
  .table tbody tr td .btn:hover{
    border: 1px solid #FA6400;
  }
  .text-center .btn-primary{
    border: 1px solid #eee;
  }
</style>

<div role="tabpanel" class="tab-pane active">
  <div class="bg-white p-2" id="leave" style="display: flex">
{#左侧列表#}
<div class="ticket-lists-left col-sm-2">
    <ul class="left-ul">
      {% for item in left_lists %}
        <li class="{% if right==item.value %}li-active{% endif %}">
          <a class="tickek-right-type-warehouses" href="javascript:void(0);" value="&right={{ item.value }}">
            {{ item.name }}({{ item.count }})
            {% if item.isNoread  %}
              <span class="header-right-dot"></span>
            {% endif %}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>

  {#右侧列表#}
  <div class="table-responsive ticket-lists-right col-sm-10">
    <form class="ticket-lists-right-form form-inline">
        <div class="form-group " style="width: 80%;">
            <input id="wdOrdersWarehouses" type="text" style="width: 100%;font-size: 13px" class="form-control input-search-rma" placeholder="Search Request ID {% if submit_ticket_for==9 and (right ==20 or right == 'newreply' or right == 'alltickets') %}/ RMA ID / Item Code{% endif %}" value="{{ wd }}">
        </div>
      <button type="button" id="btnSearch" class="btn btn-submit" style="margin-left: 15px;height: 40px;line-height: 22px;font-size: 14px" onclick="filterWarehouses(this)">Filter</button>
    </form>

    <table class="table table-hover" style="margin-top: 20px">
      <thead>
      <tr>
        <th class="text-center">{{ column_ticket_id_long }}</th>
        <th class="text-center">{{ column_ticket_type }}</th>
        {% if submit_ticket_for==9 and (right ==20 or right == 'newreply' or right == 'alltickets') %}
          {#需求101962调整列#}
          <th class="text-center">{{ column_rma_id }}</th>
          <th class="text-center">{{ column_item_code }}</th>
        {% endif %}
        <th class="text-center">
          {% if sort=='date_modified' %}
            <a href="javascript:void(0);" value="{{ sort_date_modified }}" class="ticketClickSortWarehouses {{ order|lower }}">{{ column_date_modified }}</a>
          {% else %}
            <a href="javascript:void(0);" value="{{ sort_date_modified }}" class="ticketClickSortWarehouses">{{ column_date_modified }}</a>
          {% endif %}
        </th>
        <th class="text-center">
          {% if sort=='customer_is_read' %}
            <a href="javascript:void(0);" value="{{ sort_customer_is_read }}" class="ticketClickSortWarehouses {{ order|lower }}">{{ column_status }}</a>
          {% else %}
            <a href="javascript:void(0);" value="{{ sort_customer_is_read }}" class="ticketClickSortWarehouses">{{ column_status }}</a>
          {% endif %}
        </th>
        <th class="text-center">{{ column_action }}</th>
      </tr>
      </thead>
      <tbody>

      {% if lists %}
        {% for item in lists %}
          <tr>
            <td class="text-center">{{ item.ticket_id }}</td>
            <td class="text-center">{{ item.ticket_type_name }}</td>
            {#需求101962调整列 start#}
            {% if submit_ticket_for==9 and (right ==20 or right == 'newreply' or right == 'alltickets') %}
              <td class="text-center">
                {% if item.rma_id %}
                  <a href="{{ item.rma_url }}">{{ item.rma_id }}</a>
                {% else %}
                  --
                {% endif %}
              </td>
              <td class="text-center">
                {% if item.sales_item_code %}
                  {{ item.sales_item_code }}
                {% else %}
                  --
                {% endif %}
              </td>
            {% endif %}
            {#需求101962调整列 end#}
            <td class="text-center">{{ item.last_modified_time_format }}</td>
            <td class="text-center">
              {% if item.customer_is_read == 0 %}
                <span class="glyphicon glyphicon-exclamation-sign hot-color"></span>
              {% endif %}
              {{ item.status_name }}
            </td>
            <td class="text-center">
              <a href="{{ item.view_url }}" data-toggle="tooltip" title="{{ button_view }}"
                 class="btn btn-primary pull-center" style="padding: 0;line-height: 28px;"><i class="giga icon-chakan1"></i></a>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td class="text-center" colspan="7">{{ text_no_results }}</td>
        </tr>
      {% endif %}
      </tbody>
    </table>

    <div class="row text-right" style="margin-right: 0">
      <ul id="bos_pagination_ticket_warehouses"></ul>
    </div>
</div>
  </div>
</div>

<textarea id="categoryRootidJsonWarehouses" style="display: none;">{{ categoryRootid }}</textarea>
<textarea id="culsterCountJsonWarehouses" style="display: none;">{{ culsterCountJson }}</textarea>

<script>
    $(function () {
        block.unBlockUI();
        initTicketWarehouses();
    });

    function initTicketWarehouses() {
        //分页链接
        paginationWarehouses();

        upTicketTabCountWarehouses();
    }

    $(document).ready(function () {
        $(document).off(".tickek-right-type-warehouses");
        $(document).off(".ticketClickSortWarehouses");

        $(".tickek-right-type-warehouses").click(function () {
            let that = this;
            block.blockUI();

            $("#wdOrdersWarehouses").val("");

            $(".tickek-right-type-warehouses").parent().each(function (index, Ele) {
                $(Ele).removeClass('li-active');
            });
            $(that).parent().addClass('li-active');

            var url = getUrlForTicketWarehouses();
            $('#show-lists-warehouses').load(url);
        });

        $(".ticketClickSortWarehouses").click(function(){
            let that = this;
            block.blockUI();

            let url = getUrlForTicketWarehouses();
            let thatVal = $(that).attr('value');
            let thatOrder = $(that).hasClass("asc")?'asc':'desc';

            $(".ticketClickSortWarehouses").removeClass('asc').removeClass('desc');
            $(that).addClass(thatOrder == 'asc' ? 'asc' : 'desc');

            url += thatVal;

            $('#show-lists-warehouses').load(url);
        });

       $("#wdOrdersWarehouses").keydown(function (e) {
         if (e.keyCode == 13) {
           filterWarehouses($('#btnSearch'))
           return false;
         }
       });
    });

    function upTicketTabCountWarehouses(){
        let categoryRootidJsonWarehouses = {};
        let culsterCountJsonWarehouses = {};
        if ($("#categoryRootidJsonWarehouses").val()) {
          categoryRootidJsonWarehouses = JSON.parse($("#categoryRootidJsonWarehouses").val());
        }
        if ($("#culsterCountJsonWarehouses").val()) {
          culsterCountJsonWarehouses = JSON.parse($("#culsterCountJsonWarehouses").val());
        }
      $(".submit_ticket_for_count_{{ submit_ticket_for }}" ).find('span.count').html(culsterCountJsonWarehouses['new_reply_count']);
        // for (var i in categoryRootidJsonWarehouses) {
        //     var category_id = categoryRootidJsonWarehouses[i];
        //     var tele = $(".submit_ticket_for_count_" + category_id);
        //     var count = culsterCountJsonWarehouses['submit_ticket_for_count_' + category_id];
        //     var noread = culsterCountJsonWarehouses['submit_ticket_for_noread_' + category_id];
        //
        //     var str = '' + count + '';
        //     if (noread) {
        //         str += '<span class="header-right-dot"></span>';
        //     }
        //     $(tele).find('span.count').html(str);
        // }
    }

    function paginationWarehouses() {
        if ({{ total_pages }}) {
            //total_pages
            $('#bos_pagination_ticket_warehouses').bootstrapPaginator({
                /*当前使用的是3版本的bootstrap*/
                bootstrapMajorVersion: 3,
                /*配置的字体大小是小号*/
                size: 'normal',
                /*当前页*/
                currentPage: {{ page_num }},
                /*一共多少页*/
                totalPages: {{ total_pages }},
                /*页面上最多显示几个含数字的分页按钮*/
                numberOfPages: 5,
                /*设置显示的样式，默认是箭头	*/
                // itemTexts: function(type, page, current) {
                //     switch(type) {
                //         case "first": // type值固定
                //             return `<span class="glyphicon glyphicon-fast-backward"></span>`;
                //         case "prev":
                //             return `<span class="glyphicon glyphicon-step-backward"></span>`;
                //         case "next":
                //             return `<span class="glyphicon glyphicon-step-forward"></span>`;
                //         case "last":
                //             return `<span class="glyphicon glyphicon-fast-forward"></span>`;
                //         case "page":
                //             return page;
                //     }
                // },
                total: {{ total_num }},
                rowsOfPage: {{ page_limit }},
                onPageClicked: function (event, originalEvent, type, page) {
                    block.blockUI();
                    let url = getUrlForTicketWarehouses(page);

                    //sort column
                    let sor = '';
                    $(".ticketClickSortWarehouses").each(function (index, ele) {
                        if ($(ele).hasClass("asc") || $(ele).hasClass("desc")) {
                            let ord = $(ele).hasClass("asc") ? "asc" : "desc";
                            sor = $(ele).attr("value");
                            url += (sor + "&order=" + ord);
                            return false;
                        }
                    });

                    $('#show-lists-warehouses').load(url);
                }
            });
        }
    }

    function getUrlForTicketWarehouses(page) {
        let url = 'index.php?route=account/ticket/showListsOthers';

        let submit_ticket_for = '{{ submit_ticket_for }}';
        url += '&submit_ticket_for={{ submit_ticket_for }}';

        let tickek_right_type_warehouses = '';
        $(".tickek-right-type-warehouses").parent().each(function (index, Ele) {
            if ($(Ele).hasClass('li-active')) {
                tickek_right_type_warehouses = $(Ele).find('a').attr('value')
                url += (tickek_right_type_warehouses);
                return false;
            }
        });

        let wd = $.trim($("#wdOrdersWarehouses").val());
        if(wd){
            url += '&wd='+wd;
        }

        if (page) {
            url += "&page_num=" + page;
        }
        return url;
    }

    function filterWarehouses(button) {
        block.blockUI();
        var url = getUrlForTicketWarehouses();
        $('#show-lists-warehouses').load(url);
        $(button).button('loading');
    }
</script>
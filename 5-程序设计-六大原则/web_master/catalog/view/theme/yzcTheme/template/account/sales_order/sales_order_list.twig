<link href="catalog/view/javascript/select2/css/select2.min.css" rel="stylesheet"/>
<link href="catalog/view/javascript/layer/theme/yzc/layuiOris.css" rel="stylesheet"/>
<script src="catalog/view/javascript/select2/js/select2.full.js"></script>
<link rel="stylesheet" href="catalog/view/javascript/bootstrap-select18/bootstrap-select.min.css">
<script type="text/javascript" src="catalog/view/javascript/bootstrap-select18/bootstrap-select.min.js"></script>
<link rel="stylesheet" href="catalog/view/javascript/datetimepicker/css/bootstrap-datetimepicker.min.css">
<script type="text/javascript" src="catalog/view/javascript/datetimepicker/bootstrap-datetimepicker.min.js"></script>

<style>
  /*salesOrder样式*/
  .form-wrapper .form-group {
    margin-bottom: 15px;
  }

  .select2-container .select2-selection--single {
    height: 34px;
    line-height: 34px;
  }

  .select2-container--default .select2-selection--single .select2-selection__rendered {
    line-height: 34px;
  }

  .all-LTL-confirm .layui-layer-content {
    padding: 0;
    text-align: center;
  }

  a img {
    margin-top: -3px;
  }

  .notice {
    height: 44px;
    background: rgb(252, 232, 200);
    border: 1px solid #FA6400;
    border-radius: 4px;
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding-left: 10px;
    margin-bottom: 20px;
  }

  .notice i {
    margin-right: 8px;
  }

  .form-wrapper .form-group > label {
    font-size: 14px;
    text-transform: capitalize;
    color: #333;
    font-weight: initial;
  }

  .form-wrapper .datetimepicker-range .datetimepicker span.icon i {
    font-size: 18px;
    line-height: 31px;
  }

  .quick-btns {
    height: 58px;
    display: flex;
    align-items: flex-end;
  }

  .quick-btn-item {
    color: #183464;
    margin-right: 20px;
  }

  .quick-btn-item:hover {
    cursor: pointer;
    text-decoration: underline;
  }

  .quick-block {
    overflow: hidden;
  }

  .quick-block p {
    text-align: center;
  }

  .quick-block-item {
    padding-top: 10px;
    display: inline-block;
    width: 16%;
  }

  .quick-block-item:hover {
    background: #eee;
    cursor: pointer;
  }

  .block-item {
    background: #eee;
  }

  .quick-block-item-active {
    background: #eee;
    cursor: pointer;
  }

  .border-right {
    border-right: 1px solid #eee;
  }

  .quick-title, .quick-number {
    color: #183464;
    padding-bottom: 10px;
    margin: 0;
  }

  .order-title-tip {
    display: flex;
    justify-content: space-between;
  }

  .quick-block {
    margin-bottom: 30px;
  }

  .order-title, .order-status {
    font-size: 15px;
    color: #333;
    font-weight: bolder;
    display: flex;
    align-items: center;
    height: 26px;
  }

  .order-status {
    color: #3A75DC;
  }

  .picture {
    margin-right: 8px;
    transition-duration: 0.5s;
  }

  .picture .big-img {
    display: none;
  }

  .picture:hover {
    cursor: pointer;
  }

  .picture:hover .big-img {
    display: block;
  }

  .flex-str {
    display: flex;
    justify-content: flex-start;
    align-items: center;
  }

  .order-des {
    max-width: 300px;
    margin-bottom: 8px;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    word-break: break-word;
  }

  .order-des:hover {
    color: #3A75DC;
    text-decoration: underline;
    cursor: pointer;
  }

  .my-action-btns {
    display: flex;
    justify-content: flex-start;
  }

  .action-btn, .btn-more {
    width: 30px;
    height: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #eee;
    border-radius: 4px;
    margin-right: 4px;
  }

  .action-btn:hover, .btn-more:hover {
    background: #FA6400;
    color: #fff;
  }

  .table > thead > tr > th, .table > tbody > tr > td {
    text-align: center;
  }

  .prd-tip {
    max-width: 300px;
    text-align: left;
    font-size: 12px;
    word-break: break-word;
  }

    .prd-tip span, .prd-tip a {
        font-size: 12px;
    }

  #tab_drop_shipping .table thead {
    background: #eee;
  }

  .order-list-item {
    position: relative;
  }

  .choose {
    height: 0;
    width: 0;
    overflow: hidden;
    font-size: 0;
    line-height: 0;
    border-color: rgba(0, 0, 0, .2) rgba(0, 0, 0, .2) transparent transparent;
    border-style: solid;
    border-width: 14px;
    position: absolute;
  }

  .choose, .my-agree {
    position: absolute;
    color: #fff;
    right: 0;
  }

  .choose.choosed {
    border-color: #FA6400 #FA6400 transparent transparent;
  }

  .choose:hover, .my-agree:hover {
    cursor: pointer;
  }

  i.icon-action-confirm-and-agree.my-agree {
    color: #fff;
    font-size: 12px;
    top: 0;
    right: 2px;
  }

  .choose-container, .choose-container-disabled {
    position: absolute;
    right: 0;
    top: 0;
  }

  .address-error {
    color: #e64545;

  }

  .address-change-error {
    color: #65B017;
  }

  .error-color {
    color: #FF414D;
    font-size: 12px;
  }

  .page-seller-portal .btn.btn-primary {
    border-color: #3A75DC;
  }

  .batch-btns {
    margin-top: 15px;
    padding: 4px 0;
    box-shadow: 0 -4px 8px rgba(0, 0, 0, .2);
    border-radius: 4px;
    position: fixed;
    bottom: 0;
    left: 0;
    z-index: 99;
    background: #fff;
    width: 100%;
  }

  .batch-btns button {
    vertical-align: middle;
    margin-right: 8px;
    font-size: 12px;
    font-weight: normal;
  }

  .hover-pointer:hover {
    cursor: pointer;
  }

  .address-tip, .amount-detail-tip {
    background: transparent;
    /*margin-left: 20px;*/
  }

  .page-seller-portal .btn.address-tip, .page-seller-portal .btn.amount-detail-tip {
    padding: 0;
    box-shadow: none;
    font-size: 14px;
    color: #333;
    font-weight: normal;
  }

  /*.page-seller-portal .btn.amount-detail-tip:hover{*/
  /*  color: #3A75DC;*/
  /*}*/
  .page-seller-portal .btn.address-tip i {
    font-size: 16px;
  }

  .total-amount .btn.amount-detail-tip{
    cursor:auto;
  }

  .page-seller-portal .btn.amount-detail-tip i {
    padding-left: 6px;
  }

  .popover-btn {
    text-align: center;
  }

  .old-address {
    background: #eee;
    padding: 2px;
    margin-bottom: 10px;
    word-break: break-all;

  }

  .popover {
    max-width: 400px;
  }

  .detail-price {
    width: 200px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 4px;
    margin-bottom: 4px;
    border-bottom: 1px solid #eee;
  }

  .has-sub-code:hover {
    color: #3A75DC;
    text-decoration: underline;
    cursor: pointer;
  }

  .no-item-code {
    color: #888;
  }

  .no-item-code:hover {
    color: #888;
    text-decoration: underline;
    cursor: pointer;
  }

  .dropdown-menu > li > a i {
    margin-right: 10px;
  }

  /*salesOrder样式*/

  /*salesOrder修改ui样式*/
  #tab_drop_shipping .popover {
    position: absolute;
    line-height: 24px;
    z-index: 999;
    display: none;
    color: #333;
    margin-top: 6px;
    background: #fff;
    border-radius: 6px;
    box-shadow: 0px 5px 14px 2px rgba(0, 0, 0, 0.3);
    text-align: left;
  }

  #tab_drop_shipping .popover.bottom {
    margin-top: 0;
  }

  .table-list-title {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 10px 0;
    background: #EEEEEE;
    width: 100%;
    margin-bottom: 6px;
  }

  .table-header {
    display: flex;
    justify-content: space-between;
    padding: 10px 20px 10px 10px;
    background: #ECF1FC;
    position: relative;
  }

  .to-be-paid {
    color: #FA6400;
  }

  .table-body-top, .table-body-left-item, .table-body-right {
    display: flex;
    justify-content: flex-start;
    align-items: center;
  }

  .table-body-top {
    border-bottom: 1px solid rgba(191, 212, 247, 1);
    border-top: 1px solid rgba(191, 212, 247, 1);
  }

  .table-body-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
  }

  .table-body-left {
    width: 90%;
    border-right: 1px solid rgba(191, 212, 247, 1);
  }

  .table-body-right {
    width: 10%;
  }

  .table-body-left-item {
    width: 100%;
  }

  .product-information {
    width: 30%;
    text-align: center;
    padding: 10px 8px;
  }

  .total-amount {
    width: 10%;
    text-align: center;
  }

  .purchase-order-id {
    width: 20%;
    text-align: center;
    cursor: pointer;
  }

  .purchase-order-id:hover {
    color: #3A75DC;
    text-decoration: underline;
  }

  .purchase-order-id span {
    display: inline-block;
    text-align: left
  }

  .pro-Rma {
    width: 13%;
    text-align: center;
    word-break: break-word;
  }

  .tracking-number {
    width: 22%;
    text-align: left;
  }

  .tracking-number .carrier-status {
    color: #3a75dc;
  }

  .tracking-number .carrier-status:hover {
    text-decoration: underline;
    cursor: pointer;
  }

  .grand-total {
    width: 100%;
    text-align: center;
  }

  .table-body-bottom-time {
    color: #888;
    font-size: 12px;
  }

  .page-seller-portal .btn.btn-default.btn-pay, .page-seller-portal .btn.btn-default.btn-pay:hover {
    color: #fff;
    background: #FA6400 !important;
    border-color: #FA6400 !important;
  }
  #listBatchCon .btn.btn-default.btn-pay{
    border-color: #FA6400 !important;
    background-color: #FFFFFF !important;
    color: #FA6400 !important;
    height: 36px;
    font-size: 12px;
  }
  #listBatchCon .btn.btn-default.btn-pay:hover{
    background-color: #FA6400 !important;
    color: #FFFFFF !important;
  }

  /*.table-body-left .table-body-left-item{*/
  /*  border-bottom: 1px solid rgba(191,212,247,1);*/
  /*}*/
  .table-body-left .table-body-left-item-outer {
    /*border-bottom: 1px solid rgba(191,212,247,1);*/
    padding-left: 10px;
  }

  .table-body-left .table-body-left-item:last-child {
    border-bottom: none;
  }

  .table-list-item {
    margin-bottom: 15px;
    border: 1px solid rgba(191, 212, 247, 1);
  }

  .has-code:hover {
    cursor: pointer;
    color: #3A75DC;
    text-decoration: underline;
  }

  .no-code {
    color: #888;
  }

  .save-back:hover, .save-work:hover {
    cursor: pointer;
    color: #3A75DC;
  }
  .page-seller-portal .btn.btn-default:not(.dropdown-toggle):hover{
    background: #3A75DC !important;
    border-color: #3A75DC !important;
    color: #fff;
  }

  .total-amount .popover-title {
    text-align: center;
    font-weight: bolder;
  }

  .table-body-left > div {
    border-bottom: 1px solid rgba(191, 212, 247, 1)
  }

  .table-body-left > div:last-child {
    border-bottom: none;
  }

  .pic-w-40{
    width: 40px;
    height: 40px;
  }

  /*salesOrder修改ui样式*/

  .property:hover {
    padding: 0 2px 0 5px;
    border: 1px dashed #ccc;
    cursor: pointer;
  }

  .property i {
    display: none;
  }

  .property:hover i {
    display: block;
  }

  .choose-container-disabled .tooltip {
    width: 300px;
  }

  /*公告滚动的样式*/
  #boxShow ul, #boxShow ul li {
    margin: 0;
    padding: 0
  }

  .notice-con {
    width: 1015px;
    height: 44px;
    overflow: hidden;
  }

  .notice-con ul li {
    list-style: none;
    line-height: 44px;
    display: block;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
  }

  /*公告滚动的样式*/
  /*按钮调整*/
  .page-seller-portal .btn.btn-default.btn-small {
    font-weight: normal;
    font-size: 12px;
    padding: 4px 10px;
    margin-left: 5px;
  }

  .page-seller-portal .btn.btn-default.btn-plain {
    color: #333;
  }

  .page-seller-portal .btn.btn-default.btn-plain:hover {
    color: #fff;
  }

  .page-seller-portal .btn.btn-default.btn-small {
    height: auto;
    line-height: inherit;
  }

  .page-seller-portal .btn.btn-default.btn-small:hover, .page-seller-portal .btn.btn-default.btn-small:focus {
    border: 1px solid #fa6400 !important;
    background: #fff !important;
    color: #fa6400 !important;
  }

  /*按钮调整*/
  #salesOrderListPanel ::-webkit-scrollbar {
    display: none;
  }

  .content-con-sub-title {
    color: #aaa;
    font-size: 12px;
  }
  .new-pagination .page-list, .new-pagination .page-info{
    top: 0;
  }
</style>
<style>
  /*这是修改地址的模态框样式*/
  .modal-title {
    font-size: 16px;
  }

  .modal-header .close {
    background-color: #183464;
  }

  .original-address-con {
    background: #eee;
    padding: 10px;
  }

  .original-address-con p {
    font-size: 12px;
  }

  .modal-sub-title {
    color: #FA6400;
    font-weight: bolder;
    margin-bottom: 2px;
  }

  .required:before {
    content: '*';
    color: #FF414D;
    margin-right: 4px;
  }

  .new-address-con {
    margin-top: 10px;
  }

  .mrt15 {
    margin-bottom: 15px;
  }

  #myModalModifyAddress .form-group > label {
    font-size: 12px;
    font-weight: normal;
    color: #333;
  }

  #myModalModifyAddress .form-group {
    margin-bottom: 5px;
  }


  .form-group .dropdown-menu.modify-country {
    width: calc(100% - 20px);
    margin: 0 0 0 10px;
    border-radius: 4px;
    box-shadow: none;
  }

  .modify-country-remove {
    position: absolute;
    right: 16px;
    top: 8px;
    display: none;
  }

  .modify-country-remove:hover {
    cursor: pointer;
    color: #3A75DC;
  }

  /*这是修改地址的模态框样式*/
</style>
<style>
  /*这是Send E-Mail的模态框样式*/
  .note {
    color: #FF414D;
  }

  .display-none {
    display: none;
  }

  /*这是Send E-Mail的模态框样式*/
  .mrl-20 {
    margin-left: 4px;
  }

  .position-top-2 {
    position: relative;
    top: -2px;
  }

  .handel-hover:hover {
    cursor: pointer;
  }
  .dropdown-menu.binding-record{
      width:400px ;
      left: auto;
      right: 0;
      padding: 12px 16px;
  }
  .text-small{
      font-size: 12px;
  }
  .binding-record .btn-rma{
      padding: 2px 6px;
      font-size: 12px;
  }
  .dropdown-menu.binding-record > table  tr:first-child td{
      border: none;
  }
  .page-seller-portal .btn.btn-default.btn-plain.btn-binding:focus{
      background-color: #FA6400;
      color: #fff;
  }

  /*id="listBatchCon" Select All 复选框样式*/
  input[type=checkbox] {
    position: relative;
    width: 15px;
    height: 15px;
    margin: 0 5px;
    vertical-align: sub;
  }
  input[type=checkbox]::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 15px;
    height: 15px;
    line-height: 15px;
    text-align: center;
    color: #FFFFFF;
    font-size: 14px;
    background-color: #fff;
    border: 1px solid #aaa;
  }
  input[type=checkbox]:checked::before {
    border: 1px solid #fa6400;
    content: '\e6ca';
    background-color: #fa6400;
    font-family: "gcl";
    font-size: 12px;
  }

  .bootstrap-select {
    position: relative;
  }

  .bootstrap-select .dropdown-menu {
    width: 100%;
  }
  .open > .dropdown-menu {
    display: block !important;
  }
  .form-group .form-control .bootstrap-select {
    background: #f3f5f7;
    border-radius: 4px;
    height: 40px;
    border-radius: 4px;
    background-color: #f3f5f7;
    border: 1px solid #ccc;
    font-size: 12px;
  }
  .form-group .bs-searchbox input {
    background: #fff !important;
    height: 32px !important;
  }
  .form-group .bs-searchbox input:focus {
    box-shadow: none !important;
  }
  .form-group .bootstrap-select button.dropdown-toggle{
    height: 40px !important;
    border-radius: 4px !important;
    background-color: #f3f5f7 !important;
    border: 1px solid #ccc !important;
    font-size: 12px !important;
  }
  .form-group .bootstrap-select button.dropdown-toggle:focus {
    outline: none !important;
    box-shadow: inset 0 1px 1px rgb(0 0 0 / 8%), 0 0 8px rgb(24 52 100 / 60%);
  }
  .form-group .bootstrap-select button.dropdown-toggle .filter-option-inner-inner{
    line-height: 26px !important;
    font-size: 12px;
    color: #333;
  }
  .form-group .bootstrap-select button.dropdown-toggle .bs-caret {
    color: #333;
  }
  .form-group .bootstrap-select ul.dropdown-menu {
    max-height: 280px !important;
    overflow-y: scroll;
  }
  .order-list .through-price {
      text-decoration: line-through;
      color: #888 !important;
      font-size: 0.9em !important;
  }
  /*保障服务*/
  .guarantee-service-main{
    position: relative;
  }
  .gurantee-service-pop-title{
    font-size: 13px;
    color: #333333;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
    font-weight: bold;
    padding: 10px 20px;
  }
  .service-list{
    padding: 0 20px 10px 20px;
  }
  .no-bottom{
    border-bottom:none;
  }
  .flex-start{
    display: flex;
    justify-content: flex-start;
    align-items: baseline;
  }
  .flex-between{
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .black-circle{
    display: inline-block;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #000;
    margin-right: 8px;
    position: relative;
    top: -2px;
  }
  .service-title{
    font-size: 14px;
    color: #333;
  }
  .leave-time{
    color: #405266;
    font-style: italic;
    font-size: 12px;
    font-weight: bold;
    line-height: 16px;
    margin-top: 3px;
  }
  .service-item-btn{
    margin-left: 40px;
  }
  .service-btn{
    display: inline-block;
    font-size: 13px;
    width: 130px;
    height: 32px;
    line-height: 30px;
    text-align: center;
    color: #004BD8;
    border: 1px solid #2861CE;
    border-radius: 2px;
  }
  .service-btn:hover{
    cursor: pointer;
    background: #ECF1FC;
  }
  .service-item{
    margin-bottom: 10px;
  }
  .service-item:last-child{
    margin-bottom: 0;
  }
  .gurantee-service-con{
    display: none;
    position: absolute;
    top: -24px;
    left: 36px;
    z-index: 9999;
    padding-left: 10px;
    margin-left: -14px;
  }
  .gurantee-service{
    background: #fff;
    box-shadow:0px 0px 8px 0px rgb(0 0 0 / 20%);
  }

  .gurantee-service-pointer-hover:hover{
    cursor: pointer;
  }
  .gurantee-service-pointer-hover:hover + div.gurantee-service-con{
    display: block;
  }
  div.gurantee-service-con:hover{
    display: block;
  }
  .text-upload-time{
    color: #333;
    font-weight: bold;
  }
  .text-being-processed{
    color: #333;
    font-weight: bold;
    margin-top: 6px;
    display: inline-block;
  }
  .text-being-processed-dis{
    line-height: 14px
  }
</style>
<style scoped>
  .my_layer .layui-layer-content{
    margin: 0;
    padding: 0;
  }
</style>

<div class="notice display-none" id="boxShow">
  <i class="fa fa-volume-up"></i>
  <div class="notice-con" id="newsTip">
    <ul>
    </ul>
  </div>
</div>
<div class="filter-wrapper form-wrapper">
  <form action="#" id="form-search">
    <div class="row">
      <div class="col-sm-3">
        <div class="form-group">
          <label for="input-orderStatus">Order Status</label>
          <select name="filter_orderStatus" id="input-orderStatus" value="{{ filter_orderStatus }}"
                  class="form-control">
            {% for k,v in order_status %}
              <option value="{{ k }}"
                {% if k == filter_orderStatus %}
                  selected
                {% endif %}
              >{{ v }}</option>

            {% endfor %}
          </select>
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label for="input-code">Item Code</label>
          <input type="text" name="filter_item_code" value="{{ filter_item_code }}" class="form-control"
                 id="input-code">
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label for="input-orderId">Order ID</label>
          <input type="text" name="filter_orderId" value="{{ filter_orderId }}" class="form-control"
                 id="input-orderId">
        </div>
      </div>
      <div class="col-sm-3">
        <div class="form-group">
          <label for="input-trackingNumber">Tracking Number</label>
          <select name="filter_tracking_number" id="input-trackingNumber" class="form-control">
            <option value="2"
                    {% if filter_tracking_number is defined and filter_tracking_number == 2 %}selected{% endif %}
            >ALL
            </option>
            <option value="1"
                    {% if filter_tracking_number is defined and filter_tracking_number == 1 %}selected{% endif %}
            >Yes
            </option>
            <option value="0"
                    {% if filter_tracking_number is defined and filter_tracking_number == 0 %}selected{% endif %}
            >No
            </option>
          </select>
        </div>
      </div>
    </div>
    <div class="row">
      {% if is_usa %}
        <div class="col-sm-3">
          <div class="form-group">
            <label for="input-intel">Delivery Status</label>
            <select name="filter_delivery_status" id="input-filter_delivery_status" class="form-control">
              <option value="-1" {% if filter_delivery_status is defined and filter_delivery_status == -1 %}selected{% endif %} >ALL</option>
              {% for k,delivery in delivey_status_list %}
                <option value="{{ k }}" {% if filter_delivery_status is defined and filter_delivery_status == k %}selected{% endif %} >{{ delivery }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
      {% endif %}
      {% if is_europe %}
        <div class="col-sm-3">
          <div class="form-group">
            <label for="input-intel">International Order</label>
            <select name="filter_is_international" id="input-isInternational" class="form-control">
              <option value="2" {% if filter_is_international is defined and filter_is_international == 2 %}selected{% endif %} >ALL</option>
              <option value="1" {% if filter_is_international is defined and filter_is_international == 1 %}selected{% endif %} >Yes</option>
              <option value="0" {% if filter_is_international is defined and filter_is_international == 0 %}selected{% endif %}>No</option>
            </select>
          </div>
        </div>
      {% endif %}
      <div class="col-sm-3">
        <div class="form-group">
          <label for="inputOrderDateFrom">Order Date</label>
          <div class="datetimepicker-range">
            <div class="col-sm-6" style="padding: 0">
              <div class="datetimepicker" style="margin-left: 0;padding: 0">
                <input type="text" name="filter_orderDate_from" value="" class="form-control"
                       id="inputOrderDateFrom" placeholder="Pick a date..." autocomplete="off">
                <span class="title">From</span>
                <span class="icon"><i class="giga icon-date-icon"></i></span>
              </div>
            </div>
            <div class="col-sm-6" style="padding: 0">
              <div class="datetimepicker" style="padding: 0">
                <input type="text" name="filter_orderDate_to" value="" class="form-control"
                       id="inputOrderDateTo" placeholder="Pick a date..." autocomplete="off">
                <span class="title">To</span>
                <span class="icon"><i class="giga icon-date-icon"></i></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-3 quick-btns">
        <span class="quick-btn-item" id="quickMonth">One Month</span>
        <span class="quick-btn-item" id="quickWeek">One Week</span>
      </div>
      <div
          {% if is_europe or is_usa %}
            class="col-sm-3" style="height: 58px;padding-top: 26px;text-align: right;"
          {% else %}
            class="col-sm-3 col-sm-offset-3" style="height: 58px;padding-top: 26px;text-align: right;"
          {% endif %}
      >
        <button class="btn btn-primary" onclick="filter(this);" >Filter</button>
        <span type="button"  class="btn btn-default" data-trigger = "hover" data-toggle="tooltip" onclick="downloadExcel();return false"
              title="Download">
          <i class="giga icon-xiazai"></i>
        </span>
        <span class="btn btn-default" data-toggle="tooltip" onclick="resetUrl(this);return false" title="Reset">
          <i class="giga icon-reset3"></i>
        </span>
      </div>
    </div>
  </form>
</div>
<div class="quick-block">
  <div class="quick-block-item border-right " onclick="getOrderStatusQuery('*')">
    <p class="quick-title">All</p>
    <p class="quick-number">{{ all_count ?? 0 }}</p>
  </div>
  <div class="quick-block-item border-right {{ filter_orderStatus == 1 ? 'block-item':'' }}"
       onclick="getOrderStatusQuery(1)">
    <p class="quick-title">To Be Paid</p>
    <p class="quick-number">{{ order_status_list[1]['count'] ?? 0 }}</p>
  </div>
  <div class="quick-block-item border-right {{ filter_orderStatus == 2 ? 'block-item':'' }}"
       onclick="getOrderStatusQuery(2)">
    <p class="quick-title">Being Processed</p>
    <p class="quick-number">{{ order_status_list[2]['count'] ?? 0 }}</p>
  </div>
  <div class="quick-block-item border-right {{ filter_orderStatus == 4 ? 'block-item':'' }}"
       onclick="getOrderStatusQuery(4)">
    <p class="quick-title">On Hold</p>
    <p class="quick-number">{{ order_status_list[4]['count'] ?? 0 }}</p>
  </div>
  <div class="quick-block-item border-right {{ filter_orderStatus == 64 ? 'block-item':'' }}"
       onclick="getOrderStatusQuery(64)">
    <p class="quick-title">LTL Check</p>
    <p class="quick-number">{{ order_status_list[64]['count'] ?? 0 }}</p>
  </div>
  <div class="quick-block-item {{ filter_orderStatus == 128 ? 'block-item':'' }}" onclick="getOrderStatusQuery(128)">
    <p class="quick-title">ASR To Be Paid</p>
    <p class="quick-number">{{ order_status_list[128]['count'] ?? 0 }}</p>
  </div>
</div>
<div class="order-list">
  {#  新的列表ui修改#}
  <div class="table-list-title">
    <div style="width: 90%;display: flex;align-items: center">
      <div style="width: 30%;text-align: center">Product Information</div>
      <div style="width: 10%;text-align: center">Total <br> Amount
        <span class="hover-pointer" data-toggle="tooltip" title="Fee includes the Items +Fulfillment">
        <i class="giga icon-V10-wenhaotishi" style="font-size: 14px"></i>
      </span>
      </div>
      <div style="width: 20%;text-align: center">Purchase <br> Order ID</div>
      <div style="width: 13%;text-align: center">RMA</div>
      <div style="width: 22%;text-align: left">Tracking Number</div>
    </div>
    <div style="width: 10%">
      <div style="width: 100%;text-align: center">Order Total</div>
    </div>
  </div>
  <div class="table-list-body">
    {% for k,v in orders %}
      <div class="table-list-item order-list-row">
        <div class="table-header">
          {% if v.is_show %}
            {% if v.disabled %}
              <div class="choose-container-disabled" mean="{{ v.id }}">
                <div class="choose {{ v.checked ==  1 ? 'choosed':'' }}" style="cursor: not-allowed"
                    {#                   data-trigger = "hover" data-toggle="tooltip" title="{{ v.tips }}"#}
                >
                </div>
                <i class="giga icon-action-confirm-and-agree my-agree" style="cursor: not-allowed"
                   data-trigger = "hover" data-toggle="tooltip" title="{{ v.tips }}"
                ></i>
              </div>
            {% else %}
              <div class="choose-container" mean="{{ v.id }}">
                <div class="choose {{ v.checked ==  1 ? 'choosed':'' }}">
                </div>
                <i class="giga icon-action-confirm-and-agree my-agree"></i>
              </div>
            {% endif %}
          {% endif %}

          <div class="table-sale-order-id ">
            <span style="margin-right: 12px">Sales Order ID : {{ v.order_id }}
              {% if v.line_list.0.orders_from %}
                &nbsp;&nbsp;&nbsp;{{ v.line_list.0.orders_from }}
              {% endif %}
            </span>
            {% if v.address_error and v.address_tips== 0 %}
              <button type="button" class="btn address-tip" data-toggle="popover" id="address-tip-{{ v.id }}">
                <i class="giga icon-gantanhaojinggao address-error" data-toggle="popover"></i>
              </button>
            {% endif %}
            {% if  v.address_change_tips == 0 and v.address_change_tips is not null %}
              <button type="button" class="btn address-tip" data-toggle="popover" data-placement="bottom"
                      id="address-change-{{ v.id }}">
                <i class="giga icon-gantanhaojinggao address-change-error" data-toggle="popover"></i>
              </button>
            {% endif %}
            {% if v.is_international %}
              <span class="mrl-20 handel-hover position-top-2" data-toggle="tooltip"
                    title="[International Order] The shipping address is located outside of country of origin."> <img
                  src="catalog/view/theme/yzcTheme/image/cart/interorder.png" alt=""> </span>
            {% endif %}
            {% if v.freight_error %}
              <span class="mrl-20 handel-hover position-top-2 " data-toggle="tooltip"
                    title="{{ v.freight_error }}"> <img src="catalog/view/theme/yzcTheme/image/cart/noprice.png" alt=""> </span>
            {% endif %}

{#              保障服务#}
            {%  if v['safeguard_bills'] or v.safeguard_bill_pay_error %}
              <span class="mrl-20 guarantee-service-main">
{#                图标三选一#}

                {% if v.safeguard_bill_pay_error %}
                  <img class="gurantee-service-pointer-hover" src="catalog/view/theme/yzcTheme/image/cart/guarantee-danger.png" alt="">
                {% elseif v.safeguard_bill_is_active %}
                  <img class="gurantee-service-pointer-hover position-top-2" src="catalog/view/theme/yzcTheme/image/cart/blue-gurantee.png" alt="">
                {% elseif v.safeguard_bill_is_pending %}
                  <img class="gurantee-service-pointer-hover position-top-2" src="catalog/view/theme/yzcTheme/image/cart/guarantee-pending.png" alt="">
                {% else %}
                  <img class="gurantee-service-pointer-hover position-top-2" src="catalog/view/theme/yzcTheme/image/cart/default-gurantee.png" alt="">
                {% endif %}
                <div id="guranteeService" class="gurantee-service-con">
                  <div class="gurantee-service">
{#                    可保障 二选一#}
                    {% if not  v.safeguard_bill_pay_error %}
                      <p class="nowrap gurantee-service-pop-title">Purchased Protection Service</p>
                      <div class="service-list">
                        {%  for safeguard_bill in  v['safeguard_bills']  %}

                          {% set  service_btn_str='' %}
                          {% set  service_desc_str='' %}
                          {% if safeguard_bill.status==1 %}
                            {% if safeguard_bill.effective_time< now and safeguard_bill.expiration_time> now %}
                              {% if safeguard_bill.safeguardClaim is not empty %}
                                {% if safeguard_bill.safeguard_claim_active_count>0 %}
                                  {% set service_desc_str=safeguard_bill.safeguard_claim_active_count~' claim(s) in progress' %}
                                  {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_keywords': safeguard_bill.safeguard_no})~'#tab_claim_order" target="__blank" class="service-btn" data-text="Claim in Progress">Claim in Progress</a>' %}
                                {% elseif safeguard_bill.safeguard_claim_succeed_count>0 %}
                                  {% set  service_desc_str=safeguard_bill.safeguard_claim_succeed_count~' claims have been processed' %}
                                  {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_keywords': safeguard_bill.safeguard_no})~'#tab_claim_order" target="__blank" class="service-btn" data-text="Claim Processed">Claim Processed</a>' %}
                                {% else %}
                                  {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_no': safeguard_bill.safeguard_no})~'" target="__blank" class="service-btn" data-text="Active">Active</a>' %}
                                  {% set  service_desc_str=safeguard_bill.safeguard_expiration_days~' day(s) left to invalid' %}
                                {% endif %}
                              {% else %}
                                {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_no': safeguard_bill.safeguard_no})~'" target="__blank" class="service-btn" data-text="Active">Active</a>' %}
                                {% set  service_desc_str=safeguard_bill.safeguard_expiration_days~' day(s) left to invalid' %}
                              {% endif %}
                            {% elseif safeguard_bill.effective_time> now %}
                              {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_no': safeguard_bill.safeguard_no})~'" target="__blank" class="service-btn" data-text="Pending">Pending</a>' %}

                              {% set  service_desc_str='' %}
                            {% elseif safeguard_bill.expiration_time< now %}
                              {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_no': safeguard_bill.safeguard_no})~'" target="__blank" class="service-btn" data-text="Invalid">Invalid</a>' %}

                              {% set  service_desc_str=safeguard_bill.safeguard_expiration_days~' days overdue' %}
                            {% endif %}
                          {% elseif safeguard_bill.status==2 %}
                            {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_no': safeguard_bill.safeguard_no})~'" target="__blank" class="service-btn" data-text="Canceled">Canceled</a>' %}

                            {% set  service_desc_str='The order has been canceled, and the <br> Protection Service Fee has been refunded.' %}
                          {% elseif safeguard_bill.status==3 %}
                            {% set  service_btn_str='<a type="button" href="'~url('account/safeguard/bill',{'filter_no': safeguard_bill.safeguard_no})~'" target="__blank" class="service-btn" data-text="Pending">Pending</a>' %}

                            {% set  service_desc_str='Active after warehouse shipment' %}
                          {% endif %}
                          <div class="service-item flex-between">
                            <div class="service-item-info">
                              <div class="flex-start">
                                <div class="black-circle"></div>
                                <div>
                                    <div class="service-title nowrap">{{ safeguard_bill.safeguardConfig.title }}</div>
                                    <div class="leave-time nowrap">{{ service_desc_str }}</div>
                                </div>
                              </div>
                            </div>
                            <div class="service-item-btn">
                               {{ service_btn_str }}
                            </div>
                          </div>
                        {% endfor %}

                      </div>
                    {% endif %}
{#                     禁止保障 二选一#}
                    {% if v.safeguard_bill_pay_error %}
                      <p class="nowrap gurantee-service-pop-title no-bottom">The Protection Service is unable to be purchased since your account <br> balance is insufficient to deduct the Protection Service fee.</p>
                    {% endif %}
                  </div>
                </div>
              </span>
            {% endif %}
{#              保障服务#}
          </div>

          <div class="table-order-status to-be-paid">
            {% if v['failure_log'] %}
              <a
                onclick="showFailureLog('{{ v['failure_log'] }}')"
                style="border-radius: 4px;margin-left: 12px;color: #65B017;cursor: pointer"
                data-toggle="tooltip"
                title="{{ text_button_failure_log }}">
                <i class="gcl gclcuowu3"></i>
              </a>
            {% elseif v['rma_title_notice'] %}
              <a data-toggle="tooltip" title="{{ title_rma_notice }}"
                 style="border-radius: 4px;margin-left: 12px;color: #fa6400;cursor: pointer">
                <i class="giga icon-gantanhaojinggao"></i>
              </a>
            {% endif %}
            {{ v.order_status_name }}

          </div>
        </div>
        <div class="table-body">
          <div class="table-body-top">
            <div class="table-body-left">
              {% for i,j in v.line_list %}
                <div>
                  <div class="table-body-left-item">
                    <div class="product-information">
                      <div class="flex-str">
                        <div class="picture" style="position: relative">
                          <img class="pic-w-40" src="{{ j.image_show }}" alt="">
                          <div class="big-img"
                               style="width: 150px;height: 150px;position: absolute;z-index: 99;left: 40px">
                            <img style="width: 100%;" src="{{ j.image_big }}" alt="">
                          </div>
                        </div>
                        <div>
                          <a class="order-des"
                             href={{ j.product_link }}   title="{{ j.product_name_all }}">
                            {{ j.product_name_get }}
                          </a>
                          {% if j.is_asr == false %}
                            <p class="prd-tip">
                              <span style="display:none;" id="{{ j['id'] }}_div">
                                <select class="select2_parts_list form-control" name="{{ j['id'] }}"
                                        id="{{ j['id'] }}"
                                        style="width:150px;">
                                </select>
                                <i class="fa fa-save save-work" data-trigger="hover" data-toggle="tooltip" title="Save"
                                   style="cursor: pointer;font-size: 14px;margin-left: 5px;"
                                   onclick="updateSku('{{ j.id }}','{{ j.header_id }}',this,'{{ v.is_international }}','{{ v.order_status }}')"
                                   aria-hidden="true"></i> &nbsp;
                                <i class="fa fa-reply save-back" data-trigger="hover" data-toggle="tooltip" title="Cancel"
                                   style="cursor: pointer;font-size: 14px;" aria-hidden="true"
                                   onclick="editSkuCancel('{{ j.id }}',this)"
                                   data-line-id="{{ j.id }}"
                                ></i>
                              </span>
                              {% if v.order_status == 1 or  v.order_status == 64 %}
                                <span class="property" id="{{ j['id'] }}_item_code"
                                      onclick="editSku('{{ j.id }}',this)"
                                      style="word-break: break-all;display:inline-flex">{{ j.item_code }} &nbsp;&nbsp;<i
                                      style="font-size:12px;"
                                      class="gcl gcledit"></i></span>
                                X{{ j.qty }}
                                {% if j.tag %}
                                  {% for tagDetail in j.tag %}
                                    {{ tagDetail }}
                                  {% endfor %}
                                {% endif %}

                              {% else %}
                                <span id="{{ j['id'] }}_item_code">
                                <span>{{ j.item_code }}</span>   X{{ j.qty }}
                                  {% if j.tag %}
                                    {% for tagDetail in j.tag %}
                                      {{ tagDetail }}
                                    {% endfor %}
                                  {% endif %}
                              </span>
                              {% endif %}
                            </p>
                          {% else %}
                            <p class="prd-tip">
                              <span>
                                <span>{{ j.item_code }}</span>   X{{ j.qty }}
                                {% if j.tag %}
                                  {% for tagDetail in j.tag %}
                                    {{ tagDetail }}
                                  {% endfor %}
                                {% endif %}
                              </span>
                            </p>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                    <div class="total-amount">
                      {% if j.total_amount %}
                        {% if j.total_amount.discount_amount > 0 %}

                          <button type="button" class="btn amount-detail-tip" id="amount-detail-tip-{{ j.id }}" data-toggle="popover">{{ j.total_amount.final_total_price }}</button>
                          <br/>
                          <button type="button" class="btn amount-detail-tip through-price" id="amount-detail-tip-{{ j.id }}" data-toggle="popover">{{ j.total_amount.total_price }}</button>
                        {% else %}
                          <button type="button" class="btn amount-detail-tip" id="amount-detail-tip-{{ j.id }}" data-toggle="popover">{{ j.total_amount.total_price }}
                            {#                    <i class="giga icon-arrow-down-outline-white"  data-toggle="popover"></i>#}
                          </button>
                        {% endif %}
                      {% endif %}
                    </div>
                    <div class="purchase-order-id">
                    <span>
                      {% for ks,vs in j.purchase_order_list %}
                        {% if j.purchase_order_freight_tag and j.purchase_order_freight_tag[vs] %}
                          <a
                            href="{{ url('account/order/purchaseOrderInfo',{'order_id':vs}) }}"
                            target="_blank"
                            class="has-sub-code"
                          >{{ vs }}
                        </a>
                        &nbsp;<i
                          style="font-size:12px;font-style: normal;display: inline-block;width: 62px;text-align: center; height:20px;line-height:20px;color: #ff6600;background: #ffebde">Fulfillment</i>
                          <br/>
                      {% else %}
                          <a
                            href="{{ url('account/order/purchaseOrderInfo',{'order_id':vs}) }}"
                            target="_blank"
                            class="has-sub-code"
                          >{{ vs }}
                        </a><br/>
                        {% endif %}
                      {% endfor %}
                    </span>
                    </div>
                    <div class="pro-Rma">
                      {% for ks,vs in j.rma_order_list %}
                        <a
                          href="{{ url('account/rma_order_detail', {'rma_id':vs.id}) }}"
                          target="_blank"
                          class="has-sub-code"
                          style="cursor: pointer;">{{ vs.rma_order_id }}
                        </a><br/>

                      {% endfor %}
                    </div>
                    <div class="tracking-number">
                      {% for ks,vs in v['trackingInfo'] %}
                        {% if ks== j.id %}
                          {% for carrierName,infos in vs %}
                            {{ carrierName }}<br>
                            {% for trackingInfo in infos %}
                              {% if carrierName == 'Fedex' and  trackingInfo.trackingStatus != 0 %}
                                <a href="{{ text_fedex_homepage|dprintf(trackingInfo.trackingNumber) }}"
                                   target="_blank"
                                   class="has-sub-code"
                                   data-toggle="tooltip"
                                  {#                        title="Sub-Item Code {{ v['TrackingItemCode'][ks] }}"#}
                                   style="cursor: pointer;color:#3a75dc ;">{{ trackingInfo.trackingNumber }}</a>
                                {% if trackingSearchShow == 1  and trackingInfo.carrierStatus %}
                                  <span>-</span>
                                  <span class="carrier-status" data-order="{{ v.order_id }}"
                                         data-tracking="{{ trackingInfo.trackingNumber }}" data-shipsku="{{ trackingInfo.trackingShipSku }}">{{ trackingInfo.carrierStatus }}</span>
                                {% endif %}
                                <br>
                              {% elseif trackingInfo.trackingStatus == 0 %}
                                <a title="Invalid" style="color: #ccc">{{ trackingInfo.trackingNumber }}</a><br>
                              {% else %}
                                <span data-toggle="tooltip">{{ trackingInfo.trackingNumber }}</span>
                                {% if trackingSearchShow and trackingInfo.carrierStatus %}
                                  <span>-</span>
                                  <span class="carrier-status" data-order="{{ v.order_id }}"
                                         data-tracking="{{ trackingInfo.trackingNumber }}" data-shipsku="{{ trackingInfo.trackingShipSku }}">{{ trackingInfo.carrierStatus }}</span>
                                {% endif %}
                                <br>
                              {% endif %}
                            {% endfor %}
                          {% endfor %}
                        {% endif %}
                      {% endfor %}
                    </div>
                  </div>
                  {% if j.error %}
                    <div class="table-body-left-item-outer">
                      <div class="error-color text-left">{{ j.error.exists_error }}</div>
                      <div class="error-color text-left">{{ j.error.quantity_error }}</div>
                      <div class="error-color text-left">{{ j.error.ltl_error }}</div>
                      <div class="error-color text-left">{{ j.error.purchase_error }}</div>
                    </div>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
            <div class="table-body-right">
              <div style="width: 100%" class="grand-total">
                {% if v.discount_sum > 0 %}
                  <span>{{ v.final_sum }}</span>
                  <br/>
                  <span class="through-price">{{ v.sum }}</span>
                {% else %}
                  <span>{{ v.sum }}</span>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="table-body-bottom">
            <div class="table-body-bottom-time">
              <span class="text-upload-time">Upload Time: {{ v.create_time }}</span>
              <div >Upload Time refers to the time when the sales order is uploaded to the Marketplace.</div>
              {% if v.being_processed_time %}
              <span  class="text-being-processed">Being Processed: {{ v.being_processed_time }}</span>
              <div class="text-being-processed-dis">Being Processed time refers to the time when the Marketplace is able to start processing the order after <br> the inventory is ensured for the shipment.</div>
              {% endif %}
            </div>
            <div class="table-body-bottom-btns" style="display: flex">
              {% if v.cancel_associated_records %}
                <div class="dropdown">
                  <button class="btn btn-default btn-small btn-plain btn-binding dropdown-toggle" type="button"
                          id="bindingRecord" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Linked Purchased Order History
                  </button>
                  <div class="dropdown-menu binding-record" aria-labelledby="bindingRecord">
                    <div class="text-small">
                      After Sales Order has been canceled, any Purchase Orders linked to that Sales Order will no longer
                      be attached. The stock will be remained and can be purchased for other sales orders.<br>
                      Input Purchase Order ID to apply for refund
                    </div>
                    <table class="table text-small mt-2 mb-0">
                      <tr>
                        <td>Purchase Order ID</td>
                        <td>Quantity</td>
                        <td>Action</td>
                      </tr>
                      {% for record in v.cancel_associated_records %}
                        <tr>
                          <td>{{ record.order_id }}</td>
                          <td>{{ record.qty }}</td>
                          <td><a class="btn btn-primary btn-rma" target="_blank"
                                 href="{{ url('account/rma_management', {'filter_order_id': record.order_id, 'source': 'sale_canceled_order'}) }}">RMA</a>
                          </td>
                        </tr>
                      {% endfor %}
                    </table>
                  </div>
                </div>
              {% endif %}
              {% if v.safeguard_bill_is_active %}
                <a class="btn btn-default btn-small btn-plain go-order-detail"
                   data-toggle="tooltip" title="Claim"
                   href="{{ url('account/safeguard/bill',{'filter_no':v.order_id}) }}"
                   target="_blank">
                  Claim</a>
              {% endif %}
              {% if trackingSearchShow and (v.order_status == 2 or v.order_status ==32) %}
                <a class="btn btn-default btn-small btn-plain go-order-detail"
                   data-toggle="tooltip" title="Track Shipment"
                   href="{{ url('account/sales_order/tracking_search',{'sales_order_id':v.order_id}) }}"
                   {#href="{{ url('account/sales_order/tracking_search',{'sales_order_id':v.order_id|url_encode}) }}"#}
                   target="_blank">
                  Track Shipment</a>
              {% endif %}
              <a class="btn btn-default btn-small btn-plain go-order-detail"
                 data-toggle="tooltip" title="View Sales Order Details"
                 href="{{ url('account/sales_order/sales_order_management/customerOrderSalesOrderDetails',{'id':v.id}) }}"
                 target="_blank">
                View</a>
              {% for x,y in v.btn_info %}
                {% if y == 'email' %}
                  <a onclick="checkLtl('{{ v.id }}')" data-trigger="hover" data-toggle="tooltip" title="LTL confirm"
                     class="btn btn-default btn-small btn-plain">LTL Confirm</a>
                {% endif %}
                {% if y == 'paid' %}
                  <a onclick="singlePaid('{{ v.id }}')" data-trigger="hover" data-toggle="tooltip"
                     title="Purchase and Check Inventory" class="btn btn-default btn-small btn-pay"> Pay</a>
                {% endif %}
                {% if y == 'asr' %}
                  <a onclick="redirectToDeliveryList('{{ v.id }}')" style="cursor: pointer"
                     class="btn btn-default btn-small btn-pay" data-trigger="hover"
                     data-toggle="tooltip" title="Pay ASR fees">
                    Pay to ASR
                  </a>
                {% endif %}
                {% if y == 'released' %}
                  <a onclick="releaseOrder('{{ v.id }}')" style="cursor: pointer"
                     class="btn btn-default btn-small btn-plain" data-trigger="hover"
                     data-toggle="tooltip" title="Remove the on hold status then to purchase it">
                    Released
                  </a>
                {% endif %}
                {% if y == 'rma' and v.rma_status == true %}
                  <a onclick="createRma('{{ v.order_id }}')"
                     target="_blank" style="cursor: pointer" class="btn btn-default btn-small btn-plain"
                     data-trigger="hover"
                     data-toggle="tooltip" title="Apply for RMA for this Order">RMA</a>
                {% endif %}
                {% if country_id != 223 and v.order_status == 2 %}
                  {# 非美国的bp不能被cancel#}
                {% else %}
                  {% if y == 'cancel' %}
                    <a class="btn btn-default btn-small btn-plain"
                       onclick="cancelOrder('{{ v.id }}','{{ v.order_status }}','{{ v.order_id }}','{{ v.is_international }}','{{ v.bind_order_count }}','{{ v.bind_order_nos }}')"
                       style="cursor: pointer" data-trigger="hover" data-toggle="tooltip" title="Cancel Sales Order">Cancel</a>
                  {% endif %}
                {% endif %}

                {% if (country_id == 222 or country_id == 81 or country_id == 107) and v.order_status == 2 %}
                  {# #7680: BP状态下 欧洲国别下不能修改地址 #}
                  {# #14613: BP状态下 日本国别下不能修改地址 #}
                {% else %}
                  {% if y == 'address' %}
                    <button onclick="modifyAddress('{{ v.id }}','{{ v.is_international }}','{{ v.order_status }}')"
                            data-trigger="hover"
                            data-toggle="tooltip" title="Modify the order address"
                            class="btn btn-default btn-small btn-plain modifyDisable"> Modify Address
                    </button>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {#  新的列表ui修改#}

</div>
{#          分页#}
<div class="row mt-2" style="margin-right: 0">
  <div class="col-sm-12 text-right new-pagination" style="display: flex;justify-content: flex-end;align-items: center">
    <ul id="bos_pagination"></ul>
  </div>
</div>
{#          分页#}

{#批量按钮#}
{% if filter_choose_tag %}
  <div class="batch-btns text-right" id="listBatchCon">
    <div class="container">
      <div id="eleSelectAll" class="col-sm-4 text-left" style="top: 10px;">
        <label style="cursor: pointer;"><input type="checkbox" autocomplete="off" class="oris-checkbox size-small allcheck allcheck2 allcheckSalesOrder" style="cursor: pointer;">Select All</label>
      </div>
      {% for v in batch_action_btn %}
        {% if v== 'email' %}
          <button style="height: 40px;font-size: 14px" class="btn btn-default btn-small btn-pay"
                  id="ltl_check">LTL Confirm
          </button>
        {% endif %}
        {% if v== 'paid' %}
          <button style="height: 40px;font-size: 14px" class="btn btn-default btn-small btn-pay"
                  onclick="matchPaid()">Purchase and Check Inventory
          </button>
        {% endif %}
        {% if v== 'cancel' %}
          {% if isAutoBuyer %}
            <span style="height: 40px;font-size: 14px;line-height: 30px;" class="btn btn-default btn-small btn-pay"
                  disabled="disabled"  data-toggle="tooltip" title="Cancellation of batch orders is not available currently."
            >Cancel All
            </span>
          {% else %}
            <button style="height: 40px;font-size: 14px" class="btn btn-default btn-small btn-pay"
                    onclick="cancelAll()">Cancel All
            </button>
          {% endif %}

        {% endif %}
        {% if v== 'released' %}
          <button style="height: 40px;font-size: 14px" class="btn btn-default btn-small btn-pay"
                  onclick="releaseAll()">Release All
          </button>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}
{#批量按钮#}

{#这是修改地址的模态#}
<div class="modal fade in" id="myModalModifyAddress" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" style="width: 720px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">Modify Address</h4>
      </div>
      <div class="modal-body">
        <div class="original-address-con">
          <p class="modal-sub-title">Original Contact Information</p>
          <p id="orignName" style="word-wrap:break-word;word-break:normal; "></p>
          <p id="orignAddr" style="word-wrap:break-word;word-break:normal; "></p>
        </div>
        <form class="form-horizontal new-address-con" id="modifyAddress">
          <input type="hidden" name="ShipId" id="ShipId">
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="inputModifyShipToName" class="col-sm-3 control-label required">Ship To Name</label>
                <div class="col-sm-8">
                  <input class="form-control" id="ShipToNameList" name="ShipToName" placeholder=""
                         onkeyup="this.value=this.value.replace( /^\s*/, '');">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="inputModifyShipToEmail" class="col-sm-3 control-label required">Ship To E-mail</label>
                <div class="col-sm-8">
                  <input class="form-control" id="ShipToEmailList" name="ShipToEmail" placeholder=""
                         onkeyup="this.value=this.value.replace( /^\s*/, '');">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="inputModifyShipToPhone" class="col-sm-3 control-label required">Ship To Phone</label>
                <div class="col-sm-8">
                  <input class="form-control" id="ShipToPhoneList" name="ShipToPhone" placeholder=""
                         onkeyup="this.value=this.value.replace( /^\s*/, '');">
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="inputModifyShippingStreetAddress" class="col-sm-3 control-label required">
                  Shipping Address Detail
                </label>
                <div class="col-sm-8">
                  <input class="form-control" id="StreetAddressList" name="StreetAddress" placeholder="Street Address"
                         onkeyup="this.value=this.value.replace( /^\s*/, '');">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="ShipToCityList" class="col-sm-3 control-label required">Shipping City</label>
                <div class="col-sm-8">
                  <input class="form-control" name="ShipToCity" id="ShipToCityList" placeholder="ShipToCity"
                         onkeyup="this.value=this.value.replace( /^\s*/, '');">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="ShipToCountryList" class="col-sm-3 control-label required">Shipping Country</label>
                <div class="col-sm-8">
                  <i class="giga icon-cuowu2 modify-country-remove" id="modifyCountryRemove"></i>
                  <input class="form-control dropdown-in" name="ShipToCountry" id="ShipToCountryList"
                         placeholder="ShipToCountry" autocomplete="off"
                         onkeyup="this.value=this.value.replace( /^\s*/, '');">
                  <ul class="dropdown-menu dropdown-in modify-country" aria-labelledby="dLabel"></ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="ShipToStateList" class="col-sm-3 control-label required">Shipping State</label>
                <div class="col-sm-8">
                  {% if is_japan %}
                    <select class="form-control selectpicker" name="ShipToState" id="ShipToStateList" placeholder="State"
                            data-live-search="true" required>
                    </select>
                  {% else %}
                    <input class="form-control" name="ShipToState" id="ShipToStateList" placeholder="ShipToState"
                           onkeyup="this.value=this.value.replace( /^\s*/, '');">
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="ShipToPostalCodeList" class="col-sm-3 control-label required">Shipping Postal Code</label>
                <div class="col-sm-8">
                  <input class="form-control" id="ShipToPostalCodeList" name="ShipToPostalCode"
                         placeholder="ShipToPostalCode" onkeyup="this.value=this.value.replace( /^\s*/, '');" >
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-12">
              <div class="form-group">
                <label for="inputModifyShipToPhone" class="col-sm-3 control-label ">OrderComments</label>
                <div class="col-sm-8">
                  <textarea class="form-control textarea-drag-none" id="OrderCommentsList" placeholder="" name="OrderComments"
                            style="width: 100%" rows="4" onkeyup="this.value=this.value.replace( /^\s*/, '');" ></textarea>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer" style="text-align: center">
        <button class="btn btn-primary" id="submitModifyAddress" type="button">Submit</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal -->
</div>
{#这是修改地址的模态#}

{#这是Send E-Mail的模态框#}
<div class="modal fade in" id="myModalSendMail" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" style="width: 800px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">Send E-Mail</h4>
      </div>
      <div class="modal-body">
        <div class="note mrt15">
          <p>Listed below are LTL (oversized) products in your order</p>
          <p>Please note:</p>
        </div>
        <div class="tip1 mrt15">
          <p>-LTL products are more likely to experience higher-product return costs</p>
          <p>-LTL products are more likely to experience longer shipping times</p>
        </div>
        <div class="tip2 mrt15">
          <p>Please send an email to our customer service team at service@gigacloudlogistics.com</p>
          <p>Once you have received our response to your confirmation you can add your LTL products to your
            cart for purchase</p>
        </div>
        <table class="table table-bordered">
          <thead style="background: transparent">
          <tr>
            <th width="40%">Sales Order ID</th>
            <th width="20%">Item Code</th>
            <th width="20%">Qty</th>
            <th width="20%">Total Amount</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td rowspan="2">USTest111-0013500-200116010-14</td>
            <td>W21102080</td>
            <td>1</td>
            <td>$165.32</td>
          </tr>
          <tr>
            <td>W21102080</td>
            <td>1</td>
            <td>$165.32</td>
          </tr>
          <tr>
            <td>US-202003061223432KKL</td>
            <td>SH000026AAA</td>
            <td>5</td>
            <td>$69.4</td>
          </tr>
          <tr>
            <td>K5E4G5T43920200312</td>
            <td>PP036982EAA</td>
            <td>3</td>
            <td>$165.32</td>
          </tr>
          <tr>
            <td>PWO945ND52FD2662DFDGDADFVV</td>
            <td>PP036895EAA</td>
            <td>1</td>
            <td>$973.6</td>
          </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer" style="text-align: center">
        <button class="btn btn-primary">send Email</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal -->
</div>


<script>
  $('.carrier-status').click(function() {
    var order_id = $(this).attr("data-order");
    var tracking_number = $(this).attr("data-tracking");
    var data_shipsku = $(this).attr("data-shipsku");
    openTrackStatusDialog(order_id, tracking_number, data_shipsku);
  });

  // trackingDetail订单状态详情页
  function openTrackStatusDialog(order_id, tracking_number, data_shipsku) {
    var trackingDetailUrl = "{{ url('account/sales_order/tracking_search/detail',{'order_id':''}) }}"
      + escape(order_id) + '&tracking_number=' + escape(tracking_number) + '&tracking_shipsku=' + escape(data_shipsku);
    layer.open(
      {
        type: 2,
        area: ['520px', '526px'],
        title: 'Detailed View',
        fixed: false, //不固定Change
        maxmin: false,
        offset: "auto",
        shadeClose: true,
        skin: 'yzc_layer my_layer',
        scrollbar: false,
        resize:false,
        content: trackingDetailUrl,
        cancel: function (index, layer) {

        },
        success: function () {
        }
      }
    );
  }
</script>

{#这是Send E-Mail的模态框#}
<script>
  var order_url = '{{ order_url }}';
  var download_url = '{{ download_url }}';
  var available_order_id = JSON.parse('{{ available_order_id }}');
  var timerIDArr = [];
  var ticketCategoryGroupList = {{ ticketCategoryGroupList }};
  var txtPleaseSelect = "{{ __('请选择', {}, 'common') }}";
  $(document).ready(function () {
    let filter_orderDate_from = '{{ filter_orderDate_from }}';
    let filter_orderDate_to = '{{ filter_orderDate_to }}';
    if(filter_orderDate_from){
      filter_orderDate_from = filter_orderDate_from.substring(0,10);
      $('#inputOrderDateFrom').val(filter_orderDate_from);
    }
    if(filter_orderDate_to){
      filter_orderDate_to = filter_orderDate_to.substring(0,10);
      $('#inputOrderDateTo').val(filter_orderDate_to);
    }
    pagination();
    autoCheckSelectAll();
    getNoticeMessage();

    $(".select2_parts_list").select2({
      ajax: {
        url: "{{ url('account/sales_order/sales_order_management/getB2bCodeBySearch') }}",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return {
            line_id: $(this).attr('id'),
            q: params.term, // search term
            page: params.page
          };
        },
        processResults: function (data, params) {
          // parse the results into the format expected by Select2
          // since we are using custom formatting functions we do not need to
          // alter the remote JSON data, except to indicate that infinite
          // scrolling can be used
          params.page = params.page || 1;

          return {
            results: data.items,
            pagination: {
              more: (params.page * 30) < data.total_count
            }
          };
        },
        cache: true
      },
      placeholder: `--- ${txtPleaseSelect} ---`,
      minimumInputLength: 1,
      templateResult: formatRepo,
      templateSelection: formatRepoSelection
    });

    function formatRepo(repo) {
      if (repo.loading) {
        return repo.text;
      }
      var $container = $(
//        "<div class='select2-result-repository clearfix'>" +
//        "<div class='select2-result-repository__avatar'><img src='" + repo.owner.avatar_url + "' /></div>" +
        "<div class='select2-result-repository__meta'>" + repo.sku +
        //        "<div class='select2-result-repository__title'></div>" +
        //        "<div class='select2-result-repository__description'></div>" +
        //        "<div class='select2-result-repository__statistics'>" +
        //        "<div class='select2-result-repository__forks'><i class='fa fa-flash'></i> </div>" +
        //        "<div class='select2-result-repository__stargazers'><i class='fa fa-star'></i> </div>" +
        //        "<div class='select2-result-repository__watchers'><i class='fa fa-eye'></i> </div>" +
        //        "</div>" +
        //        "</div>" +
        "</div>"
      );

//      $container.find(".select2-result-repository__title").text(repo.full_name);
//      $container.find(".select2-result-repository__description").text(repo.description);
//      $container.find(".select2-result-repository__forks").append(repo.forks_count + " Forks");
//      $container.find(".select2-result-repository__stargazers").append(repo.stargazers_count + " Stars");
//      $container.find(".select2-result-repository__watchers").append(repo.watchers_count + " Watchers");

      return $container;
    }

    function formatRepoSelection(repo) {
      return repo.sku || repo.text;
    }
  });
  $('#inputOrderDateFrom').datetimepicker({
    minView: 2,
    format: 'yyyy-mm-dd',
    autoclose: true,
    forceParse: true
  });

  $('#inputOrderDateTo').datetimepicker({
    minView: 2,
    format: 'yyyy-mm-dd',
    autoclose: true,
    forceParse: true
  });

  $("#inputOrderDateFrom").on('click foucs',function () {
    $('#inputOrderDateTo').datetimepicker('hide');
  });
  $("#inputOrderDateTo").on('click foucs',function () {
    $('#inputOrderDateFrom').datetimepicker('hide');
  });
  var now = new Date();
  $('#quickWeek').click(function () {
    // quickDate(6);
    var weektime = new Date().setDate((new Date().getDate() - 7));
    $('#inputOrderDateFrom').datetimepicker('setDate', new Date(weektime));
    $('#inputOrderDateTo').datetimepicker('setDate', new Date());

  });
  $('#quickMonth').click(function () {
    // quickDate(29);
    var monthtime = new Date().setMonth((new Date().getMonth() - 1));
    $('#inputOrderDateFrom').datetimepicker('setDate', new Date(monthtime));
    $('#inputOrderDateTo').datetimepicker('setDate', new Date());
  });

  //提示信息
  function getNoticeMessage() {
    var tipStrArr = [];
    //获取提示信息
    $.ajax({
      url: "{{ url('account/sales_order/sales_order_management/noticeMessage') }}",
      type: 'post',
      data: {},
      async: true,
      success: function (json) {
        if (json.error == 0 && json.data.length > 0) {
          tipStrArr = json.data;
          if (tipStrArr.length > 1) {
            $("#boxShow").removeClass('display-none');
            //拼接UL
            let noticeHtml = '';
            tipStrArr.forEach((item, i) => {
              noticeHtml += '<li>' + item + '</li>';
            });
            $("#newsTip ul").html(noticeHtml);
            let timer = setInterval("noticeUp('.notice-con ul','-44px',1000)", 3000);
            timerIDArr.push(timer);
            $('[data-toggle="tooltip"]').tooltip();
          } else if (tipStrArr.length == 1) {
            $("#boxShow").removeClass('display-none');
            let noticeHtml = '';
            tipStrArr.forEach((item, i) => {
              noticeHtml += '<li>' + item + '</li>';
            });
            $("#newsTip ul").html(noticeHtml);
          } else {
            $("#boxShow").addClass('display-none');
          }
        } else {
          $("#boxShow").addClass('display-none');
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      }
    });

  }

  function noticeUp(obj, top, time) {
    $(obj).animate({
      marginTop: top
    }, time, function () {
      $(this).css({marginTop: "0"}).find(":first").appendTo(this);
    })
  }

  function clearTimer() {
    for (let i = 0; i < timerIDArr.length; i++) {
      clearInterval(timerIDArr[i]);
    }
    timerIDArr.splice(0, timerIDArr.length)
  }

  $('.choose-container').click(function () {
  var objChoose = $(this).find(".choose");
    var ret = objChoose.hasClass('choosed');
    var order_id = Number($(this).attr('mean'));
    if (ret) {
      removePosition(available_order_id, order_id)
    } else {
      addPosition(available_order_id, order_id)
    }
    objChoose.toggleClass('choosed');
    autoCheckSelectAll();
  });


  function getPosition(array, val) {
    for (var i = 0; i < array.length; i++) {
      if (array[i] == val) return i;
    }
    return -1;
  }

  function removePosition(array, val) {
    var index = getPosition(array, val);
    if (index > -1) {
      array.splice(index, 1);
    }

    return array;
  }

  function addPosition(array, val){
    var index = getPosition(array, val);
    if(index == -1){
      array.push(val);
    }
  }

  let template = [
    '<div class="popover">',
    '<div class="popover-title"></div>',
    '<div class="popover-content" ></div>',
    '</div>'
  ].join("");

  {% for k,v in orders %}
  {% if v.address_tips == 0 and v.address_error %}
  var string_{{ v.id }} = '<div class="old-address"><p style="font-size:12px">' + "{{ v.detail_address | c_escape }}" + '</p></div>';
  let content_{{ v.id }} = [
    '<p>Address flagged as incorrect, please modify ASAP. If the address is correct, please ignore this reminder</p>',
    string_{{ v.id }},
    '<div class="popover-btn"><button type="button" style="font-size:12px;margin-right: 8px" class="btn btn-primary address-yes" onclick="addressYes(this)"  mean="' + "{{ v.id }}" + '" is_international="' + "{{ v.is_international }}" + '"  order_status="' + "{{ v.order_status }}" + '" >OK</button>',
    '<button type="button" style="font-size:12px" class="btn btn-default address-no" data-dismiss="modal" onclick="addressNo(this)" mean="' + "{{ v.id }}" + '" >No Remind</button></div>'
  ].join("");
  var tips_id_{{ v.id }} = '#address-tip-' + {{ v.id }};
  $(tips_id_{{ v.id }}).popover({
    html: true,
    trigger: "foces",
    placement: 'bottom',
    content: content_{{ v.id }},
    template: template
  });
  {% endif %}
  {% if v.address_change_tips ==  0 %}
  let content_change_{{ v.id }} = [
    '<p>Address modification failed, Please contact customer service.</p>',
    '',
    '<div class="popover-btn"><button type="button" style="font-size:12px;margin-right: 8px" class="btn btn-primary address-yes" onclick="addressChange(this)"  mean="' + "{{ v.id }}" + '" >Close</button>',
    '<input type="checkbox" id="check_{{ v.id }}" style="vertical-align:middle;margin:-2px 0 0 0;" ><span style="vertical-align: middle;">&nbsp;No Remind</span></div>'
  ].join("");
  var tips_change_id_{{ v.id }} = '#address-change-' + {{ v.id }};
  $(tips_change_id_{{ v.id }}).popover({
    html: true,
    trigger: "click",
    placement: 'bottom',
    content: content_change_{{ v.id }},
    template: template
  });
  $(document).bind('click', function (event) {
    var con = $(tips_change_id_{{ v.id }}).parent();
    var evt = event.srcElement ? event.srcElement : event.target;
    evt = $(evt);
    if (evt.hasClass("table-sale-order-id ") || evt.parents(".table-sale-order-id").length != 0) {

    } else {
      con.find(".popover").hide();
    }

  });
  {% endif %}
  {% endfor %}
  function addressChange(obj) {
    var order_id = $(obj).attr('mean');
    var state = $('#check_' + order_id).prop("checked");
    if (state) {
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/updateAddressChangeTips') }}",
        type: 'post',
        dataType: 'json',
        data: {'order_id': order_id, 'state': state},
        async: false,
        cache: false,//上传文件无需缓存
        // processData: false,//用于对data参数进行序列化处理 这里必须false
        // contentType: false, //必须
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (result) {
          layer.closeAll('loading');
          $('#address-change-' + order_id).parent().find(".popover").hide();
          if (result.error === 0) {
            $('#address-change-' + order_id).remove();
          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          $('#address-change-' + order_id).parent().find(".popover").hide();
          layerMsg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
      });
    } else {
      $('#address-change-' + order_id).parent().find(".popover").hide();
    }
  }

  function addressNo(obj) {
    var order_id = $(obj).attr('mean');
    $.ajax({
      url: "{{ url('account/sales_order/sales_order_management/updateAddressTips') }}",
      type: 'post',
      dataType: 'json',
      data: {'order_id': order_id},
      async: false,
      cache: false,//上传文件无需缓存
      // processData: false,//用于对data参数进行序列化处理 这里必须false
      // contentType: false, //必须
      beforeSend: function () {
        layer.load(1, {shade: [0.3, '#000']});
      },
      success: function (result) {
        layer.closeAll('loading');
        if (result.error === 0) {
          $('.address-tip').remove();
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        layer.closeAll('loading');
        layerMsg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      }
    });
  }

  function addressNo(obj) {
    var order_id = $(obj).attr('mean');
    $.ajax({
      url: "{{ url('account/sales_order/sales_order_management/updateAddressTips') }}",
      type: 'post',
      dataType: 'json',
      data: {'order_id': order_id},
      async: false,
      cache: false,//上传文件无需缓存
      // processData: false,//用于对data参数进行序列化处理 这里必须false
      // contentType: false, //必须
      beforeSend: function () {
        layer.load(1, {shade: [0.3, '#000']});
      },
      success: function (result) {
        layer.closeAll('loading');
        if (result.error === 0) {
          $('.address-tip').remove();
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        layer.closeAll('loading');
        layerMsg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      }
    });
  }

  function layerMsg(message, time = 5000) {
    layer.msg(message, {time: time, skin: ''});
  }

  function getSearchQueryParams() {
    let form = $('#form-search');
    let s_params = form.serializeArray();
    let ret = {};
    s_params.forEach(function (item) {
      ret[item['name']] = item['value'];
    });

    if (ret.hasOwnProperty('filter_orderDate_from') && ret['filter_orderDate_from']) {
      ret['filter_orderDate_from'] = moment(ret['filter_orderDate_from']).format('YYYY-MM-DD 00:00:00');
    }

    if (ret.hasOwnProperty('filter_orderDate_to') && ret['filter_orderDate_to']) {
      ret['filter_orderDate_to'] = moment(ret['filter_orderDate_to']).format('YYYY-MM-DD 23:59:59');
    }
    return ret;
  }

  function pagination() {
    if ({{ total_pages }}) {
      $('#bos_pagination').bootstrapPaginator({
        /*当前使用的是3版本的bootstrap*/
        bootstrapMajorVersion: 3,
        /*配置的字体大小是小号*/
        size: 'normal',
        /*当前页*/
        currentPage: {{ page }},
        /*一共多少页*/
        totalPages: {{ total_pages }},
        /*页面上最多显示几个含数字的分页按钮*/
        numberOfPages: 5,
        pageRange: [10, 20, 30, 40, 50],
        rowsOfPage: {{ page_limit }},
        total: {{ total }},
        onPageClicked: function (event, originalEvent, type, page) {
          let url = order_url + '&' + $.param(getSearchQueryParams()) + '&page=' + page;
          clearTimer();
          block.blockUI();
          $('#salesOrderListPanel').load(url, function () {
            block.unBlockUI();
          });
        }
      });
    }
  }

  function quickDate(day) {
    let now = new Date();
    let oneweekdate = new Date(new Date() - day * 24 * 3600 * 1000);
    let y = oneweekdate.getFullYear();
    let m = oneweekdate.getMonth() + 1;
    let d = oneweekdate.getDate();
    let nowDate = y + '-' + m + '-' + d;
    $('#inputOrderDateFrom').datetimepicker('setDate', new Date(nowDate));
    $('#inputOrderDateTo').datetimepicker('setDate', new Date());
  }

  // quicky search
  function getOrderStatusQuery(order_status) {
    block.blockUI();
    var url = order_url + '&filter_orderStatus=' + order_status + '&filter_choose_tag=1';
    clearTimer();
    $('#salesOrderListPanel').load(url, function () {
      block.unBlockUI();
    });
  }

  // search
  function filter(item) {
    let params = getSearchQueryParams();
    $(item).button('loading');
    clearTimer();
    block.blockUI();
    $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
      block.unBlockUI();
      $(item).button('reset');
    });
    event.preventDefault();
    return false;
  }

  // download
  function downloadExcel() {
    window.location.href = download_url + '&' + $.param(getSearchQueryParams());
  }

  //reset
  function resetUrl(item) {
    $(item).button('loading');
    clearTimer();
    block.blockUI();
    $('#salesOrderListPanel').load(order_url, function () {
      block.unBlockUI();
      $(item).button('reset');
    });
    return false;
  }

  //Select All 是否为选中状态？
  function autoCheckSelectAll(){
    //$(".order-list-row").length;这一页的订单数量
    //$(".order-list-row").find(".choose-container-disabled").length;不允许选择的订单数量
    //$(".order-list-row").find(".choose-container").length;允许选择的订单数量
    //$(".order-list-row").find(".choose-container").find(".choose.choosed").length;被实际选中的 允许选择的订单数量
    if($(".order-list-row").length == $(".order-list-row").find(".choose-container-disabled").length){
      $("#eleSelectAll").hide();
    } else{
      $("#eleSelectAll").show();
    }

    if($(".order-list-row").find(".choose-container").length == $(".order-list-row").find(".choose-container").find(".choose.choosed").length){
      $(".allcheckSalesOrder").prop("checked", true);
    } else {
      $(".allcheckSalesOrder").prop("checked", false);
    }
  }
  $(".allcheckSalesOrder").on("click", function() {
    if ($(this).prop("checked")) { //全选
      $(".order-list-row").find(".choose-container").find(".choose").each(function (index, domEle) {
        $(domEle).addClass("choosed");
      });
    } else {//全不选
      $(".order-list-row").find(".choose-container").find(".choose").each(function (index, domEle) {
        $(domEle).removeClass("choosed");
      });
    }

    $(".order-list-row").find(".choose-container").each(function (index, domEle) {
      var objChoose = $(domEle).find(".choose");
      var order_id = Number($(domEle).attr('mean'));
      if(objChoose.hasClass('choosed')){
        addPosition(available_order_id, order_id)
      } else {
        removePosition(available_order_id, order_id)
      }
    });
  });

  //保障服务按钮浮动变Detail
  $("body").on('mouseover','.service-btn',function () {
    $(this).html('Details')
  });
  $("body").on('mouseout','.service-btn',function () {
    $(this).html($(this).attr("data-text"))
  })
</script>

{#这是修改地址的模态script#}
<script>
  //获取order的地址
  function getOrderAddress(order_id) {
    //清除样式
    $("#modifyAddress").find('input,textarea').each(function () {
      $(this).val('');
      $(this).removeClass('error-input');
      $(this).parent().find('.error-text').remove();
    });
    let address_info = [];
    $.ajax({
      url: "{{ url('account/sales_order/sales_order_management/orderOldAddress') }}",
      type: 'post',
      dataType: 'json',
      data: {'order_id': order_id},
      async: false,
      cache: false,//上传文件无需缓存
      // processData: false,//用于对data参数进行序列化处理 这里必须false
      // contentType: false, //必须
      beforeSend: function () {
        layer.load(1, {shade: [0.3, '#000']});
      },
      success: function (result) {
        layer.closeAll('loading');
        if (result.error === 0) {
          address_info = result.info;
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        layer.closeAll('loading');
        layerMsg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      }
    });
    // 打开弹框
    $("#myModalModifyAddress").modal('show');
    $("#ShipId").val(address_info['id']);
    $("#ShipToNameList").val(address_info['ship_name']);
    $("#ShipToEmailList").val(address_info['email']);
    $("#ShipToPhoneList").val(address_info['ship_phone']);
    $("#StreetAddressList").val(address_info['ship_address1']);
    $("#ShipToPostalCodeList").val(address_info['ship_zip_code']);
    $("#ShipToCityList").val(address_info['ship_city']);

    //如果是日本使用下拉
    if (address_info['is_japan']) {
      let optionState = '';
      let state = address_info['state'];
      //之前填写的洲是否在下拉列表中
      if (address_info['state_exists']) {
        for (let i in state) {
          if (address_info['ship_state'] == state[i].county) {
            optionState += '<option value="' + state[i].county + '" selected>' + state[i].county + '</option>';
          } else {
            optionState += '<option value="' + state[i].county + '">' + state[i].county + '</option>';
          }
        }
      } else {
        optionState += '<option value="' + address_info['ship_state'] + '" selected style="display: none;">' + address_info['ship_state'] + '</option>';
        for (let i in state) {
          optionState += '<option value="' + state[i].county + '">' + state[i].county + '</option>';
        }
      }
      $('#ShipToStateList').html(optionState);
      $('#ShipToStateList').selectpicker('refresh');
    } else {
      $("#ShipToStateList").val(address_info['ship_state']);
    }

    $("#ShipToCountryList").val(address_info['ship_country']);
    $("#OrderCommentsList").val(address_info['customer_comments']);
    $("#orignName").html(address_info['orignName']);
    $("#orignAddr").html(address_info['orignAddr']);
  }

  //地址错误，修改地址

  function addressYes(obj) {
    let order_id = $(obj).attr('mean');
    let is_international = $(obj).attr('is_international');
    let order_status = $(obj).attr('order_status');
    modifyAddress(order_id, is_international, order_status);
  }

  // modify Address
  function modifyAddress(id, is_international, order_status) {
    if (order_status == 2 && is_international == 1) {
      layer.confirm('The address on this sales order cannot be modified because its status is ‘Being Processed’.  Please contact the customer service for assistance.', {
        title: 'Confirm',
        skin: 'yzc_layer',
        btn: ['Close'],
        btnAlign: 'c',
      }, function () {
        layer.closeAll();
      });
      return false;
    } else if (order_status == 1 && is_international == 1) {
      let data = {order_id: id};
      var ajax_info;
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/checkIsExistAssociate') }}",
        type: 'post',
        dataType: 'json',
        async: false,
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          ajax_info = json;
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layer.msg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText, {time: 3000, skin: ''});
        }
      });
      if (ajax_info.error) {
        layer.confirm('The address of this sales order cannot be modified due to an existing matching purchase order. Please cancel the matching purchase order before modifying the address.', {
          title: 'Confirm',
          skin: 'yzc_layer',
          btn: ['Go to matching purchase order', 'Close'],
          btnAlign: 'c',
        }, function () {
          if (ajax_info.order_num == 1) {
            window.open("{{ url('account/order',{'filter_PurchaseOrderId':''}) }}" + ajax_info.order_id, '_blank');
          } else {
            window.open("{{ url('account/order') }}", '_blank');
          }
          layer.closeAll();
        }, function () {
          layer.closeAll();
        });
        return false;
      }

    }
    getOrderAddress(id);
  }

  //校验必填
  function checkFull(checkID, message) {
    let check = true;
    checkID.forEach(function (item, i) {
      if ($(item).val() == "") {
        check = false;
        $(item).addClass('error-input');
        $(item).parent().find('.error-text').remove();
        $(item).parent().append("<span class='error-text'>" + message[i] + "</span>");
      } else {
        $(item).removeClass('error-input');
        $(item).parent().find('.error-text').remove();
      }
    });
    return check;
  }

  $('#submitModifyAddress').on('click', function () {
    $(".modifyDisable").attr('disabled', true);
    //校验信息
    let checkID = [
      '#ShipToNameList',
      '#ShipToEmailList',
      '#ShipToPhoneList',
      '#StreetAddressList',
      '#ShipToPostalCodeList',
      '#ShipToCityList',
      '#ShipToStateList',
      '#ShipToCountryList'
    ];
    let message = [
      'Required fields',
      'Required fields',
      'Required fields',
      'Required fields',
      'Required fields',
      'Required fields',
      'Required fields',
      'Required fields',
    ];
    if (!checkFull(checkID, message)) {
      return false;
    }
    //获取提交参数并清除前后空格
    var modifyAddressData = $('#modifyAddress').serializeArray();
    for(let i=0;i<modifyAddressData.length;i++){
      let newVal = modifyAddressData[i].value.trim();
      modifyAddressData[i].value=newVal
    }
    //更改地址
    $.ajax({
      url: "{{ url('account/sales_order/sales_order_management/updateOrderAddress') }}",
      type: 'post',
      data: modifyAddressData,
      async: false,
      beforeSend: function () {
        layer.load(1, {shade: [0.3, '#000']});
        $("#submitModifyAddress").attr('disabled', true);
      },
      success: function (result) {
        $("#submitModifyAddress").attr('disabled', false);
        layer.closeAll('loading');
        if(result.error==0){//修改成功
          if(result.tag_id==1){ //LTL发邮件功能暂定
            $(".modifyDisable").attr('disabled', false);
          }else{
            let tips = 'Modify Address Successfully!';
            if (result.notice) {
              tips += '<br/>International order, automatic freight pricing is unavailable.Please contact the customer service for assistance.';
            }
            myToastFn(tips,'success');
            $("#myModalModifyAddress").modal('hide');
            $(".modal-backdrop").removeClass('in');
            $(".modal-backdrop").removeClass('fade');
            $(".modal-backdrop").removeClass('modal-backdrop');
            clearTimer();
            let params = getSearchQueryParams();
            clearTimer();
            $('#salesOrderListPanel').load(order_url + '&' + $.param(params));
            getNoticeMessage();
            setTimeout(function () {
              $(".modifyDisable").attr('disabled', false);
            },3000)
          }
          return false;
        }else if(result.error==3){//修改失败
          myToastFn('Save Failed<br/> Please contact customer service.','error');
          $("#myModalModifyAddress").modal('hide');
          $(".modal-backdrop").removeClass('in');
          $(".modal-backdrop").removeClass('fade');
          $(".modal-backdrop").removeClass('modal-backdrop');
          clearTimer();
          let params = getSearchQueryParams();
          clearTimer();
          $('#salesOrderListPanel').load(order_url + '&' + $.param(params));
          setTimeout(function () {
            $(".modifyDisable").attr('disabled', false);
          },3000)
        }else if(result.error==2){ //修改等待
          myToastFn(result.info,'success');
          setTimeout(function () {
            $(".modifyDisable").attr('disabled', false);
          },3000)
        }else if(result.error==1){ //信息填写错误
          result.info.forEach(function (item) {
            $('#'+item.id+"List").addClass('error-input');
            $('#'+item.id+"List").parent().find('.error-text').remove();
            //后台返回的错误提示
            $('#'+item.id+"List").parent().append("<span class='error-text'>"+item.info+"</span>");
          });
          $(".modifyDisable").attr('disabled', false);
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        $("#submitModifyAddress").attr('disabled', false);
        layer.closeAll('loading');
        $(".modifyDisable").attr('disabled', false);
        layerMsg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      }
    });

  });

  function createRma(order_id) {
    url = "{{ url('account/rma_management',{'filter_order_id':''}) }}" + encodeURIComponent(order_id);
    window.open(url, "_blank")
  }

  function customerService(order_id) {
    $('#myModalTicket').modal('show');
    $("#submit_ticket_for").val('2');
    submitTicketForChange(2);
    $("#ticket_type").val('5');

    $("#tipInterceptSalesOrder").show();
    $('#sales_order_id').val(order_id);

    $('#group_processing_method').show();
    $('div[group="parent-sales-order"]').show();

    let procesMethodStr = `<option value="0">--${txtPleaseSelect}--</option>`;
    var items = ticketCategoryGroupList[5 + 's'];
    for (let i in items) {
      let item = items[i];
      procesMethodStr += '<option value="' + parseInt(item.category_id) + '">' + item.name + '</option>';
    }
    if (items) {
      $("#processing_method").html(procesMethodStr);
    }

    $("#ticket_group_description").show();
    $(".ticket_group_attachments").show();
    $("#labelUploadAttachments").hide();
    $("#labelUploadProffImages").show();
    $("#spanLabelAttachments").hide();
    $("#spanLabelProffImages").show();
    $("#myModalTicketFooter").show();
  }


  // cancel order
  function cancelOrder(id, status, order_id, is_international, feeOrderCount, feeOrderNos) {
    let content = 'Are you sure you want to cancel the order(s)?';
    if (feeOrderCount > 0) {
      content = '<div>Are you sure you want to cancel the order(s)?</div>' +
        '<div class="content-con-sub-title">the following Purchase Order(s) will be canceled.<br>' + feeOrderNos + '</div>'
    }
    var tmplayer = layer.confirm(content, {
      title: 'Cancel',
      skin: 'yzc_layer',
      btn: ['OK'] //按钮
    }, function () {
      layer.close(tmplayer);
      let data = {id: id};
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/cancelOrder') }}",
        type: 'post',
        dataType: 'json',
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          //102730 新增需求
          if (status == 2 && json.error == 0) {
            let confirm_tips = 'Canceled successfully. If you wish to return this item for refund, please apply for RMA.';
            if (is_international != 0) {
              confirm_tips += '<br/><i class="giga icon-gantanhaojinggao" style="color:red"></i>&nbsp;' + '订单中包含的国际运费无法再此使用，需要通过RMA退款.';
            }
            var tmpLayerSuccess = layer.confirm(confirm_tips, {
              title: 'Cancel',
              skin: 'yzc_layer',
              btn: ['Close'],
              btnAlign: 'c',
              cancel: function () {
                let params = getSearchQueryParams();
                clearTimer();
                $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
                });
              }
            }, function () {
              layer.close(tmpLayerSuccess);
              let params = getSearchQueryParams();
              clearTimer();
              $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
              });
            });
          } else if ((status == 2 && json.error == 1) || (json.error == 3)) {  //status为2是BP状态下的判断  error为3是需求#2780 中源订单号被下载就不能取消
            var tmpLayerError = layer.confirm(json.msg, {
              title: 'Cancel',
              skin: 'yzc_layer',
              btn: ['Close', 'Customer Service'],
              btnAlign: 'c'
            }, function () {
              layer.close(tmpLayerError);
            }, function () {
              customerService(order_id)
            });
          } else if(4 === json.error){
            // 超大件不允许取消
            layer.confirm(json.msg, {
              title: 'Failed',
              skin: 'yzc_layer',
              btn: ['Customer Service'],
              btnAlign: 'c'
            }, function (index) {
              layer.close(index);
              let customerServiceUrl = "{{ url('account/ticket/lists') }}";
              window.open(customerServiceUrl);
            });
          }else {
            myToastFn(json.msg, 'success');
            let params = getSearchQueryParams();
            clearTimer();
            $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
            });
            // var tmp = layer.confirm(json.msg, {
            //   title: 'Cancel',
            //   skin: 'yzc_layer',
            //   btn: ['OK'] //按钮
            // }, function () {
            //   layer.close(tmp);
            //   let params = getSearchQueryParams();
            //   clearTimer();
            //   $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
            //   });
            // });
          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layer.msg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText, {time: 3000, skin: ''});
        }
      });
    }, function () {
      layer.close(tmplayer);
    });

  }

  function cancelAll() {
    if (available_order_id == '' || available_order_id == []) {
      layerMsg('No order choosed.', 3000);
      return false;
    }

    content = '<div>Are you sure to cancel the ' + available_order_id.length + ' order(s)?</div>' +
      '<div class="content-con-sub-title">If you are sure, the purchase orders related with the order(s) will be cancled together.</div>';

    var tmplayer = layer.confirm(content, {
      title: 'Cancel',
      skin: 'yzc_layer',
      btn: ['OK'] //按钮
    }, function () {
      layer.close(tmplayer);
      let data = {id: available_order_id};
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/batchCancelOrder') }}",
        type: 'post',
        dataType: 'json',
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          if ('{{ filter_orderStatus }}' == 2 && json.error == 0) {
            var tmpLayerSuccess = layer.confirm('Canceled successfully. If you wish to return this item for refund, please apply for RMA.', {
              title: 'Cancel',
              skin: 'yzc_layer',
              btn: ['Close'],
              btnAlign: 'c',
              cancel: function () {
                let params = getSearchQueryParams();
                clearTimer();
                $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
                });
              }
            }, function () {
              layer.close(tmpLayerSuccess);
              let params = getSearchQueryParams();
              clearTimer();
              $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
              });
            });
          } else if (('{{ filter_orderStatus }}' == 2 && json.error == 1) || (json.error == 3)) { //status为2是BP状态下的判断  error为3是需求#2780 中源订单号被下载就不能取消
            var tmpLayerError = layer.confirm('This order has already been processed for delivery and cannot be canceled for immediate refund. Please apply for RMA after the order is completed. To stop the order now, please click Customer Service to submit the request.', {
              title: 'Cancel',
              skin: 'yzc_layer',
              btn: ['Close', 'Customer Service'],
              btnAlign: 'c'
            }, function () {
              layer.close(tmpLayerError);
            }, function () {
              customerService(json.first_sales_order_id)
            });
          } else {
            myToastFn(json.msg, 'success');
            let params = getSearchQueryParams();
            clearTimer();
            $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
            });
            // var tmp = layer.confirm(json.msg, {
            //   title: 'Cancel',
            //   skin: 'yzc_layer',
            //   btn: ['OK'] //按钮
            // }, function () {
            //   layer.close(tmp);
            //   let params = getSearchQueryParams();
            //   clearTimer();
            //   $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
            //   });
            // });
          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layer.msg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText, {
            time: 3000,
            skin: ''
          });
        }
      });
    }, function () {
      layer.close(tmplayer);
    });
  }

  function singlePaid(id) {
    var arr = [];
    arr.push(id);
    beforeInventoryRequestCheckPreLocked(arr);
  }

  function beforeInventoryRequestCheckPreLocked(orderIds) {
    $.ajax({
      url: '{{ url("sales_order/match/getSalesOrdersPreLocked") }}',
      type: 'POST',
      data: {order_ids: orderIds.join(',')},
      success:function (res) {
        if(res.code && res.data.exist_locked){
          let salesOrderIds = res.data.sales_order_ids;
          let lockedQty = res.data.locked_qty;
          let msg = 'The Sales Order (ID:'+salesOrderIds.join(',')+') have locked '+lockedQty+' products in inventory. By clicking \'Re-assign\', those products will be released by default, and then you will enter the pop-up window to manually assign the inventory again.';
          layer.confirm(msg, {
            skin: 'oris-layer',
            title: 'Message',
            btn: ['Re-assign'],
            btnAlign:'c',
            scrollbar: false
          }, function (lay_index) {
            layer.close(lay_index);
            reassignSalesOrdersPreLocked(orderIds)
          });
        }else{
          matchBox(orderIds);
        }
      },
      error:function () {
        matchBox(orderIds);
      }
    });
  }

  function reassignSalesOrdersPreLocked(orderIds) {
    $.ajax({
      url: '{{ url("sales_order/match/reassignSalesOrdersPreLocked") }}',
      type: 'POST',
      data: {order_ids: orderIds.join(',')},
      success:function (res) {
        matchBox(orderIds);
      },
      error:function () {

      }
    })
  }

  function matchPaid() {
    // var salesOrderIdArray = [753623,753624,753625,753626];
    if (available_order_id == '' || available_order_id == []) {
      layerMsg('No order choosed.', 3000);
      return false;
    }
    beforeInventoryRequestCheckPreLocked(available_order_id);
  }

  $('body').on('hidden.bs.modal', '#saleOrderModal', function () {
    $(this).removeData("bs.modal");
    $('#saleOrderModal').remove();
  });

  // release order
  function releaseOrder(id) {
    var tmplayer = layer.confirm('Do you confirm to release this order?', {
      title: 'Confirm',
      skin: 'yzc_layer',
      btn: ['Yes', 'No'] //按钮
    }, function () {
      layer.close(tmplayer);
      let data = {id: id};
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/releaseOrder') }}",
        type: 'post',
        dataType: 'json',
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          myToastFn(json.msg, 'success');
          let params = getSearchQueryParams();
          clearTimer();
          $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
          });
          // var tmp = layer.confirm(json.msg, {
          //   title: 'Confirm',
          //   skin: 'yzc_layer',
          //   btn: ['OK'] //按钮
          // }, function () {
          //   layer.close(tmp);
          //   let params = getSearchQueryParams();
          //   clearTimer();
          //   $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
          //   });
          // });
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layer.msg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText, {
            time: 3000,
            skin: ''
          });
        }
      });
    }, function () {
      layer.close(tmplayer);
    });
  }

  function releaseAll() {
    if (available_order_id == '' || available_order_id == []) {
      layerMsg('No order choosed.', 3000);
      return false;
    }
    var tmplayer = layer.confirm('Do you confirm to release all choosed order?', {
      title: 'Confirm',
      skin: 'yzc_layer',
      btn: ['Yes', 'No'] //按钮
    }, function () {
      layer.close(tmplayer);
      let data = {id: available_order_id};
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/batchReleaseOrder') }}",
        type: 'post',
        dataType: 'json',
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          myToastFn(json.msg, 'success');
          let params = getSearchQueryParams();
          clearTimer();
          $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
          });
          // var tmp = layer.confirm(json.msg, {
          //   title: 'Confirm',
          //   skin: 'yzc_layer',
          //   btn: ['OK'] //按钮
          // }, function () {
          //   layer.close(tmp);
          //   let params = getSearchQueryParams();
          //   clearTimer();
          //   $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
          //   });
          // });
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layer.msg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText, {
            time: 3000,
            skin: ''
          });
        }
      });
    }, function () {
      layer.close(tmplayer);
    });
  }

  function showFailureLog($html_str) {
    layer.confirm(decodeURI($html_str), {
      title: '{{ dialog_title_fail_log }}',
      skin: 'yzc_layer',
      btn: ['OK'],
      area: ['40%', 'auto']
    })
  }

  function editSku(line_id, obj) {
    //关闭同一订单中的其他SKU编辑
    $(obj).parentsUntil(".table-body-left").parent().find(".save-back").each(function (index, domEle) {
      let data_line_id = $(domEle).attr("data-line-id");
      if (data_line_id != line_id) {
        editSkuCancel(data_line_id, domEle);
      }
    });

    var div = line_id + '_div';
    var item_code = line_id + '_item_code';
    $('#' + div).show();
    $('#' + item_code).hide();
  }

  function editSkuCancel(line_id, obj) {
    var div = line_id + '_div';
    var item_code = line_id + '_item_code';
    $('#' + div).hide();
    $('#' + item_code).show();
  }

  function updateSku(line_id, order_id, obj, is_international, order_status) {
    if (is_international && order_status == 1) {
      let data = {order_id: order_id};
      var ajax_info;
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/checkIsExistAssociate') }}",
        type: 'post',
        dataType: 'json',
        async: false,
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          ajax_info = json;
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layer.msg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText, {time: 3000, skin: ''});
        }
      });
      if (ajax_info.error) {
        layer.confirm('Order has existing connected purchase order, Item Code unable to be modified. To modify the Item Code, cancel the connected purchase order.', {
          title: 'Confirm',
          skin: 'yzc_layer',
          btn: ['Go to matching purchase order', 'Close'],
          btnAlign: 'c',
        }, function () {
          if (ajax_info.order_num == 1) {
            window.open("{{ url('account/order',{'filter_PurchaseOrderId':''}) }}" + ajax_info.order_id, '_blank');
          } else {
            window.open("{{ url('account/order') }}", '_blank');
          }
          layer.closeAll();
        }, function () {
          layer.closeAll();
        });
        return false;
      }
    }
    $(this).tooltip('destroy');
    layer.load(1, {shade: [0.3, '#000']});
    var val = $('#' + line_id).val();
    // var div = line_id + '_div';
    // var item_code = line_id + '_item_code';
    // $('#'+ div).hide();
    // $('#'+ item_code).show();
    if (val == null) {
      layer.closeAll('loading');
    } else {
      let data = {order_id: order_id, line_id: line_id, product_id: val};
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/salesOrderSkuChange') }}",
        type: 'post',
        dataType: 'json',
        data: data,
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (json) {
          layer.closeAll('loading');
          if (json.success == 1) {
            myToastFn(json.msg, 'success', 8000);
          } else {
            myToastFn(json.msg, 'error');
          }
          let params = getSearchQueryParams();
          clearTimer();
          $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
          });
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll('loading');
          layerMsg(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
      });
    }
  }

  function redirectToDeliveryList(order_id) {
    window.location.href = "{{ url('account/deliverySignature',{'id':''}) }}" + order_id;
  }

  function checkLtl(order_id) {
    var ltl_url = "{{ url('account/sales_order/sales_order_management/salesOrderCheckLtl',{'id':''}) }}" + order_id;
    layer.open({
      type: 2,
      area: ['1000px', '600px'],
      title: 'LTL Confirm',
      fixed: false, //不固定Change
      maxmin: true,
      skin: 'yzc_layer all-LTL-confirm',
      scrollbar: false,
      content: ltl_url,
      end: function () {
        let params = getSearchQueryParams();
        clearTimer();
        block.blockUI();
        $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
          block.unBlockUI();
        });
      }
    });
  }

  $('#ltl_check').on('click', function () {
    if (available_order_id == '' || available_order_id == []) {
      layerMsg('No order choosed.', 3000);
      return false;
    }
    var s = available_order_id;
    s = s.join('_');
    var ltl_url = "{{ url('account/sales_order/sales_order_management/salesOrderCheckLtl',{'id':''}) }}" + s;
    layer.open({
      type: 2,
      offset: '100px',
      area: ['1000px', '600px'],
      title: 'LTL Confirm',
      fixed: false, //不固定Change
      maxmin: true,
      skin: 'yzc_layer all-LTL-confirm',
      scrollbar: false,
      content: ltl_url,
      end: function () {
        let params = getSearchQueryParams();
        clearTimer();
        $('#salesOrderListPanel').load(order_url + '&' + $.param(params), function () {
        });
      }
    });
  });

  //输入后匹配建议
  $("#ShipToCountryList").bind("input propertychange", function () {
    if ($(this).val() != '') {
      $.ajax({
        url: "{{ url('account/sales_order/sales_order_management/getCountryInfo',{'keyword':''}) }}" + encodeURIComponent($(this).val()),
        method: "GET",
        dataType: 'json',
        async: false,
        success: function (json) {
          let list = "";
          $.each(json, function (k, v) {
            list += "<li><a>" + v.name + "</a></li>";
          });
          if (list) {
            $("#myModalModifyAddress .dropdown-menu").html(list);
            $('#ShipToCountryList').parent().find(".dropdown-menu").show();
          } else {
            $('#ShipToCountryList').parent().find(".dropdown-menu").hide();
          }
        }
      });
      $("#modifyCountryRemove").show();
    } else {
      $("#modifyCountryRemove").hide();
    }
  });
  //赋值给input框
  $("#myModalModifyAddress .dropdown-menu").on("click", "li", function () {
    $(this).parent().parent().find("input").val($(this).text());
    $("#modifyCountryRemove").show();
    $(this).parent().hide()
  });
  //清除值
  $("#modifyCountryRemove").click(function () {
    $(this).next().val("");
    $(this).hide();
  });

  //点击其他地方隐藏下拉框
  $(document).bind('click', function (event) {
    var evt = event.srcElement ? event.srcElement : event.target;
    evt = $(evt);
    if (evt.hasClass("dropdown-in")) {

    } else {
      $("body #myModalModifyAddress").find(".dropdown-menu").hide();
    }

  });
  // 联想shiptocountry
</script>
{#这是修改地址的模态script#}
<script>
  // 提示框
  function myToastFn(message, type, time = 3000) {
    $.toast({
      heading: false,
      text: message,
      position: 'top-center',
      showHideTransition: 'fade',
      icon: type,
      hideAfter: time,
      allowToastClose: false,
      loader: false
    })
  }
</script>

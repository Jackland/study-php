{#<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js" type="text/javascript"></script>#}
{#<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js"#}
{#        type="text/javascript"></script>#}
{#<link href="/catalog/view/javascript/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet"#}
{#      media="screen">#}
{#<script type="text/javascript" src="/catalog/view/javascript/datetimepicker/bootstrap-datetimepicker.min.js"#}
{#        charset="UTF-8"></script>#}
{#<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>#}

{#搜索#}
<div class="filter-wrapper form-wrapper">
  <div class="row">
    <div class="col-sm-4">
      <div class="form-group">
        <label for="inputOrderDateFrom">Upload Date</label>
        <div class="datetimepicker-range">
          <div class="col-sm-6" style="padding: 0">
            <div class="datetimepicker" style="margin-left: 0;padding: 0">
              <input type="text" name="filter_orderDate_from" value="" class="form-control"
                     id="inputOrderRecordDateFrom" placeholder="Pick a date..." autocomplete="off">
              <span class="title">From</span>
              <span class="icon"><i class="giga icon-date-icon"></i></span>
            </div>
          </div>
          <div class="col-sm-6" style="padding: 0">
            <div class="datetimepicker" style="padding: 0">
              <input type="text" name="filter_orderDate_to" value="" class="form-control"
                     id="inputOrderRecordDateTo" placeholder="Pick a date..." autocomplete="off">
              <span class="title">To</span>
              <span class="icon"><i class="giga icon-date-icon"></i></span>
            </div>
          </div>
        </div>
      </div>
    </div>
{#    <div class="col-sm-3">#}
{#      <div class="form-group">#}
{#        <label for="inputOrderDateFrom">Upload Date</label>#}
{#        <div class="datetimepicker-range">#}
{#          <div class="datetimepicker" style="margin-left: 0">#}
{#            #}
{#            <span class="title" style="top: 6px;left: 17px">From</span>#}
{#            <span class="icon"><i class="giga icon-date-icon"></i></span>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{#    <div class="col-sm-3">#}
{#      <div class="form-group">#}
{#        <label for="inputOrderDateTo" style="color: #fff" >Upload Date</label>#}
{#        <div class="datetimepicker-range">#}
{#          <div class="datetimepicker">#}
{#           #}
{#            <span class="title" style="top: 6px;left: 17px">To</span>#}
{#            <span class="icon"><i class="giga icon-date-icon"></i></span>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
    <div class="col-sm-4 quick-btns">
      <span class="quick-btn-item" id="quickMonthRecord">One Month</span>
      <span class="quick-btn-item" id="quickWeekRecord">One Week</span>
    </div>
    <div class="col-sm-4" style="height: 58px;padding-top: 26px;text-align: right;">
      <button type="button" class="btn btn-primary"  onclick="recordFilter()">Filter</button>
    </div>
  </div>
</div>
{#搜索#}

{#列表#}
<div class="order-list">
  <div class="order-list-item">
    <table class="table table-responsive table-item ">
      <thead>
      <tr>
        <th class="text-center" style="width:20%">
          <span class="hover-pointer" data-toggle="tooltip"data-html="true" title="<p>Only records uploaded <br/> within the last year <br/> will  be saved.</p>" >
            File Name
            <i class="giga icon-V10-wenhaotishi" style="font-size: 14px"></i>
          </span>
        </th>
        <th class="text-center" style="width: 55%">Status</th>
        <th class="text-center" style="width:15%">Creation Time</th>
        <th class="text-center">Download</th>
      </tr>
      </thead>
      <tbody>
      {% if historys %}
        {% for history in historys %}
          <tr>
            <td style="text-align: left;word-break:break-word">{{ history.file_name }}</td>
            <td style="text-align: left;width: 55%;;word-break:break-word">
              {% if history.handle_status == 1 %}
                <i class="giga icon-action-confirm-and-agree" aria-hidden="true"
                   style="color: #00CC00;cursor: pointer"></i>
              {% else %}
                <i class="giga icon-action-warning" aria-hidden="true"
                   style="color: #DB0000;cursor: pointer"></i>
              {% endif %}
              &nbsp;{{ history.handle_message }}
            </td>
            <td class="text-center" style="width:15%">{{ history.create_time }}</td>
            <td class="text-center">
              <a style="cursor: pointer"
                 onclick=" window.location.href='{{ history.file_path }}'">
                &nbsp;<i class="giga icon-table-download"></i>
              </a>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td class="text-center" colspan="4">{{ text_no_results }}</td>
        </tr>
      {% endif %}
      </tbody>
    </table>
  </div>
</div>
{#列表#}

{#分页#}
<div class="row mt-2" style="margin-right: 0">
  <div class="col-sm-12 text-right bos_pagination_record">
    <ul id="bos_pagination_record"></ul>
  </div>
</div>
{#分页#}

<script>
  //页面加载
  $(document).ready(function () {
    pagination();
    let filter_orderDate_from = '{{ filter_orderDate_from }}';
    let filter_orderDate_to = '{{ filter_orderDate_to }}';
    if(filter_orderDate_from){
      filter_orderDate_from = filter_orderDate_from.substring(0,10);
      $('#inputOrderRecordDateFrom').val(filter_orderDate_from);
    }
    if(filter_orderDate_to){
      filter_orderDate_to = filter_orderDate_to.substring(0,10);
      $('#inputOrderRecordDateTo').val(filter_orderDate_to);
    }
  });

  //时间选择格式
  $('#inputOrderRecordDateFrom').datetimepicker({
    minView: 2,
    format: 'yyyy-mm-dd',
    autoclose: true,
    forceParse: true
  });
  $('#inputOrderRecordDateTo').datetimepicker({
    minView: 2,
    format: 'yyyy-mm-dd',
    autoclose: true,
    forceParse: true
  });
  $("#inputOrderRecordDateFrom").on('click foucs',function () {
    $('#inputOrderRecordDateTo').datetimepicker('hide');
  })
  $("#inputOrderRecordDateTo").on('click foucs',function () {
    $('#inputOrderRecordDateFrom').datetimepicker('hide');
  })

  var now = new Date();
  //一周的时间
  $('#quickWeekRecord').click(function () {
    // quickRecordDate(6);
    var weektime = new Date().setDate((new Date().getDate() - 7));
    $('#inputOrderRecordDateFrom').datetimepicker('setDate', new Date(weektime));
    $('#inputOrderRecordDateTo').datetimepicker('setDate', new Date());
  });
  //一个月的时间
  $('#quickMonthRecord').click(function () {
    // quickRecordDate(29);
    var monthtime = new Date().setMonth((new Date().getMonth() - 1));
    $('#inputOrderRecordDateFrom').datetimepicker('setDate', new Date(monthtime));
    $('#inputOrderRecordDateTo').datetimepicker('setDate', new Date());
  });

  //分页
  function pagination() {
    if ({{ total_pages }}) {
      //total_pages
      $('#bos_pagination_record').bootstrapPaginator({
        /*当前使用的是3版本的bootstrap*/
        bootstrapMajorVersion: 3,
        /*配置的字体大小是小号*/
        size: 'normal',
        /*当前页*/
        currentPage: {{ page_num }},
        /*一共多少页*/
        totalPages: {{ total_pages }},
        /*页面上最多显示几个含数字的分页按钮*/
        numberOfPages: 5,
        total: {{ total }},
        rowsOfPage: {{ page_limit | default(100) }},

        onPageClicked: function (event, originalEvent, type, page) {
          layer.load(1,{shade: [0.3,'#000']});
          let url = getUrl('index.php?route=account/sales_order/sales_order_management/salesOrderRecord',page);
          $('#recordsPanel').load(url,function () {
            layer.closeAll('loading');
          });
        }
      });
    }
  }

  //获取时间段的时间
  function quickRecordDate(day) {
    let now = new Date();
    let oneweekdate = new Date(new Date() - day * 24 * 3600 * 1000);
    let y = oneweekdate.getFullYear();
    let m = oneweekdate.getMonth() + 1;
    let d = oneweekdate.getDate();
    let nowDate = y + '-' + m + '-' + d;
    $('#inputOrderRecordDateFrom').datetimepicker('setDate', new Date(nowDate));
    $('#inputOrderRecordDateTo').datetimepicker('setDate', new Date());
  }

  //页面加载带的参数
  function getUrl(url,page) {
    let filter_orderDate_from =$('#inputOrderRecordDateFrom').val();
    if (filter_orderDate_from) {

      url += '&filter_orderDate_from=' + encodeURIComponent(moment(filter_orderDate_from).format('YYYY-MM-DD 00:00:00'));
    }
    let filter_orderDate_to = $('#inputOrderRecordDateTo').val();
    if(filter_orderDate_to){
      url += '&filter_orderDate_to=' + encodeURIComponent(moment(filter_orderDate_to).format('YYYY-MM-DD 23:59:59'));
    }
    if (page) {
      url += "&page_num=" + page;
    }

    return url;
  }

  //搜索
  function recordFilter() {
    let url = getUrl('index.php?route=account/sales_order/sales_order_management/salesOrderRecord','');
    layer.load(1,{shade: [0.3,'#000']});
    $('#recordsPanel').load(url,function () {
      layer.closeAll('loading');
    });
  }


</script>
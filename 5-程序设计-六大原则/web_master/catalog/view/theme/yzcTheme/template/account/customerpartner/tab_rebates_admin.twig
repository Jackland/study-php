<div class="panel">
  <div class="panel-body" style="padding:0;">
    <div class="well">
      <div class="row">
        <div class="col-sm-4">
          <div class="form-group">
            <label class="control-label" for="rebates_input-id">{{ column_contract_id }} </label>
            <input type="text" name="rebates_filter_id" value="{{ contract_id }}" placeholder="{{ column_contract_id }}"
                   id="rebates_input-id" class="form-control"/>
          </div>
          <div class="form-group" style="padding:15px 0">
            {#            <label class="control-label" for="rebates_input-date_from">{{ column_date_from }} </label>#}
            <label class="control-label col-sm-12" for="rebates_input-date_from">ADDED DATE RANGE</label>
            <div class="input-group date col-sm-6" style="float:left;">
              <input type="text" name="rebates_filter_date_from" id="rebates_input-date_from" class="form-control"
                     value="{{ filter_date_from }}" placeholder="{{ text_pick_date }}"/>
              <span class="input-group-btn"><button class="btn btn-default"><i
                    class="fa fa-calendar"></i></button></span>
            </div>
            <div class="input-group date col-sm-6" style="float:left;">
              <input type="text" name="rebates_filter_date_to" id="rebates_input-date_to" class="form-control"
                     value="{{ filter_date_to }}" placeholder="{{ text_pick_date }}"/>
              <span class="input-group-btn"><button class="btn btn-default"><i
                    class="fa fa-calendar"></i></button></span>
            </div>
          </div>
        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label class="control-label" for="rebates_input-status">{{ column_status }} </label>
            <select name="rebates_filter_status" class="form-control" id="rebates_input-status">
              <option value="*">--- {{ __('请选择', {}, 'common') }} ---</option>
              {% if quote_status %}
                {% for key, status_value in quote_status %}
                  <option
                    value="{{ key }}" {% if filter_status == key and filter_status is not null %}{{ 'selected' }}{% endif %}>{{ status_value }} </option>
                {% endfor %}
              {% endif %}
            </select>
          </div>
          <div class="form-group">
            <label class="control-label" for="rebates_input-store">{{ column_buyer }} </label>
            <input type="text" name="rebates_filter_buyer_name" value="{{ filter_buyer_name }}"
                   placeholder="{{ column_buyer }}" id="rebates_input-store" class="form-control"/>
          </div>

        </div>
        <div class="col-sm-4">
          <div class="form-group">
            <label class="control-label" for="rebates_input-sku_mpn">{{ column_item_code_mpn }} </label>
            <input type="text" name="rebates_filter_sku_mpn" value="{{ filter_sku_mpn }}"
                   placeholder="{{ column_item_code_mpn }}" id="rebates_input-sku_mpn" class="form-control"/>
          </div>
          <div class="form-group" style="margin-top: 20px;border: none;">

            <a onclick="filterRebates(this);" class="btn btn-primary pull-right" data-toggle="tooltip"
               title="{{ btn_filter }} " id="rebates-filter-btn">
              {{ btn_filter }} </a>
            <a onclick="refreshRebates(this);" class="btn btn-default pull-right" data-toggle="tooltip"
               title="RESET " id="rebates-filter-btn">
              <i class="fa fa-refresh"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-product">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
          <tr>
            <td class="text-center">{{ column_contract_id }} </td>
            <td class="text-center">{{ column_item_code }} </td>
            <td class="text-center">{{ column_mpn }} </td>
            <td class="text-center">{{ column_image }} </td>
            <td class="text-center">{{ column_day }} </td>
            <td class="text-center">{{ column_qty }} </td>
{#            <td class="text-center">{{ column_freight }}
              <i class="giga icon-V10-wenhaotishi" data-toggle="tooltip" style="font-size: 13px;" title="{{ tip_freight_in_bid }}"></i></td>#}
            <td class="text-center">{{ column_price }} </td>
            <td class="text-center">{{ column_discount }} </td>
            {#<td class="text-center">{{ column_discount_price }} </td>#}
            <td class="text-center"><a onclick="filterRebates(this,'status','{{ order }}');"
                {% if sort == 'status' %} class="{{ order|lower }}" {% endif %}>{{ column_status }} </a></td>
            <td class="text-center">
              <a onclick="filterRebates(this,'update_time','{{ order }}');"
                {% if sort == 'update_time' %} class="{{ order|lower }}" {% endif %}>{{ column_modified_date }} </a></td>
            <td class="text-center">
              <a onclick="filterRebates(this,'nickname','{{ order }}');"
                {% if sort == 'nickname' %} class="{{ order|lower }}" {% endif %}>{{ column_buyer_name }} </a></td>
            <td class="text-center">{{ column_action }} </td>
          </tr>
          </thead>

          {% if rebates_contracts %}
            {% for result in rebates_contracts %}
              <tbody>
              <tr>
                <td class="text-center">{{ result.contract_id }}</td>
                <td class="text-center" style="white-space: nowrap">
                  <a target="_blank" href="{{ result.product_url }}">{{ result.sku }}</a></td>
                <td class="text-center" style="white-space: nowrap">{{ result.mpn }}</td>
                <td class="text-left"><img src="{{ result.image }}" class="thumbnail pull-left"
                                           style="margin-right:10px;"/></td>
                <td class="text-center">{{ result.day }} </td>
                <td class="text-center">{{ result.qty }} </td>
{#                <td class="text-center">{{ result.freight_in_bid }} </td>#}
                <td class="text-center">{{ result.price }} </td>
                <td class="text-center">{{ result.rebates_discount_text }} </td>
                {#<td class="text-center">{{ result.rebates_price }} </td>#}
                <td class="text-center">
                  {% set statusClass = result.status == 2 ? 'status_reject' :  result.status == 3 ? 'status_approve' %}
                  <span class="{{ statusClass }}">{{ result.status_text }}
                    {% if 4 == result.status %}
                      <i class="giga icon-V10-wenhaotishi" data-toggle="tooltip" style="font-size: 13px;" title="{{ tip_time_out }}"></i>
                    {% endif %}
                  </span>
                </td>
                <td class="text-center">{{ result.update_time }} </td>
                <td class="text-center">
                  <span class="user_portrait" data-user_customer_id="{{ result.buyer_id }}" >
                  {{ result.buyer_name }}
                  </span>
                  <span>
                       <img data-toggle="tooltip" style="padding-left: 1px"
                           src="{{ result.is_home_pickup?img_home_pickup:img_drop_shipping }}"
                           data-original-title="{{ result.is_home_pickup?tip_home_pickup_logo:tip_drop_shipping_logo }}">
                  </span>
                </td>
                <td class="text-center" style="width: 100px">
                  <a href="{{ result.action.href }}" class="btn btn-primary" data-toggle="tooltip"
                     title="{{ result.action.text }}"><i class="fa fa-eye"></i></a>
                </td>
              </tr>
              </tbody>
            {% endfor %}
          {% else %}
            <tbody>
            <tr>
              <td colspan="13" class="text-center">{{ text_no_results }} </td>
            </tr>
            </tbody>
          {% endif %}
        </table>
      </div>
    </form>
    <div class="row" style="padding-bottom: 12px">
      <div class="col-sm-12 text-right">
        <ul id="seller_rebate_pagination"></ul>
      </div>
    </div>
  </div>
</div>


<script src="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js"
        type="text/javascript"></script>
<link href="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css"
      rel="stylesheet" media="screen"/>

<script type="text/javascript">
    $('#rebates_input-date_from').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD 00:00:00'
    });
    $('#rebates_input-date_to').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD 23:59:59'
    });

    $(function () {
        rebate_pagination();
        block.unBlockUI();
        $('#rebates-filter-btn').button('reset');
    });

    function rebate_pagination() {
        if ({{ total_pages }}) {
            $('#seller_rebate_pagination').bootstrapPaginator({
                /*当前使用的是3版本的bootstrap*/
                bootstrapMajorVersion: 3,
                /*配置的字体大小是小号*/
                size: 'normal',
                /*当前页*/
                currentPage: {{ page_num }},
                /*一共多少页*/
                totalPages: {{ total_pages }},
                total: {{ total }},
                rowsOfPage: {{ page_limit | default(20) }},
                /*页面上最多显示几个含数字的分页按钮*/
                numberOfPages: 5,
                onPageClicked: function (event, originalEvent, type, page) {
                    let url = "{{ pagination_url }}";
                    if (page) {
                        url += "&page=" + page;
                    } else {
                        url += "&page=" + {{ page_num }};
                    }
                    block.blockUI();
                    $('#bid-rebates').load(url,function () {
                      block.unBlockUI();
                    });
                }
            });
        }
    }

    function refreshRebates() {
        block.blockUI();
        $('#bid-rebates').load('index.php?route=account/product_quotes/rebates_contract');
    }

    function filterRebates(_this,sort,order) {
        block.blockUI();

        url = '{{ action }}';

        var filter_id = $('input[name=\'rebates_filter_id\']').val();

        if (filter_id) {
            url += '&filter_id=' + encodeURIComponent(filter_id);
        }

        var filter_buyer_name = $('input[name=\'rebates_filter_buyer_name\']').val();

        if (filter_buyer_name) {
            url += '&filter_buyer_name=' + encodeURIComponent(filter_buyer_name);
        }

        var filter_sku_mpn = $('input[name=\'rebates_filter_sku_mpn\']').val();
        if (filter_sku_mpn) {
            url += '&filter_sku_mpn=' + encodeURIComponent(filter_sku_mpn);
        }

        var filter_status = $('select[name=\'rebates_filter_status\']').val();

        if (filter_status != '*') {
            url += '&filter_status=' + encodeURIComponent(filter_status);
        }

        var filter_date_from = $('input[name=\'rebates_filter_date_from\']').val();
        if (filter_date_from) {
            url += '&filter_date_from=' + encodeURIComponent(filter_date_from);
        }
        var filter_date_to = $('input[name=\'rebates_filter_date_to\']').val();
        if (filter_date_to) {
            url += '&filter_date_to=' + encodeURIComponent(filter_date_to);
        }
        if (sort){
            url += '&sort=' + encodeURIComponent(sort);
            if (order){
              url += '&order=' + encodeURIComponent(order);
            }
        }

        $('#bid-rebates').load(url);

        $("#rebates-filter-btn").button('loading');
    }
</script>
<style>
  .status_approve {
    color: #008000;
  }

  .status_reject {
    color: #FF0000;
  }
</style>
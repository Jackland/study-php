{{ header }}
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js" type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js"
        type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js"
        type="text/javascript"></script>
<link href="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css"
      rel="stylesheet" media="screen"/>
<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<style>
  .main-content {
    background: #fff;
    padding: 20px 10px;
    margin-bottom: 30px;
  }

  .main-content .well {
    border: none;
  }

  .btn.btn-default {
    color: #3A75DC;
    border: 1px solid #3A75DC;
  }

  .btn.btn-default:hover,
  .btn.btn-default:focus {
    background: #3a75dc;
    color: #fff;
  }

  .btn.btn-primary {
    color: #fff;
    border: 1px solid #3A75DC;
    background: #3a75dc;
    line-height: 22px;
  }

  .btn.btn-view {
    width: 28px;
    height: 28px;
    line-height: 28px;
    padding: 0;
    text-align: center;
  }

  .btn.btn-view:hover,
  .btn.btn-view:focus {
    background: #fa6400;
    color: #fff;
  }

  .btn.btn-view i {
    font-size: 14px;
  }

  .border-radius-left-none {
    border-bottom-left-radius: 0 !important;
    border-top-left-radius: 0 !important;
  }

  .flex-layout {
    display: flex;
    align-items: center;
  }

  .ml-1 {
    margin-left: 10px;
  }

  .mr-1 {
    margin-right: 10px;
  }
</style>
<div id="account-customer-order" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>
  <div class="row">{{ column_left }}
    {% if column_left and column_right %}
      {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
      {% set class = 'col-sm-9' %}
    {% else %}
      {% set class = 'col-sm-12' %}
    {% endif %}
    <h2>{{ text_out_stock_record }}</h2>
    <div id="content" class="{{ class }} main-content">{{ content_top }}
      <div class="well">
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <label class="control-label" for="filter_nickname">Nickname</label>
              <input type="text" id="filter_nickname" name="filter_nickname" value="{{ filter_nickname }}"
                     placeholder="Nickname" class="form-control"/>
            </div>
          </div>
          <div class="col-sm-8">
            <div class="form-group">
              <label class="control-label">Creation Time</label>
              <div class="flex-layout">
                <div class="input-group datetime col-sm-6 mr-1">
                <span class="input-group-addon ">
                  <i class="fa fa-calendar"></i>
                </span>
                  <input type="text" class="form-control datetimefrom border-radius-left-none" placeholder="from"
                         name="filter_orderDateStart" value="{{ filter_orderDateStart }}"/>
                </div>
                <div class="input-group datetime col-sm-6 ml-1">
                <span class="input-group-addon ">
                  <i class="fa fa-calendar"></i>
                </span>
                  <input type="text" class="form-control datetimeto border-radius-left-none" placeholder="to"
                         name="filter_orderDateEnd" value="{{ filter_orderDateEnd }}"/>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            {#出库类型#}
            <div class="form-group">
              <label class="control-label" for="filter_stockOutType">Dispatch Category</label>
              <select name="filter_stockOutType" id="filter_stockOutType" class="form-control">
                <option value="">{{ __('请选择', {}, 'common') }}</option>
                {% for dic,value in STOCK_OUT_TYPE %}
                  <option value="{{ dic }}" {% if filter_stockOutType==dic %}selected{% endif %}>{{ value }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="control-label" for="filter_orderId">Order ID</label>
              <input type="text" name="filter_orderId" value="{{ filter_orderId }}" placeholder="Order ID"
                     id="filter_orderId" class="form-control"/>
            </div>
          </div>
          <div class="col-sm-4 pull-right text-right" style="margin-top: 25px">
            <button type="button" onclick="loadPage();" class="btn btn-primary mr-1">{{ text_filter }}</button>
            <button id="exportCsvBtn" onclick="exportCsv();" class="btn btn-default" data-toggle="tooltip"
                    title="Export Csv">
              <i class="giga icon-xiazai1"></i>
            </button>
          </div>
        </div>
      </div>
      <div id="outStockRecord"></div>
      <div class="buttons clearfix">
        <div class="pull-right">
          <div onclick="history.back(-1)" class="btn btn-primary">Back</div>
        </div>
      </div>
      {{ content_bottom }}
    </div>
    {{ column_right }}
  </div>
</div>
{{ footer }}
<script>
  $(function () {
    init();
  });

  function init() {
    $('.datetimefrom').datetimepicker({
      pickDate: true,
      pickTime: false,
      format: 'YYYY-MM-DD'
    });
    $('.datetimeto').datetimepicker({
      pickDate: true,
      pickTime: false,
      format: 'YYYY-MM-DD'
    });
    loadPage();
  }

  function loadPage(page = 1) {
    var url = getUrlRecord(page);
    $("#outStockRecord").load(url);
  }

  function getUrlRecord(page = 1) {
    let url = "index.php?route=account/inventory_management/outStockRecordFilter&batch_id={{ batch_id }}&itemCode={{ itemCode }}";
    let filter_nickname = $('input[name=\'filter_nickname\']').val();
    if (filter_nickname) {
      url += '&filter_nickname=' + encodeURIComponent(filter_nickname);
    }
    let filter_stockOutType = $('select[name=\'filter_stockOutType\']').val();
    if (filter_stockOutType) {
      url += '&filter_stockOutType=' + encodeURIComponent(filter_stockOutType);
    }
    let filter_orderId = $('input[name=\'filter_orderId\']').val();
    if (filter_orderId) {
      url += '&filter_orderId=' + encodeURIComponent(filter_orderId);
    }
    let filter_orderDateStart = $('input[name=\'filter_orderDateStart\']').val();
    if (filter_orderDateStart) {
      url += '&filter_orderDateStart=' + encodeURIComponent(filter_orderDateStart);
    }
    let filter_orderDateEnd = $('input[name=\'filter_orderDateEnd\']').val();
    if (filter_orderDateEnd) {
      url += '&filter_orderDateEnd=' + encodeURIComponent(filter_orderDateEnd);
    }
    url += "&page_num=" + page;
    return url;
  }

  //用于面包屑
  function showOutStockRecord() {
    var form1 = document.createElement("form");
    document.body.appendChild(form1);
    var input = document.createElement("input");
    input.type = "text";
    input.name = "stock_in_url";
    input.value = '{{ stock_in_url }}';
    form1.appendChild(input);
    form1.method = "POST";
    form1.action = '{{ current }}';
    form1.submit();
  }

</script>
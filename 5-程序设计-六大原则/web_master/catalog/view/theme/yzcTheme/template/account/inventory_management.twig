{{ header }}
<style>
  input[type="checkbox"] {
    display: none;
  }

  input[type="checkbox"]:checked + span.icon:before {
    font-family: "giga" !important;
    font-size: 20px;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    content: "\e645";
    color: #3A75DC;
  }

  input[type="checkbox"] + span.icon:before {
    font-family: "giga" !important;
    font-size: 20px;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    content: "\e646";
    color: #a0a0a0;
  }
  #upload .btn.btn-default{
    padding: 8px 13px;
    color: #3A75DC;
    border: 1px solid #3A75DC;
  }
  #upload .btn.btn-default:hover,
  #upload .btn.btn-default:focus{
    background: #3a75dc;
    color: #fff;
  }
  #upload .btn.btn-primary{
    color: #fff;
    border: 1px solid #3A75DC;
    background: #3a75dc;
    line-height: 22px;
    padding: 8px 13px
  }
  #upload .btn.btn-primary:hover,
  #upload .btn.btn-primary:focus{
    background-color: #2d57a9;
    border-color: #2d57a9;
  }
  .mr-1{
    margin-right: 10px;
  }
</style>
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js" type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js"
        type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js"
        type="text/javascript"></script>
<link href="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css"
      rel="stylesheet" media="screen"/>
<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<div id="page-purchase-order-management" class="page-seller-portal">
  {#菜单#}
  {% include 'giga/template/_parts/breadcrumb_simple.twig' %}
  {#END 菜单#}

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>{{ text_title_inventory_management }}</h1>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-12">
        <div class="tab-content main">
          <div role="tabpanel" class="tab-pane active" id="upload">
            <div class="bg-white p-2">
              {#搜索#}
              <div class="filter-wrapper form-wrapper mt-3 mb-3">
                <div class="row">
                  <div class="col-sm-4">
                    <div class="form-group">
                      <label class="control-label" for="input-mpn">Item Code or MPN</label>
                      <input type="text" name="filter_mpn" value="{{ filter_mpn }}" placeholder="Item Code or MPN"
                             id="input-mpn" class="form-control"/>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div style="margin-top: 30px;">
                      <label for="filter_stockNumberFlag" style="text-transform: none;">
                        <input type="checkbox"
                               {% if filter_stockNumberFlag is not defined or  filter_stockNumberFlag==1 %}checked{% endif %}
                               name="filter_stockNumberFlag"
                               id="filter_stockNumberFlag">
                        <span class="icon"></span>
                        Display products with 0 inventory
                      </label>
                    </div>
                  </div>
                  <div class="col-sm-4">
                    <div class="form-group pull-right">
                      <label class="control-label">&nbsp;</label>
                      <div>
                        <button type="button" onclick="filter(this);" class="btn btn-primary mr-1">{{ text_filter }}</button>
                        <button id="exportCsvBtn" type="button" onclick="exportCsv();" class="btn btn-default"
                                data-toggle="tooltip" title="Export Csv">
                          <i class="giga icon-xiazai1"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {#列表#}
              <table id="inventoryTable" class="table main table-hover">
                <thead>
                <tr>
                  <th class="text-center" style="min-width: 11%">No.</th>
                  <th class="text-center" style="min-width: 11%">Item Code</th>
                  <th class="text-center">MPN</th>
                  <th class="text-center">Image</th>
                  {#累计入库数#}
                  <th class="text-center">Cumulative Number of Entries</th>
                  {#累计出库数#}
                  <th class="text-center">Cumulative Number of Exits</th>
                  {#剩余库存数#}
                  <th class="text-center">Number of Remaining Inventory</th>
                  <th class="text-center">Date of Next Arrival</th>
                  <th class="text-center">Estimated Quantity of Next Arrival</th>
                  <th class="text-center">Receiving Record</th>
                </tr>
                </thead>
                <tbody>
                {% if products %}
                  {% for product in products %}
                    <tr>
                      <td class="text-center">{{ product.loopIndex }}</td>
                      {% if product.tag %}
                        <td class="text-left" style="min-width: 138px">{{ product.sku }}
                          {% for tag in product.tag %}
                            <span style="font-weight: bold; color: red;padding-left: 1px">{{ tag }}</span>
                          {% endfor %}
                        </td>
                      {% else %}
                        <td class="text-left">{{ product.sku }}</td>
                      {% endif %}
                      <td class="text-center">{{ product.mpn }}</td>
                      <td class="text-center" width="67px">{% if product.image %} <a class="thumbnail"
                                                                                     style="margin-bottom: 0"
                                                                                     href="{{ product.image }}"
                                                                                     title='{{ product.name }}'><img
                            style="width: 40px;height: 40px" src="{{ product.image }}"/></a> {% else %} <span
                          class="img-thumbnail list"><i class="fa fa-camera fa-2x"></i></span> {% endif %}</td>
                      <td class="text-center text-price">{{ product.total_original_qty }}</td>
                      <td class="text-center text-price">{{ product.total_out_qty }}</td>
                      <td class="text-center text-price">{{ product.total_onhand_qty }}</td>
                      <td class="text-center">{{ product.expected_date }}</td>
                      <td class="text-center text-price">{{ product.expected_qty }}</td>
                      <td class="text-center">
                        <div class="action-group">
                          <button type="button" class="btn btn-view"
                                  onclick="window.location.href = '{{ product.batchStockUrl }}'">
                            <i class="giga icon-chakan1"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                {% else %}
                  <td colspan="10" align="center">No records.</td>
                {% endif %}
                </tbody>
              </table>

              {#分页#}
              <div class="row row mt-2">
                <div class="col-sm-12 text-right">
                  <ul id="bos_pagination"></ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(function () {
    init();
  });

  function init() {
    $('.thumbnail').magnificPopup({
      type: 'image'
      // delegate: 'a',
      // gallery: {
      //     enabled: true
      // }
    });
    //分页链接
    pagination();
  }

  function pagination() {
    if ({{ total_pages }}) {
      $('#bos_pagination').bootstrapPaginator({
        /*当前使用的是3版本的bootstrap*/
        bootstrapMajorVersion: 3,
        /*配置的字体大小是小号*/
        size: 'normal',
        /*当前页*/
        currentPage: {{ page_num }},
        /*一共多少页*/
        totalPages: {{ total_pages }},
        /*页面上最多显示几个含数字的分页按钮*/
        numberOfPages: 5,
        onPageClicked: function (event, originalEvent, type, page) {
          let url = getUrl(page);
          location.href = url;
        }
      });
    }
  }

  function getUrl(page) {
    let url = 'index.php?route=account/inventory_management';
    url += "&backUrlKey=" + '{{ backUrlKey }}';
    let filter_mpn = $('input[name=\'filter_mpn\']').val();
    if (filter_mpn) {
      url += '&filter_mpn=' + encodeURIComponent(filter_mpn);
    }

    if (!$('#filter_stockNumberFlag').is(':checked')) {
      url += '&filter_stockNumberFlag=0';
    }
    if (page) {
      url += "&page_num=" + page;
    }
    return url;
  }

  function filter(button) {
    var url = getUrl();
    location.href = url;
    $(button).button('loading');
  }

  function exportCsv() {
    {% if not products %}
    var tmplayer = layer.alert('No records found.', {
      title: 'Message',
      btn: 'OK',
      skin: 'yzc_layer' //样式类名
      , closeBtn: 0
    }, function () {
      layer.close(tmplayer);
    });
    return;
    {% endif %}
    var downloadBtn = document.getElementById('downloadBtn');
    if (downloadBtn != null) {
      downloadBtn.click();
      return;
    }
    $.ajax({
      url: 'index.php?route=account/inventory_management/exportInventoryCsv',
      type: 'post',
      data: {csv_filter_data: {{ csv_filter_data|json_encode|raw }}},
      dataType: 'json',
      beforeSend: function () {
        $('#exportCsvBtn').prop('disabled', true);
      },
      complete: function () {
        $('#exportCsvBtn').prop('disabled', false);
      },
      success: function (response) {
        if (response['success']) {
          var downloadBtn = document.createElement('a');
          downloadBtn.setAttribute('id', 'downloadBtn');
          downloadBtn.setAttribute('download', response['download_name']);
          downloadBtn.setAttribute('href', response['download_href']);
          downloadBtn.click();
          document.getElementById('inventoryTable').appendChild(downloadBtn);
        } else {
          var tmplayer = layer.alert(response['msg'], {
            title: 'Message',
            btn: 'OK',
            skin: 'yzc_layer' //样式类名
            , closeBtn: 0
          }, function () {
            layer.close(tmplayer);
          });
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        var tmplayer = layer.alert(thrownError + "<br>" + xhr.statusText + "<br>" + xhr.responseText, {
          title: 'Message',
          btn: 'OK',
          skin: 'yzc_layer' //样式类名
          , closeBtn: 0
        }, function () {
          layer.close(tmplayer);
        });
      }
    });
  }
</script>
{{ footer }}
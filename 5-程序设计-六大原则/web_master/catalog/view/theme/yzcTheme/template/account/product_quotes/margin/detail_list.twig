{{header}}
<div id="page-bid-list-spot-price-bid" class="page-seller-portal">
  {#菜单#}
  {% include 'giga/template/_parts/breadcrumb_simple.twig' %}
  {#END 菜单#}

  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>{{ heading_title_margin_details_long }}</h1>
        <div class="row">
          <div class="col-md-12">
            {% if error_warning %}
              <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i>{{error_warning}} </div>
            {% endif %}
            {% if success %}
              <div class="alert alert-success"><i class="fa fa-check-circle"> </i>{{success}} </div>
            {% endif %}

            {#Togglable tabs#}
            <ul class="nav nav-tabs main" role="tablist">
              <li id="protocol_detail_li" class="active"><a href="#tab_protocol_detail_li" data-toggle="tab">Margin Agreement Details</a></li>
              <li id="pay_proof_li"><a href="#tab_pay_proof_li" data-toggle="tab">Margin Payment History</a></li>
              <li id="account_check_li"><a href="#tab_account_check_li" data-toggle="tab">Margin Transaction Details</a></li>
              {#<li id="storage_li"><a href="#tab_storage_li" data-toggle="tab">Margin Items Inventory Storage Fee Details</a></li>#}
              <div class="text-right pull-right">
                <a href="{{ href_go_back }}" class="btn btn-default" data-toggle="tooltip" title="Go Back">
                  <i class="fa fa-reply"></i>
                </a>
              </div>
            </ul>

          </div>
        </div>
      </div>
    </div>


    {#tab页对应内容#}
    <div class="row mb-4">
      <div class="col-md-12">
        <div class="tab-content main">
          <div class="tab-pane active" id="tab_protocol_detail_li">
            <fieldset>
              <div id="bid-protocol_detail"></div>
            </fieldset>
          </div>
          <div class="tab-pane" id="tab_pay_proof_li">
            <fieldset>
              <div id="bid-pay_proof"></div>
            </fieldset>
          </div>
          <div class="tab-pane" id="tab_account_check_li">
            <fieldset>
              <div id="bid-account_check"></div>
            </fieldset>
          </div>
          {#<div class="tab-pane" id="tab_storage_li">#}
            {#<fieldset>#}
              {#<div id="bid-storage"></div>#}
            {#</fieldset>
          {#</div>#}
        </div>
      </div>
    </div>
  </div>
</div>

{{footer}}
<script>
    var margin_id="{{ id }}";
    var order_id="{{ order_id }}";
    var actionother="{{ actionother }}";
    block.unBlockUI();
    $('#bid-protocol_detail').load('index.php?route=account/product_quotes/margin/protocol_detail&id='+margin_id+'&actionother='+actionother);
    if(order_id){
        $('#bid-pay_proof').load('index.php?route=account/product_quotes/margin/pay_proof&id='+margin_id+'&order_id='+order_id);
    }
    $('#bid-account_check').load('index.php?route=account/product_quotes/margin/account_check&id='+margin_id);
    /*$('#bid-storage').load('index.php?route=account/product_quotes/margin/show_storage&id='+margin_id);*/
</script>
<script>
  /*判断obj是否为一个整数*/
  function isInteger(obj){
    return Math.floor(obj) === obj;
  }

  /**
   * 将一个浮点数转换成整数，返回整数和倍数
   * 如 3.14 》》314  倍数是100
   *
   */

  function toInteger(floatNum){
    var ret = {times:1,num:0};

    //是整数
    if(isInteger(floatNum)){
      ret.num = floatNum;
      return ret;
    }

    var strfi = floatNum + '';
    //查找小数点的下标
    var dotPos = strfi.indexOf('.');
    //获取小数的位数
    var len = strfi.substr(dotPos+1).length;
    //Math.pow(10,len)指定10的len次幂。
    var time = Math.pow(10,len);

    //将浮点数转化为整数
    var intNum = parseInt(floatNum*time + 0.5,10);
    ret.times = time;
    ret.num = intNum;
    return ret;
  }

  /**
   *进行运算
   *三个参数分别是要运算的两个数和运算符
   */
  function operation(a,b,op,precision){
    var o1 = toInteger(a);
    var o2 = toInteger(b);
    var n1 = o1.num;
    var n2 = o2.num;
    var t1 = o1.times;
    var t2 = o2.times;
    var max = t1 > t2 ? t1 : t2;
    var result = null;
    switch(op){
      case 'add':
        if(t1 === t2){
          result = n1 + n2;
        }else if(t1 > t2){
          result = n1 + n2 * (t1/t2);
        }else{
          result = n1 * (t2/t1) + n2;
        }
        result = result / max;
        break;
      case 'subtract':
        if(t1 === t2){
          result = n1  - n2;
        }else if(t1 > t2){
          result = n1 - n2 * (t1/t2);
        }else{
          result = n1 * (t2/t1) - n2;
        }
        result = result / max;
        break;
      case 'multiply':
        result = (n1 * n2)/(t1 * t2);
        break;
      case 'divide':
        result = (n1 / n2)/(t2 / t1);
        break;
    }
    if (isInteger(precision) && precision >= 0) {
      result = result + "";
      let len = result.length;
      let dotIndex = result.indexOf(".");
      if (dotIndex === -1) {
        result = Number(result).toFixed(precision);
      } else {
        let dotIndexBefore = dotIndex + precision;
        let dotIndexAfter = dotIndexBefore + 1;
        if (dotIndexAfter < len) {
          let n = result.substr(dotIndexAfter, 1);
          if (precision === 0) {
            //为0时dotIndexBefore用的是小数点，所以要减一
            dotIndexBefore--;
          }
          let m = result.substr(dotIndexBefore, 1);
          result = result.slice(0, dotIndexBefore);
          if (n > 4) {
            if (m === '9') {
              //防止进位
              if(precision === 0){
                m = m + '.9';
              }else{
                m = m + '9';
              }
            } else {
              m = Number(m) + 1;
            }
          }
          result = Number(result + m).toFixed(precision);
        }
      }
    }
    return result;
  }
</script>

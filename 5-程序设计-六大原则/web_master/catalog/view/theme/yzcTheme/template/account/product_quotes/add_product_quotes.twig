{# 已作废，使用product\quote_bid_modal.twig文件 #}
<style>
    .modal-content{
        border-radius: 4px;
    }
    #myModal-quote-product .modal-body > div{
        margin-bottom: 15px;
    }
    .contract-offer {
        color: #FA6400;
        display: flex;
        align-items: center;
    }

    .quoted-price {
        padding: 0 5px;
        border: 1px solid #fff0e6;
        border-radius: 4px;
    }

    .quoted-price > table {
        margin: 0;
        text-align: center;
    }

    .quoted-price > table > tbody > tr > td {
        border-color: #fff0e6;
    }

    .quoted-price > table > thead > tr {
        border-bottom: 2px solid #fff0e6;
    }

     label {
        font-weight: initial;
    }

    .required label::before {
        content: "*";
        color: #ff414d;
    }
    .qty-error-msg{
        font-size: 12px;
        color: #ff414d;
    }
    .qty-error-icon{
        position: absolute;
        right: 15px;
        bottom: 0;
        line-height: 40px;
        color: #ff414d;
    }
    .show-progress{
        list-style: none;
        /*font-size: 12px;*/
        margin: 10px;
        padding: 0;
    }
    .show-progress > li{
        display: flex;
        align-items: center;
    }
    .show-progress > li > span{
        margin-left: 5px;
    }
    .show-progress .circle{
        display: inline-block;
        min-width: 10px;
        height: 10px;
        border: 1px solid #183464;
        border-radius: 50%;
    }
    .show-progress .timeline{
        height: 13px;
        border-left: 1px solid #ccc;
        margin-left: 5px;
    }
    .btn.btn-primary{
        height: 40px;
    }
</style>
{#{% if customer_id %}#}
    {#<button class="btn btn-primary btn-lg btn-block" data-toggle="modal" data-target="#myModal-quote-product">{{ text_quote_btn_caps }}</button>#}

    <div class="modal fade" id="myModal-quote-product" style="text-indent: 0" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                                aria-hidden="true">&times;</span><span class="sr-only">{{ text_close }} </span></button>
                    <h3 class="modal-title">{{ text_add_quote }} </h3>
                </div>
{#                <form id="quote-product-form">#}
                    <div class="modal-body" style="padding: 5px 15px">
                        <div>
                            <div class="contract-offer">
                                <i class="giga icon-zhangdan" style="margin-right: -20px;font-size:30px "></i>
                                <span>当前合约报价：</span>
                            </div>
                            <div class="quoted-price">
                                <table class="table">
                                    <thead>
                                    <tr>
                                        <td>数量范围</td>
                                        <td>价格</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>5~10 PCS</td>
                                        <td>$92.00</td>
                                    </tr>
                                    <tr>
                                        <td>11~14 PCS</td>
                                        <td>$88.00</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div>
                            <div class="col-sm-6 required" style="padding-left: 0">
                                <label class="control-label" for="input-quantity">{{ text_quanity }} </label>
                                <input type="text" name="quote_quantity" maxlength="10" onkeyup="checkInputInt(this)"
                                       onkeydown="checkInputInt(this)" id="input-quantity" class="form-control"/>
                                <span class="qty-error-icon">
                                    <i class="giga icon-gantanhaojinggao" style="font-size: 14px"></i>
                                </span>
                            </div>
                            <div class="col-sm-6 required" style="padding-right: 0">
                                <label class="control-label" for="input-price">
                                    {{ text_price }}
                                    <i class="giga icon-V10-wenhaotishi" data-toggle="tooltip" data-original-title="Excluding fulfillment"></i>
                                    {#                {% if is_drop_ship_buyer %}#}
                                    {#                  <span style="color:#fa6400 ">(excluding fulfillment)</span>#}
                                    {#                {% endif %}#}
                                </label>
                                <input type="text" name="quote_price" maxlength="10" onkeyup="checkInputMoney(this)"
                                       onkeydown="checkInputMoney(this)" id="input-price" class="form-control"/>
                            </div>
                            <div class="qty-error-msg">
                                不可超过该商品可用库存
                            </div>
                        </div>
                        <div class="form-group ">
                            <label class="control-label" for="input-message">Comments</label>
                            <textarea class="form-control" maxlength="500" name="quote_message" rows="3"
                                      id="input-message"></textarea>
                        </div>
                        <div class="footer text-center">
                            <button type="button" class="btn btn-primary btn-submit"
                                    id="btnBid">Bid</button>
                        </div>
                    </div>
{#                </form>#}
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
<div class="modal fade" id="attentionModal" tabindex="-1" role="dialog"  aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">{{ text_close }} </span></button>
                <h3 class="modal-title">Attention</h3>
            </div>
            <div class="modal-body" style="">
                <div>
                    <div style="font-size: 16px;margin-left: 10px;">提交成功</div>
                    <div>
                        <ul class="show-progress">
                            <li>
                                <i class="giga icon-duigou" style="color: #FA6400;margin-left: -3px"></i>
                                <span>Step1 Buyer发起BID</span>
                            </li>
                            <li class="timeline"></li>
                            <li>
                                <i class="circle"></i>
                                <span>Step2 Seller处理，双方签订协议</span>
                            </li>
                            <li class="timeline"></li>
                            <li>
                                <i class="circle"></i>
                                <span>Step3 Buyer可在My Agreement选择协议购买商品</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="footer text-center">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>
</div>
    <script>
        $("#btnBid").on('click',function () {
            $("#myModal-quote-product").modal("hide");
            $("#attentionModal").modal("show");
        })
        {#let is_japan = '{{ is_japan }}';#}
        {#// 校验数量#}
        {#function checkInputInt(obj) {#}
        {#    if (obj.value.length == 1) {#}
        {#        obj.value = obj.value.replace(/[^1-9]/g, '')#}
        {#    } else {#}
        {#        obj.value = obj.value.replace(/\D/g, '')#}
        {#    }#}
        {#}#}
        {#// 校验价格#}
        {#function checkInputMoney(_this) {#}
        {#    if (!is_japan) {#}
        {#        if (!/^\d+\.?\d{0,2}$/.test(_this.value)) {#}
        {#            _this.value = _this.value.substring(0, _this.value.length - 1);#}
        {#        }#}
        {#    } else {#}
        {#        if (_this.value.length == 1) {#}
        {#            _this.value = _this.value.replace(/[^1-9]/g, '')#}
        {#        } else {#}
        {#            _this.value = _this.value.replace(/\D/g, '')#}
        {#        }#}
        {#    }#}
        {#}#}
        {#//点击提交#}
        {#$('#send-mail').on('click', function () {#}
        {#    f = 0;#}
        {#    $('#myModal-quote-product input,#myModal-quote-product textarea').each(function () {#}
        {#        if ($(this).val() == '') {#}
        {#            $(this).parent().addClass('has-error');#}
        {#            f++;#}
        {#        } else {#}
        {#            $(this).parent().removeClass('has-error');#}
        {#        }#}
        {#    });#}

        {#    if (f > 0) {#}
        {#        $('#myModal-quote-product .error').text('{{ text_error_mail }}').slideDown('slow').delay(2000).slideUp('slow');#}
        {#    } else {#}
        {#        if ($("#send-mail").hasClass('disabled')) {#}
        {#            return true;#}
        {#        }#}
        {#        $('#send-mail').addClass('disabled');#}
        {#        $('#myModal-quote-product').addClass('mail-procss');#}

        {#        $.ajax({#}
        {#            url: '{{ action }}',#}
        {#            data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea, #quote-product-form textarea, #quote-product-form input'),#}
        {#            type: 'post',#}
        {#            dataType: 'json',#}
        {#            success: function (json) {#}
        {#                $('.alert, .text-danger').remove();#}
        {#                $('.form-group').removeClass('has-error');#}

        {#                if (json['error']) {#}
        {#                    if (json['error']['option']) {#}
        {#                        for (i in json['error']['option']) {#}
        {#                            var element = $('#input-option' + i.replace('_', '-'));#}

        {#                            if (element.parent().hasClass('input-group')) {#}
        {#                                element.parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');#}
        {#                            } else {#}
        {#                                element.after('<div class="text-danger">' + json['error']['option'][i] + '</div>');#}
        {#                            }#}
        {#                        }#}
        {#                    }#}

        {#                    if (json['error']['quantity']) {#}
        {#                        $('#quote-product-form input[name=\'quote_quantity\']').after('<div class="text-danger">' + json['error']['quantity'] + '</div>');#}
        {#                    }#}

        {#                    if (json['error']['recurring']) {#}
        {#                        $('select[name=\'recurring_id\']').after('<div class="text-danger">' + json['error']['recurring'] + '</div>');#}
        {#                    }#}

        {#                    let error_message = '{{ text_error_option }}';#}
        {#                    if (json['error']['message']) {#}
        {#                        error_message = json['error']['message'];#}
        {#                    }#}
        {#                    // Highlight any found errors#}
        {#                    $('.text-danger').parent().addClass('has-error');#}

        {#                    $('#myModal-quote-product .modal-body').prepend('<div class="alert alert-danger"><i class="fa fa-check-circle"></i>' + error_message + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');#}

        {#                }#}

        {#                if (json['success']) {#}
        {#                    $('#myModal-quote-product .modal-body').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i>{{ text_success_mail }} <button type="button" class="close" data-dismiss="alert">&times;</button></div>');#}
        {#                    $('#myModal-quote-product input,#myModal-quote-product textarea').each(function () {#}
        {#                        $(this).val('');#}
        {#                        $(this).text('');#}
        {#                    });#}
        {#                }#}

        {#            },#}
        {#            complete: function () {#}
        {#                $('#send-mail').removeClass('disabled');#}
        {#            }#}
        {#        });#}
        {#    }#}
        {#});#}
    </script>
{#{% else %}#}
{#    <a class="btn btn-primary btn-lg btn-block" href="{{ login }}" data-toggle="tooltip"#}
{#       title="{{ text_tooltip }}">{{ text_add_quote }} </a>#}
{#{% endif %}#}
<br/>

{{ this.title('Claim Application') }}
{{ this.params('breadcrumbs', [
'home',
{
text: 'Buyer Protection Management',
href: url('account/safeguard/bill'),
},
'current'
]) }}
{{ cssOrigin(['/catalog/view/javascript/bootstrap-select18/bootstrap-select.min.css']) }}
{{ jsOrigin(['catalog/view/javascript/bootstrap-select18/bootstrap-select.min.js']) }}
{% include 'yzcTheme/template/account/safeguard/claim/components/claim_top.twig' %}
{% include 'yzcTheme/template/account/safeguard/claim/components/claim_detail.twig' %}
{% apply script %}
<script type="text/javascript">
$().ready(function() {
  claimDetailPage.init();
  claimDetailPage.countDown();
  claimDetailPage.formatCountdown($('.action-seconds'));
});
var claimDetailPage = {
  claimDetail: {{ claim_detail|json_encode() }},
  claimProds: [], // 申请理赔的产品数据
  init: function() {
    $('select[name=trackingInfos]').each((k, tracking) => {
      var value = $(tracking).attr('data-value') || '';
      $(tracking).selectpicker('val', value.split(','));
    });
    $('#countProds').html($('#selectedProds tbody tr').length);
    // 如果是资料待完善，页面滚动到最下方
    if (claimDetailPage.claimDetail && claimDetailPage.claimDetail.status == 11) {
      $('html,body').animate({scrollTop:$('#claimRecords').offset().top}, 500);
    }
  },
  formatCountdown: function($seconds) {
    $seconds.each((index, item) => {
      var times = +$(item).data('seconds');
      var hour = Math.floor((times % 86400) / 3600),
          minutes = Math.floor((times % 3600) / 60),
          // seconds = Math.floor(times % 60),
          msg = (hour<10?`0${hour}`:hour) + ":" + (minutes<10?`0${minutes}`:minutes);
      $(item).text(msg);
      $(item).data('seconds', times - 1);
      if (!times || (times < 0)) {
        // 终止倒计时
        $(item).removeClass('action-seconds');
        $(item).text('');
        window.location.reload();
      }
    })
  },
  // 倒计时提醒一分钟倒计时
  countDown: function() {
    var $seconds = $('.action-seconds');
    if ($seconds.length === 0) {
      return;
    }
    // 展示时分
    setTimeout(function() {
      claimDetailPage.formatCountdown($seconds);
      claimDetailPage.countDown();
    }, 1000)
  },
}
</script>
{% endapply %}
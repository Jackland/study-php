<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js" type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment-with-locales.min.js" type="text/javascript"></script>
<script src="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
<link href="catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css" rel="stylesheet" media="screen" />
<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<style type="text/css">
    .control-label {
        font-weight: bold
    }
    #form-order > div > table {
        font-size: 12px
    }
    .pagination a {
        cursor: pointer;
    }
</style>
<div id="content">
    <div class="well">
        {% if isInnerAccount %}
            {#内部Seller看到的筛选条件#}
            <div class="row">
                <div class="col-sm-4">
                    {#入库单号#}
                    <div class="form-group">
                        <label class="control-label" for="input-inboundOrderNumber">{{ text_receiving_order_number }}</label>
                        <input type="text" name="filter_inboundOrderNumber" value="{{ filter_inboundOrderNumber }}" placeholder="{{ text_receiving_order_number }}" id="input-inboundOrderNumber" class="form-control" />
                    </div>
                </div>
                <div class="col-sm-8">
                    {#预计入库日期#}
                    <div class="form-group">
                        <label class="control-label">
                            {{ text_estimated_date_of_arrival }}
                        </label>
                        <div class="input-group datetime">
                            <span class="input-group-addon ">
                                <i class="fa fa-calendar"></i>
                            </span>
                            <input type="text" class="form-control datetimefrom" placeholder="from" name="filter_estimatedDateStart" value="{{ filter_estimatedDateStart }}" />
                            <span class="input-group-addon ">
                                <i class="fa fa-calendar"></i>
                            </span>
                            <input type="text" class="form-control datetimeto" placeholder="to" name="filter_estimatedDateEnd" value="{{ filter_estimatedDateEnd }}" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    {#集装箱号#}
                    <div class="form-group">
                        <label class="control-label" for="input-containerNumber">{{ text_container_number }}</label>
                        <input type="text" name="filter_containerNumber" value="{{ filter_containerNumber }}" placeholder="{{ text_container_number }}" id="input-containerNumber" class="form-control" />
                    </div>
                </div>
                <div class="col-sm-8">
                    {#收货日期#}
                    <div class="form-group">
                        <label class="control-label">
                            {{ text_receipt_date }}
                        </label>
                        <div class="input-group datetime">
                            <span class="input-group-addon ">
                                <i class="fa fa-calendar"></i>
                            </span>
                            <input type="text" class="form-control datetimefrom" placeholder="from" name="filter_receiptDateStart" value="{{ filter_receiptDateStart }}" />
                            <span class="input-group-addon ">
                                <i class="fa fa-calendar"></i>
                            </span>
                            <input type="text" class="form-control datetimeto" placeholder="to" name="filter_receiptDateEnd" value="{{ filter_receiptDateEnd }}" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-sm-4">
                    {#入库单状态#}
                    <div class="form-group">
                        <label class="control-label" for="input-inboundOrderStatus">Status</label>
                        <select name="filter_inboundOrderStatus" id="input-inboundOrderStatus" class="form-control">
                            <option value="">{{ __('请选择', {}, 'common') }}</option>
                            <option value="1" >{{ text_status_application }}</option>
                            <option value="2" >{{ text_status_inspection }}</option>
                            <option value="6" >{{ text_status_confirm }}</option>
                            <option value="7" >{{ text_status_receipt }}</option>
                            <option value="9" >{{ text_status_cancel }}</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <label class="control-label" for="select-shippingWay">{{ text_shipping_way }}</label>
                        <select name="filter_shippingWay" id="filter_shippingWay" class="form-control">
                            <option value="">{{ __('请选择', {}, 'common') }}</option>
                            {#头程运输方式#}
                            {#顾客 2#}
                            <option value="2" {% if filter_shippingWay == 2 %}selected{% endif %} >{{ text_shipping_way_myself }}</option>
                            {#云仓 1#}
                            <option value="1" {% if filter_shippingWay == 1 %}selected{% endif %} >{{ text_shipping_way_gigacloud }}</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <button style="margin-top: 25px" type="button" onclick="filter(this);" class="btn btn-primary pull-right">{{ button_filter}}</button>
                    </div>
                </div>
            </div>
        {% else %}
            {#非内部Seller看到的筛选条件#}
            <div class="row">
                <div class="col-sm-4">
                    {#入库单号#}
                    <div class="form-group">
                        <label class="control-label" for="input-inboundOrderNumber">{{ text_receiving_order_number }}</label>
                        <input type="text" name="filter_inboundOrderNumber" value="{{ filter_inboundOrderNumber }}" placeholder="{{ text_receiving_order_number }}" id="input-inboundOrderNumber" class="form-control" />
                    </div>
                </div>
                <div class="col-sm-8">
                    {#收货日期#}
                    <div class="form-group">
                        <label class="control-label">
                            {{ text_receipt_date }}
                        </label>
                        <div class="input-group datetime">
                            <span class="input-group-addon ">
                                <i class="fa fa-calendar"></i>
                            </span>
                            <input type="text" class="form-control datetimefrom" placeholder="from" name="filter_receiptDateStart" value="{{ filter_receiptDateStart }}" />
                            <span class="input-group-addon ">
                                <i class="fa fa-calendar"></i>
                            </span>
                            <input type="text" class="form-control datetimeto" placeholder="to" name="filter_receiptDateEnd" value="{{ filter_receiptDateEnd }}" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    {#集装箱号#}
                    <div class="form-group">
                        <label class="control-label" for="input-containerNumber">{{ text_container_number }}</label>
                        <input type="text" name="filter_containerNumber" value="{{ filter_containerNumber }}" placeholder="{{ text_container_number }}" id="input-containerNumber" class="form-control" />
                    </div>
                </div>
                <div class="col-sm-4">
                    {#入库单状态#}
                    <div class="form-group">
                        <label class="control-label" for="input-inboundOrderStatus">Status</label>
                        <select name="filter_inboundOrderStatus" id="input-inboundOrderStatus" class="form-control">
                            <option value="">{{ __('请选择', {}, 'common') }}</option>
                            <option value="1" >{{ text_status_application }}</option>
                            <option value="2" >{{ text_status_inspection }}</option>
                            <option value="6" >{{ text_status_confirm }}</option>
                            <option value="7" >{{ text_status_receipt }}</option>
                            <option value="9" >{{ text_status_cancel }}</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="form-group">
                        <label class="control-label" for="select-shippingWay">{{ text_shipping_way }}</label>
                        <select name="filter_shippingWay" id="filter_shippingWay" class="form-control">
                            <option value="">{{ __('请选择', {}, 'common') }}</option>
                            {#头程运输方式#}
                            {#顾客 2#}
                            <option value="2" {% if filter_shippingWay == 2 %}selected{% endif %} >{{ text_shipping_way_myself }}</option>
                            {#云仓 1#}
                            <option value="1" {% if filter_shippingWay == 1 %}selected{% endif %} >{{ text_shipping_way_gigacloud }}</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">
                        <button style="margin-top: 25px" type="button" onclick="filter(this);" class="btn btn-primary pull-right">{{ button_filter}}</button>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    <div class="table-responsive">
        <div class="table-responsive">
            <table class="table table-hover">
                {% if inboundOrders %}
                <thead>
                <tr>
                    {#入库单号#}
                    <td style="white-space: nowrap;">{{ column_receiving_order_number }}</td>
                    {#头程运输方式#}
                    <td style="white-space: nowrap;">{{ column_shipping_way }}</td>
                    {#申请日期#}
                    <td style="white-space: nowrap;">{{ column_date_of_application }}</td>
                    {#预计入库日期#}
                    {% if isInnerAccount %}
                        <td style="white-space: nowrap;">{{ column_estimated_date_of_arrival }}</td>
                    {% endif %}
                    {#收货日期#}
                    <td style="white-space: nowrap;">{{ column_receipt_date }}</td>
                    {#集装箱号#}
                    <td style="white-space: nowrap;">{{ column_container_number }}</td>
                    {#备注#}
                    <td>{{ column_remark }}</td>
                    {#状态#}
                    <td style="white-space: nowrap;">{{ column_status }}</td>
                    {#操作#}
                    <td>{{ column_action }}</td>
                </tr>
                </thead>
                <tbody>
                {% for item in inboundOrders %}
                    <tr>
                        <td>{{ item.receive_number }}</td>
                        <td>{{ item.shipping_way }}</td>
                        <td>{{ item.apply_date ? item.apply_date|date("Y-m-d") : '-' }}</td>
                        {% if isInnerAccount %}
                            <td>{{ item.expected_date ? item.expected_date|date("Y-m-d") : '-' }}</td>
                        {% endif %}
                        <td style="white-space: nowrap;">
                          {{  item.receive_date ? item.receive_date|date("Y-m-d") : '-' }}
                        </td>
                        <td>{{ item.container_code }}</td>
                        <td>{{ item.remark }}</td>
                        <td>{{ item.status }}</td>
                        <td><button class="btn btn-default" type="button" onclick="showDetail({{ item.receive_order_id }})">
                                <i class="fa fa-eye"></i></button>
                        </td>
                    </tr>
                {% endfor %}
                {% else %}
                    <tr>
                        {% if isInnerAccount %}
                            <td class="text-center" colspan="9">{{ text_no_results}}</td>
                        {% else %}
                            <td class="text-center" colspan="8">{{ text_no_results}}</td>
                        {% endif %}
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row" style="margin-top: 5px">
        <div class="col-sm-12 text-right">
            <ul id="bos_pagination"></ul></div>
    </div>
</div>
<!--模态对话框-->
<div class="modal fade" tabindex="-1" role="dialog" id="myModalDetail">
    <div class="modal-dialog" role="document" style="width: auto;">
        <div class="modal-content">

        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        block.unBlockUI();
        init();
        {% if show_detail and filter_inboundOrderNumber and show_detail_id %}
        showDetail({{ show_detail_id }})
        {% endif %}
    });

    function showDetail(id) {
        var myModalSelector = $("#myModalDetail");
        // 请求后台获取详细信息
        myModalSelector.modal({
            remote: "index.php?route=account/inbound_management/detailShow&id=" + id,
            backdrop: 'static',
            keyboard: false
        });
        // 每次隐藏时，清除数据。确保点击时，重新加载
        myModalSelector.on("hidden.bs.modal", function () {
            $(this).removeData("bs.modal");
            $(".modal-content").html("");
        });
    }

    $('.datetimefrom').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD'
    });
    $('.datetimeto').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD'
    });

    function init() {
        let filter_inboundOrderStatus = '{{ filter_inboundOrderStatus }}';
        if (filter_inboundOrderStatus) {
            $('#input-inboundOrderStatus').val(filter_inboundOrderStatus);
        }
        let filter_shippingWay = '{{ filter_shippingWay }}';
        if (filter_shippingWay) {
            $('#input-shippingWay').val(filter_shippingWay);
        }
        //分页链接
        pagination();
    }

    function pagination(){
        if({{ total_pages }}){
            $('#bos_pagination').bootstrapPaginator({
                /*当前使用的是3版本的bootstrap*/
                bootstrapMajorVersion: 3,
                /*配置的字体大小是小号*/
                size: 'normal',
                /*当前页*/
                currentPage: {{ page_num }},
                /*一共多少页*/
                totalPages: {{ total_pages }},
                /*页面上最多显示几个含数字的分页按钮*/
                numberOfPages: 5,
                total: {{ total_num }},
                rowsOfPage: {{ page_limit }},
                onPageClicked: function(event, originalEvent, type, page) {
                    block.blockUI();
                    let url = getUrl(page);
                    let page_info = originalEvent['page_info'] || {};
                    for (let i in page_info){
                      url += '&' + i + '=' + page_info[i];
                    }
                    $('#inbound_management').load(url);
                }
            });
        }
    }

    function getUrl(page) {
        let url = 'index.php?route=account/inbound_management/queryList';
        // 入库单号
        let filter_inboundOrderNumber = $('input[name=\'filter_inboundOrderNumber\']').val();
        if (filter_inboundOrderNumber) {
            url += '&filter_inboundOrderNumber=' + encodeURIComponent(filter_inboundOrderNumber);
        }
        // 预计入库时间
        let filter_estimatedDateStart = $('input[name=\'filter_estimatedDateStart\']').val();
        if (filter_estimatedDateStart) {
            url += '&filter_estimatedDateStart=' + encodeURIComponent(filter_estimatedDateStart);
        }
        let filter_estimatedDateEnd = $('input[name=\'filter_estimatedDateEnd\']').val();
        if (filter_estimatedDateEnd) {
            url += '&filter_estimatedDateEnd=' + encodeURIComponent(filter_estimatedDateEnd);
        }
        // 入库单状态
        let filter_inboundOrderStatus = $('select[name=\'filter_inboundOrderStatus\']').val();
        if (filter_inboundOrderStatus) {
            url += '&filter_inboundOrderStatus=' + encodeURIComponent(filter_inboundOrderStatus);
        }
        // 收货日期
        let filter_receiptDateStart = $('input[name=\'filter_receiptDateStart\']').val();
        if (filter_receiptDateStart) {
            url += '&filter_receiptDateStart=' + encodeURIComponent(filter_receiptDateStart);
        }
        let filter_receiptDateEnd = $('input[name=\'filter_receiptDateEnd\']').val();
        if (filter_receiptDateEnd) {
            url += '&filter_receiptDateEnd=' + encodeURIComponent(filter_receiptDateEnd);
        }
        // 集装箱号
        let filter_containerNumber = $('input[name=\'filter_containerNumber\']').val();
        if (filter_containerNumber) {
            url += '&filter_containerNumber=' + encodeURIComponent(filter_containerNumber);
        }
        // 头程运输方式
        let filter_shippingWay = $('select[name=\'filter_shippingWay\']').val();
        if (filter_shippingWay) {
            url += '&filter_shippingWay=' + encodeURIComponent(filter_shippingWay);
        }
        if (page) {
            url += "&page_num=" + page;
        } else {
            url += "&page_num=" + {{ page_num }};
        }
        return url;
    }

    function filter(button) {
        var url = getUrl(1);
        $('#inbound_management').load(url);
        $(button).button('loading');
    }
</script>
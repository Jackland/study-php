{{ header }}
{{ assetBundle('Seller\\VatAsset') }}
{{ separate_column_left }}
{% for style in styles %}
  <link href="{{ style }}" type="text/css" rel="stylesheet"/>
{% endfor %}
<link href="catalog/view/theme/yzcTheme/stylesheet/rma/rma.css?v={{ app_version }}" rel="stylesheet">
{% for script in scripts %}
  <script type="text/javascript" src="{{ script }}"></script>
{% endfor %}
<style>
  .charge-bake {
    color: red;
  }

  .total-price {
    color: red;
    font-weight: bold;
  }
  .my-discount {
    font-style: italic;
  }
  .my-discount .percent-dis {
    color: #FF6600;
    font-weight: bold;
  }
</style>
<div class="container-fluid" id="content" style="margin-left: 235px">
  <a href="javascript:void(0)" id="redirect_a" target="_blank" style="display: none"></a>
    <ul class="breadcrumb">
      {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
      {% endfor %}
    </ul>
    {% if success %}
      <div class="alert alert-success"><i class="fa fa-exclamation-circle"></i> {{ success }}</div>
    {% endif %}
    <div class="row" id="main-content">
      {{ column_left }}
      {% if column_left and column_right %}
        {% set class = 'col-sm-6' %}
      {% elseif column_left or column_right %}
        {% set class = 'col-sm-9' %}
      {% else %}
        {% set class = 'col-sm-12' %}
      {% endif %}

      <div id="content" class="{{ class }}">
        {{ content_top }}
        <h1>
          {{ heading_title_order_details }}
          <div class="pull-right">
            <a href="{{ continue }}" data-toggle="tooltip" title="{{ text_back }}" class="btn btn-default"><i
                class="fa fa-reply"></i></a>
          </div>
        </h1>

        {#Order Details#}
        <div class="well" id="box-shadow">
          <div class="row" style="margin-top: 20px;padding: 20px 0">
            <p class="head"> {{ heading_title_order_details }}</p>
            <div class="pane col-sm-3">
              <p class="icon giga icon-summary-po-id"></p>
              <p class="title">{{ text_head_order_id }}</p>
              <p>
                {{ order_id }}
                {% if (delivery_type == 2) %}
                  <i class="giga icon-cwf" style="color: #1f5268;font-size: 15px" data-toggle="tooltip" data-original-title="{{ cwf }}"></i>
                {% endif %}
              </p>
            </div>
            <div class="pane col-sm-3">
              <p class="icon giga icon-date-icon"></p>
              <p class="title">{{ text_head_order_date }}  </p>
              <p>{{ date_added }}</p>
            </div>
            <div class="pane col-sm-3">
              <p class="icon giga icon-summary-store"></p>
              <p class="title">{{ text_head_nickname }}</p>
              <p>
                <span class="user_portrait" data-user_customer_id="{{ buyer_id }}">
                  {{ nickname }}
                </span>
                <span>
                  <img data-toggle="tooltip" style="padding-left: 1px"
                       src="{{ is_home_pickup ? asset('image/icons/HomePickup/home_pickup-15x15.png') : asset('image/icons/HomePickup/drop_shipping-15x15.png') }}"
                       data-original-title="{{ is_home_pickup?tip_home_pickup_logo:tip_drop_shipping_logo }}">
                </span>
                {{ ex_vat }}
              </p>
            </div>
            <div class="pane col-sm-3" style="border: none">
              <p class="icon giga icon-summary-status"></p>
              <p class="title">{{ text_head_order_status }}</p>
              <p>{{ order_status_name }}</p>
            </div>
          </div>
          {% if not errorPage and isMember %}
            <div class="" style="margin-top: 20px;padding: 20px 0">
              <table class="table  table-hover">
                {% set colspan = 7 %}
                <thead style="">
                <tr class="text-center">
                  <th>{{ column_image }}</th>
                  <th>{{ column_sku }}</th>
                  <th>{{ column_mpn }}</th>
                  <th>{{ column_qty_details }}</th>
                  <th style="min-width: 90px">{{ column_price_after_discount }}</th>
                  {% if isEurope %}
                    <th>{{ column_service_fee_after_discount }}</th>
                    {% set colspan = colspan + 1 %}
                  {% endif %}
                  {% if hasMarketplaceFee %}
                    <th>{{ column_marketplace_fee_per }}
                      <i class="giga icon-V10-wenhaotishi" data-toggle="tooltip" style="cursor: pointer;"
                         title="{{ tip_marketplace_fee }}"></i>
                    </th>
                    {% set colspan = colspan + 1 %}
                  {% endif %}
                  <th>{{ column_freight_pre_unit }}</th>
                  <th>{{ column_total }}</th>
                  <th>{{ column_status }}</th>
                  <th>{{ column_rma_id ?:'RMA ID' }}</th>
                </tr>
                </thead>
                <tbody>
                {% for product in products %}
                  <tr class="text-left">
                    <td><img src="{{ product['image'] }}"></td>
                    {% if product.tag %}
                      <td style="min-width: 120px">
                        {% if product.type_id == 3%}
                          {{ global_backend_futures_sign | dprintf({'id':product.agreement_id,'s_id':product.agreement_no }) }}
                        {% endif %}
                        {# 保证金 #}
                        {% if product.product_id in margin_product_ids %}
                          {{ global_margin_sign | dprintf({'class':'flag-hover','id':margin_product_id_agree[product['product_id']]}) }}
                        {% endif %}
                        {% if product.is_rebate %}
                          {{ global_backend_rebate_sign | dprintf({'id':product.agreement_id,'s_id':product.rebateAgreementCode }) }}
                        {% endif %}
                        {% if product.margin_sku %}
                          <a href="{{ product['margin_link'] }}">{{ product['margin_sku'] }}</a>
                        {% else %}
                          {{ product['sku'] }}
                        {% endif %}
                        {% for tagDetail in product.tag %}
                          {{ tagDetail }}
                        {% endfor %}
                        <a href="{{ product_info_url~product['product_id'] }}"><i class="giga icon-table-link" style="color: #ccc"></i></a>
                      </td>
                    {% else %}
                      {% if product.margin_sku %}
                        <td>
                          {% if product.type_id == 3%}
                            {{ global_backend_futures_sign | dprintf({'id':product.agreement_id,'s_id':product.agreement_no }) }}
                          {% endif %}
                          {# 保证金 #}
                          {% if product.product_id in margin_product_ids %}
                            {{ global_margin_sign | dprintf({'class':'flag-hover','id':margin_product_id_agree[product['product_id']]}) }}
                          {% endif %}
                          {% if product.is_rebate %}
                            {{ global_backend_rebate_sign | dprintf({'id':product.agreement_id,'s_id':product.rebateAgreementCode }) }}
                          {% endif %}
                          {{ product['margin_sku'] }} <a href="{{ product_info_url~product['product_id'] }}"><i class="giga icon-table-link" style="color: #ccc"></i></a>
                        </td>
                      {% else %}
                        <td>
                          {% if product.type_id == 3%}
                            {{ global_backend_futures_sign | dprintf({'id':product.agreement_id,'s_id':product.agreement_no }) }}
                          {% endif %}
                          {# 保证金 #}
                          {% if product.product_id in margin_product_ids %}
                            {{ global_margin_sign | dprintf({'class':'flag-hover','id':margin_product_id_agree[product['product_id']]}) }}
                          {% endif %}
                          {% if product.is_rebate %}
                            {{ global_backend_rebate_sign | dprintf({'id':product.agreement_id,'s_id':product.rebateAgreementCode }) }}
                          {% endif %}
                          {{ product['sku'] }} <a href="{{ product_info_url~product['product_id'] }}"><i
                              class="giga icon-table-link" style="color: #ccc"></i></a></td>
                      {% endif %}
                    {% endif %}
                    {% if product.margin_mpn %}
                      <td>{{ product['margin_mpn'] }}</td>
                    {% else %}
                      <td>{{ product['mpn'] }}</td>
                    {% endif %}
                    <td>{{ product['quantity'] }}</td>
                    <td>
                      {{ product['price'] }} <br/>
                      {% if product['amount_price_per_number'] != '0' %}
                        (Discount <span style="color: red">{{ product['amount_price_per'] }}</span>)
                      {% endif %}
                      {# #29414 限时限量活动#}
                      {% if product['discountShow'] != '' %}
                        <span class="my-discount">Discount:<span class="percent-dis"> {{ product['discountShow'] }}% </span>OFF</span>
                      {% endif %}
                    </td>
                    {% if isEurope %}
                      <td>{{ product['service_fee_per'] }}<br/>
                        {% if product['amount_service_fee_per_number'] != '0' %}
                          (Discount <span style="color: red">{{ product['amount_service_fee_per'] }}</span>)
                        {% endif %}
                        {# #29414 限时限量活动#}
                        {% if product['discountShow'] != '' %}
                          <span class="my-discount">Discount:<span class="percent-dis"> {{ product['discountShow'] }}% </span>OFF</span>
                        {% endif %}
                      </td>

                    {% endif %}

                    {% if hasMarketplaceFee %}
                      <td>{{ product['marketplace_fee_per'] }}</td>
                    {% endif %}
                    <td>{{ product['freight_per'] }}
                      {% if delivery_type==2 and product.freight_difference_per_number!=0 %}
                        <i class="glyphicon glyphicon-info-sign" data-toggle="tooltip" style="cursor: pointer;font-size: 12px" title="{{ product.tips_freight_difference_per }}"></i>
                      {% endif %}
                    </td>


                    <td>{{ product['total'] }}</td>
                    {% for key, order_status in order_statuses %}
                      {% if product['order_product_status'] in order_status %}
                        <td
                          class="{{ product['order_product_status']==13?'charge-bake':'' }}">{{ order_status['name'] }}</td>
                      {% endif %}
                    {% endfor %}
                    <td>
                      {% if product['rma_ids'] %}
                        {% for rma in product['rma_ids'] %}
                          <a href="{{ rma_url }}{{ rma.rma_id }}">{{ rma.rma_order_id }}</a><br>
                        {% endfor %}
                      {% endif %}
                    </td>
                  </tr>
                  {% for voucher in vouchers %}
                    <tr>
                      <td class="text-left">{{ voucher['description'] }}</td>
                      <td class="text-left"></td>
                      <td class="text-right">1</td>
                      <td class="text-right">{{ voucher['amount'] }}</td>
                      <td class="text-right">{{ voucher['amount'] }}</td>
                    </tr>
                  {% endfor %}
                {% endfor %}
                </tbody>
                <tfoot style="">
                {% for total in totals %}
                  <tr>
                    <td class="text-right" colspan="{{ colspan }}">{{ total.title }}</td>
                    <td class="text-right {{ total.title == 'Total Price'?' total-price':'' }}"
                        colspan="2">{{ total.text }}</td>
                  </tr>
                {% endfor %}
                <tr>
                  <td class="text-right" colspan="{{ colspan }}"><strong>Final Total:</strong></td>
                  <td class="text-right Total Price relative {% if have_coupon_discount is defined  and have_coupon_discount == 1%} hover-block{% endif %}" colspan="2">
                    {{ final_total_show }}
                    {% if have_coupon_discount is defined  and have_coupon_discount == 1%}
                      <i class="giga icon-V10_shouyeyouxiadown text-small text-normal-color"></i>
                      <div class="payment-list text-small text-normal-color">
                        <span class="price-text">{{ buyer_paid_show }}</span> (Buyer paid)
                        <span class="price-text">+{{ all_coupon_amount_show }}</span> (GIGA Coupon)
                      </div>
                    {% endif %}
                  </td>
                </tr>
                </tfoot>
              </table>
            </div>
          {% endif %}

          {#Order History#}
          {% if histories %}
            {#            {% if true %}#}
            <div class="row" style="margin-top: 20px;padding: 20px 0">
              <p class="head">{{ heading_title_order_info }}</p>
            </div>
            <table class="table table-hover" id="history">
              <thead>
              <tr>
                <th class="text-left">{{ column_date_added }}</th>
                <th class="text-left">{{ column_status }}</th>
                <th class="text-left">{{ column_comment }}</th>
              </tr>
              </thead>
              <tbody>
              {% for history in histories %}
                <tr>
                  <td class="text-left">{{ history['date_added'] }}</td>
                  <td class="text-left">{{ history['status'] }}</td>
                  <td class="text-left">{{ history['comment'] }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          {% endif %}

          {% if restOrderList %}
            <div class="row" style="margin-top: 20px;padding: 20px 0">
              <p class="head">{{ margin_detail_title }}</p>
            </div>
            <table class="table table-hover">
              <thead>
              <tr class="text-center">
                <th class="text-center">{{ column_buyer_name }}</th>
                <th class="text-center">Order ID</th>
                <th class="text-center">Order Date</th>
                <th class="text-center">{{ column_item_code }}</th>
                <th class="text-center">{{ column_mpn }}</th>
                <th class="text-center">QTY</th>
                <th class="text-center">Unit Price After Discount</th>
                <th class="text-center">Total</th>
                <th class="text-center">Fulfillment Per Unit</th>
                <th class="text-center">{{ column_rma_id }}</th>
              </tr>
              </thead>
              <tbody>
              {% for restOrder in restOrderList %}
                <tr>
                  <td>{{ restOrder.buyer_name }}</td>
                  <td><a href="{{ restOrder.rest_order_url }}"
                         style="color: blue;font-weight: bold">{{ restOrder.rest_order_id }}<i
                        class="giga icon-table-link" style="color: #ccc"></i></a>
                    {% if (restOrder.delivery_type==2) %}
                        <i class="giga icon-cwf" style="color: #1f5268;font-size: 15px;" data-toggle="tooltip" data-original-title="{{ cwf }}"></i>
                    {% endif %}

                  </td>
                  <td>{{ restOrder.purchase_date }}</td>
                  <td>{{ restOrder.sku }}</td>
                  <td>{{ restOrder.mpn }}</td>
                  <td>{{ restOrder.quantity }}</td>
                  <td>{{ restOrder.unit_price|formatPrice(currency) }}</td>
                  {% if restOrder.coupon_and_campaign > 0 and restOrder.coupon_and_campaign != '0.00' %}
                    <td>
                      {{ restOrder.total }}<br/>
                      <span style="font-size: 13px;text-decoration: line-through;color: #888">
                        {{ restOrder.origin_total|formatPrice(currency) }}
                      </span>
                    </td>
                  {% else %}
                    <td>{{ restOrder.total|formatPrice(currency) }}</td>
                  {% endif %}
                  <td>{{ restOrder.freight_per_unit|formatPrice(currency) }}</td>
                  <td>
                    {% if restOrder['rma_ids'] %}
                      {% for rma in restOrder['rma_ids'] %}
                        <a href="{{ rma_url }}{{ rma.rma_id }}">{{ rma.rma_order_id }}
                          <i class="giga icon-table-link"
                             style="color: #ccc"></i>
                        </a>
                        <br>
                      {% endfor %}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          {% endif %}
          {{ content_bottom }}
        </div>
        {{ column_right }}
    </div>
  </div>
</div>
  {{ footer }}
<style>
  table a {
    color: #333;
  }

  #box-shadow .row .head {
    font-size: 18px;
    color: #183464;
    padding-left: 15px;
  }

  #box-shadow .row .pane {
    border-right: 1px solid #ccc;
    text-align: center;
  }

  #box-shadow .row .pane .icon {
    font-size: 20px !important;
    color: #183464;
  }

  #box-shadow .row .pane .title {
    color: #ccc;
  }

  .table thead > tr > th {
    /*color: #ccc;*/
    text-align: left;
  }

  #box-shadow .table tbody > .text-center :nth-child(6),
  #box-shadow .table tbody > .text-center :nth-child(7),
  #box-shadow .table tbody > .text-center :nth-child(8) {
    color: #183464 !important;
  }

  .margin_class {
    color: #FA6400;
    font-size: 16px
  }

  .margin_class:hover {
    cursor: pointer;
  }
</style>

<script>
  function clickMargin(agreement_code) {
    let a_r = $('#redirect_a');
    let url = 'index.php?route=account/product_quotes/margin_contract/view&agreement_id=';
    if (!agreement_code) return;
    url += agreement_code;
    a_r.attr('href', url);
    a_r[0].click();
  }
</script>
{% set titleStr = 'Leave a Message' %}
{{ this.title(titleStr) }}
{{ this.params('breadcrumbs', [
    'home',
    {
        text: 'Message Center',
        href: url('account/message_center/seller'),
    },
    {
        text: titleStr,
        href: url('account/message_center/ticket'),
    }
]) }}

<link href="catalog/view/theme/yzcTheme/stylesheet/stylesheetMessage.css" type="text/css" rel="stylesheet"/>

{{ css([
  'css/common/common.css',
  'static/message/message-common.css',
  'static/message/buyer-message-common.css',
  'static/customerpartner/message_center/my-message-common.css']) 
}}

{% if separate_view is defined and separate_view %}
{{ ticketBuyer }}
<div id="content" style="margin-left: 235px">
    <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
    </ul>
    {% else %}
    <div class="container">
        {% endif %}
        {% if rma_edit_error %}
            <div class="alert alert-warning alert-dismissible"><i class="fa fa-check-circle"></i> {{ error }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}

        <div class="nav-oris">
            {# {% set class = 'col-sm-12' %} #}
            {% set table_div_class = 'overflow: hidden;' %}

            <div id="content" class="{{ class }}">{{ content_top }}
                {{ message_column }}
                <div id="table_content" class="msgcent msg-card msg-h508" style="{{ table_div_class }}">
                    <div class="nav-oris">
                        {# Tabs #}
                        <ul class="oris-tabs msgb msg-card__tab">
                            <li id="rma_li" class="oris-tab-pane oris-pane-active submit_ticket_for_count_1" value="1"
                                submit_ticket_for="1" onclick="jump2Tab(this, 1)">
                                <a data-toggle="tab">
                                    RMA Management
                                    {% if ticket_for_noread['1'].total %}
                                        <span class="msg-card__tab-notice"></span>
                                    {% endif %}
                                </a>
                            </li>
                            <li id="sales_order_li" class="oris-tab-pane submit_ticket_for_count_2" value="2"
                                submit_ticket_for="2" onclick="jump2Tab(this, 2)">
                                <a data-toggle="tab">Sales Order Management
                                    {% if ticket_for_noread['2'].total %}
                                        <span class="msg-card__tab-notice"></span>
                                    {% endif %}
                                </a>
                            </li>
                            <li id="sales_order_li" class="oris-tab-pane submit_ticket_for_count_21" value="21"
                                submit_ticket_for="21" onclick="jump2Tab(this, 21)">
                                <a data-toggle="tab">Buyer Protection Management
                                    {% if ticket_for_noread['21'].total %}
                                        <span class="msg-card__tab-notice"></span>
                                    {% endif %}
                                </a>
                            </li>
                            <li id="other_li" class="oris-tab-pane submit_ticket_for_count_3" value="3"
                                submit_ticket_for="3" onclick="jump2Tab(this, 3)">
                                <a data-toggle="tab">Others
                                    {% if ticket_for_noread['3'].total %}
                                        <span class="msg-card__tab-notice"></span>
                                    {% endif %}
                                </a>
                            </li>
                        </ul>
                        {# <div class="btn btn-submit submit-ticket-right submit-ticket-right-btn" style="margin-right: -10px;margin-top: 18px;font-size: 14px;width: auto;">Submit a Request</div> #}
                        <div>
                            <div class="tab-pane active" id="tab-content">
                            </div>
                            <content_bottom></content_bottom>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="ticket_page_is_need_reload" value="1">

    {{ footer }}
    <script>
        var txtPleaseSelect = "{{ __('请选择', {}, 'common') }}";
        $(function () {
            block.unBlockUI();
            
            // #49555 详情页转跳之后，回退到指定tab页
            // 回退时url上会带有type 参数用来高亮内容
            // tab页面转跳到详情页需要指定对应的type
            // 如果type不存在默认进入第一个tab
            let activeTab = getURLVar('type');
            let dom = `.submit_ticket_for_count_${activeTab}`;
            jump2Tab(activeTab ? $(dom) : null , parseInt(activeTab) || 1);
        });

        function jump2Tab(el, type) {
            block.blockUI();
            let url = '';
            switch(type) {
                case 1:
                    url = "{{ url('account/message_center/ticket/showListsRma', {'submit_ticket_for':1}) }}";
                    break;
                case 2:
                    url = "{{ url('account/message_center/ticket/showListsSalesOrder', {'submit_ticket_for':2}) }}";
                    break;
                case 3:
                    url = "{{ url('account/message_center/ticket/showListsOthers', {'submit_ticket_for':3}) }}";
                    break;
                case 21:
                    url = "{{ url('account/message_center/ticket/showListsOthers', {'submit_ticket_for':21}) }}"
                    break;
            }
            if(el)
                $(".oris-tab-pane").removeClass("oris-pane-active");
            $(el).addClass("oris-pane-active");
            $('#tab-content').load(url);
            block.unBlockUI();
        }

        function hideReset_() {
            $('#submit_ticket_for').val(0);
            $('#ticket_type').html(`<option value="0">--${txtPleaseSelect}--</option>`);
            $('#ticket_type').val(0);
            $("#tipInterceptSalesOrder").hide();
            $('div[group="parent-rma"]').hide();
            $('div[group="parent-sales-order"]').hide();
            $('div[group="parent-sales-item-code"]').hide();
            $('div[group="parent-tracking_number"]').hide();
            $('div[group="parent-item-code"]').hide();
            $('#ticket_group_description').hide();
            $('.ticket_group_attachments').hide();
            $(".ticket_group_attachments").find(".ticket-upload-file").html('');
            $(".ticket_group_attachments").find("textarea").val('');
            $('#myModalTicketFooter').hide();
        }

        function clearTicketInputs_(){
            $('#submit_ticket_for').val(0);
            $('#ticket_type').html(`<option value="0">--${txtPleaseSelect}--</option>`);
            $('#ticket_type').val(0);
            $("#tipInterceptSalesOrder").hide();
            $('#rma_id').val("");
            $('#sales_order_id').val("");
            $('#sales_item_code').html("");
            $('#tracking_number').val("");
            $('#seller_item_code').val("");
            $('#processing_method').val(0);
            $('#ticket_description').val("");
            $('#ticket_description_tips').html("0/1000");
            $(".ticket_group_attachments").find(".ticket-upload-file").html('');
            $(".ticket_group_attachments").find("textarea").val('');
        }
        {% if is_others %}
        $("#myModalTicket").modal({backdrop: 'static', keyboard: false});
        hideReset_();
        clearTicketInputs_();
        $('#myModalTicket').modal('show');
        setTimeout(function () {
            $('#submit_ticket_for').val(3).trigger('change')
        },500);
        setTimeout(function () {
            $('#ticket_type').val(8).trigger('change')
        },500);
        {% endif %}
</script>
{# Start-------35530-----老的平台客服页面专用悬浮框，暂时保留，后续删除, 这边css就暂放这里 #}
<style>
    /*老的平台客服页面专用悬浮框，暂时保留，后续删除*/
    .old-right-suspension {
      position: fixed;
      right: 16px;
      bottom: 300px;
      width: 48px;
      z-index: 109;
    }

    .old-suspension-btn {
      position: relative;
      width: 48px;
      color: #FFF;
      text-align: center;
      vertical-align: bottom;
      background-color: #ff944d;
      border-radius: 2px;
      flex-direction: row-reverse;
      display: flex;
      align-items: center;
      border-radius: 4px;
      margin-bottom: 4px;
    }

    .old-suspension-btn:hover {
      cursor: pointer;
      color: #fff;
      width: 168px;
      right: 120px;
      background-color: #ff7e29;
    }
    .old-suspension-btn:hover .des-text {
      display: block;
    }

    .old-suspension-btn .message-icon {
      min-width: 48px;
      width: 48px;
      height: 48px;
      padding-top: 2px;
    }

    .old-suspension-btn i {
      font-size: 32px;
      color: #fff;
    }

    .old-suspension-btn .des-text {
      text-align: center;
      width: 132px;
      height: 48px;
      line-height: 48px;
      display: none;
    }
</style>
<div class="old-right-suspension">
  <a class="onlineChatPlatformTrigger" style="display: none" data-cnzz-event="页面右侧|Ft_Online Service">
    <div>
      <div class="old-suspension-btn flex-layout">
        <div class="message-icon">
          <i class="giga icon-V10_yushangjialianxi"></i>
        </div>
        <div class="des-text">Online Service</div>
      </div>
    </div>
  </a>
</div>
{# End-------35530-----老的平台客服页面专用悬浮框，暂时保留，后续删除, 这边css就暂放这里 #}
<script src="catalog/view/javascript/jquery/datetimepicker/moment/moment.min.js" type="text/javascript"></script>
<link href="/catalog/view/javascript/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet"
      media="screen">
<link href="/catalog/view/javascript/layer/theme/yzc/layuiOris.css" rel="stylesheet"/>
<style>
  p {
    margin: 0;
  }

  .top-title {
    font-weight: bolder;
    color: #183464;
    font-size: 16px;
    margin-bottom: 15px;
  }

  a img {
    margin-top: -3px;
  }

  .main-con {
    padding: 15px;
    background: #fff;
  }

  .form-wrapper .form-group > label {
    font-size: 14px;
    text-transform: none;
    font-weight: normal;
    color: #333;
  }

  .form-wrapper select {
    border-radius: 0;
    margin: 0;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-appearance: auto !important;
    -moz-appearance: auto !important;
    background-image: none !important;
  }

  .quick-btns {
    height: 58px;
    display: flex;
    align-items: flex-end;
  }

  .quick-btn-item {
    color: #183464;
    margin-right: 20px;
  }

  .quick-btn-item:hover {
    cursor: pointer;
    text-decoration: underline;
  }

  .page-seller-portal .btn.btn-primary {
    border-color: #3A75DC;
  }

  .purchase-top {
    display: flex;
    justify-content: space-between;
  }

  .purchase-title, .purchase-status {
    font-size: 15px;
    color: #333;
    font-weight: bolder;
    display: flex;
    align-items: center;
    height: 26px;
  }

  .purchase-status {
    font-weight: normal;
  }

  .count-time {
    padding: 0 15px;
    border: 2px solid #FA6400;
    border-radius: 4px;
    margin-right: 8px;
    color: #333;
    background: #fff0e6;
  }

  .my-status {
    color: #3A75DC;
  }

  .flex-str {
    display: flex;
    justify-content: flex-start;
    align-items: center;
  }

  .picture {
    margin-right: 8px;
    transition-duration: 0.5s;
  }

  .picture .big-img {
    display: none;
  }

  .picture:hover {
    cursor: pointer;
  }

  .picture:hover .big-img {
    display: block;
  }

  .order-des {
    max-width: 300px;
    margin-bottom: 8px;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    word-break: break-word;
  }

  .order-des:hover {
    color: #3A75DC;
    text-decoration: underline;
    cursor: pointer;
  }

  .prd-tip {
    max-width: 300px;
    text-align: left;
    font-size: 12px;
    word-break: break-word;
  }

  .prd-tip span, .prd-tip a {
    font-size: 12px;
  }

  .prd-tip span, .prd-tip a {
    font-size: 12px;
  }

  .my-action-btns {
    display: flex;
    justify-content: flex-start;
  }

  .action-btn, .btn-more {
    width: 30px;
    height: 30px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #eee;
    border-radius: 4px;
    margin-right: 4px;
  }

  .action-btn:hover, .btn-more:hover {
    background: #FA6400;
    color: #fff;
  }

  .dropdown-menu li a {
    display: flex;
    justify-content: space-between;
  }

  .dropdown-menu li a i {
    margin-right: 4px;
  }

  table {
    margin-top: 10px;
  }

  thead {
    background: #eee;
  }

  i.icon-mail-unopen {
    font-size: 12px;
  }

  .store-name {
    display: block;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
    color: #3A75DC;
  }

  /*新样式修改*/
  .table-list-title {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    padding: 10px 0;
    background: #EEEEEE;
    width: 100%;
    margin-bottom: 6px;
  }

  .table-header {
    display: flex;
    padding: 10px;
    background: #ECF1FC;
    align-items: center;
  }

  .table-order-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .to-be-paid {
    color: #FA6400;
  }

  .table-body-top {
    display: flex;
  }

  .table-body-left-item, .table-body-right {
    display: flex;
    justify-content: flex-start;
  }

  .flex-align-center {
    align-items: center;
  }

  .table-body-top {
    border-bottom: 1px solid rgba(191, 212, 247, 1);
    border-top: 1px solid rgba(191, 212, 247, 1);
  }

  .table-body-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 10px;
  }

  .table-body-top .no-display {
    display: none;
  }

  .table-body-top .show-more, .table-body-top .pick-up {
    padding: 4px 10px;
    color: #888;
    font-size: 12px;
    margin-top: -1px;
    background: #fff;
    cursor: pointer;
  }

  .table-body-top .show-more i,
  .table-body-top .pick-up i {
    font-size: 12px;
    font-weight: bold;
  }

  .table-body-left {
    width: 90%;
    border-right: 1px solid rgba(191, 212, 247, 1);
  }

  .table-body-right {
    width: 10%;
  }

  .pt-35 {
    padding-top: 35px;
  }

  .table-body-left-item {
    width: 100%;
  }

  .product-information {
    width: 40%;
    text-align: center;
    padding: 10px 8px;
  }

  .store {
    width: 10%;
    text-align: center;
  }

  .unit-price {
    width: 20%;
    text-align: center;
  }

  .service-fee {
    width: 20%;
    text-align: center;
  }

  .freight {
    width: 15%;
    text-align: center;
  }

  .Purchase-QTY {
    width: 15%;
    text-align: center;
  }

  .grand-total {
    width: 100%;
    text-align: center;
  }

  .page-seller-portal .btn.btn-default.btn-pay {
    color: #fff;
    background: #FA6400;
    border-color: #FA6400;
  }

  .table-body-left .table-body-left-item {
    border-bottom: 1px solid rgba(191, 212, 247, 1);
  }

  .table-body-left .table-body-left-item:last-child {
    border-bottom: none;
  }

  .table-list-item {
    margin-bottom: 15px;
    border: 1px solid rgba(191, 212, 247, 1);
  }

  .has-code:hover {
    cursor: pointer;
    color: #3A75DC;
    text-decoration: underline;
  }

  .no-code {
    color: #888;
  }

  .save-back:hover, .save-work:hover {
    cursor: pointer;
    color: #3A75DC;
  }

  .form-wrapper .datetimepicker-range .datetimepicker:last-child {
    margin-left: 0;
  }

  .form-wrapper input[type="checkbox"] {
    width: 15px;
    height: 15px;
    vertical-align: middle;
  }

  .page-seller-portal .btn.btn-default.btn-small {
    font-weight: normal;
    font-size: 12px;
    padding: 4px 10px;
  }

  .page-seller-portal .btn.btn-default.btn-plain {
    color: #333;
  }

  .page-seller-portal .btn.btn-default.btn-plain:hover {
    color: #fff;
  }

  .page-seller-portal .btn.btn-default.btn-small {
    height: auto;
    line-height: inherit;
  }

  .page-seller-portal .btn.btn-default.btn-small:not(.btn-action-disabled):hover {
    border: 1px solid #fa6400 !important;
    background: #fff !important;
    color: #fa6400 !important;
  }

  .form-wrapper .form-group {
    margin-bottom: 13px;
  }

  /*新样式修改*/
  /*  #3325*/
  .form-wrapper .datetimepicker-range .datetimepicker span.icon i {
    font-size: 16px;
    line-height: 36px;
  }

  .form-wrapper input[type=checkbox] {
    position: relative;
    width: 15px;
    height: 15px;
    margin: 0 5px;
    vertical-align: sub;
  }

  .form-wrapper input[type=checkbox]::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 15px;
    height: 15px;
    line-height: 15px;
    text-align: center;
    color: white;
    font-size: 14px;
    background-color: #fff;
    border: 1px solid #aaa;
  }

  .form-wrapper input[type=checkbox]:checked::before {
    border: none;
    content: '\e6ca';
    background-color: #3a75dc;
    font-family: "gcl";
    font-size: 12px;
  }

  .content-con-sub-title {
    color: #aaa;
    font-size: 12px;
  }

  .pagination-flex {
    display: flex;
    justify-content: flex-end;
    align-items: center;
  }

  .pagination-flex .page-list, .pagination-flex .page-info {
    top: 0;
  }

  .grand-total .grand-total-show {
    font-size: 13px;
    text-decoration: line-through;
    color: #888;
  }

  .pic-w-40 {
    width: 40px;
    height: 40px;
  }
  .page-seller-portal .btn.btn-action-disabled {
    color: #333 !important;
  }
  #reorder_add_layer {
    text-align: left;
  }
  .layui-layer-msg .layui-layer-content {word-break: break-word;}

  /*#27606美国invoice*/
  .normal-display-none{
    display: none;
  }
  .normal-display-inline{
    display: inline;
  }
  .normal-display-flex{
    display: flex;
    justify-content: space-between;
  }
  .invoice-btn:hover .normal-color,.generate-btn:hover .normal-color{
    color: #fff;
  }
  .generate-disabled[disabled]{
    background: #EDEFF3;
    opacity:1;
  }
  .generate-disabled .normal-color{
    color: #666;
    font-size: 14px;
  }
  .normal-color{
    color: #666;
  }
  .invoice-line-height{
    vertical-align: top;
    margin-top: 3px;
    line-height: 20px;
    height: 20px;
    display: inline-block;
  }
  .table-select-list{
    margin-bottom: 13px;
    /* height: 20px; */
    line-height: 20px;
    width: 100%;
    align-items: center;
    padding-left: 6px;
  }
  .mr-14{
    margin-right: 14px;
  }
  .table-header-flex-between{
    width: 100%;
    display: flex;
    justify-content: space-between;
  }
  .table-item-checkbox input[type=checkbox]{
    margin: 0 8px 0 0px;
    vertical-align: text-top;
  }
  .page-seller-portal .invoice-special-large{
    padding: 3.5px 10px;
  }
  .page-seller-portal .invoice-special-btn{
    padding: 5px 10px;
  }
  .page-seller-portal .btn .icon-text-larger{
    font-size: 18px;
  }
  .page-seller-portal .btn .invoice-cancel-icon{
    font-size: 16px;
    color: #666;
  }
  .invoice-cancel-btn{
    width: 104px;
    text-align: left;
  }
  .invoice-cancel-btn .invoice-cancel-icon{
    margin-right: 5px;
  } 
  .invoice-cancel-btn:hover .normal-color,.invoice-cancel-btn:hover .invoice-cancel-icon
  {
    color: #fff;
  }
  .tooltip-inner{
    word-break:break-word;
  }
  .invoice-disabled{
    cursor: not-allowed !important;
    opacity: 0.65 !important;
  }
  /*end*/
</style>
<div class="test-container page-seller-portal" id="purchaseOrderList">
  <div class="main-con">
    <div class="filter-wrapper form-wrapper ">
      <form action="#" id="form-search">
        <div class="row">
          <div class="col-sm-3">
            <div class="form-group">
              <label for="input-PurchaseOrderId">Purchase Order ID</label>
              <input type="text" name="filter_PurchaseOrderId" value="{{ filter_PurchaseOrderId }}"
                     class="form-control" placeholder="Order ID" id="input-orderId">
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label for="input-code">Item Code</label>
              <input type="text" name="filter_item_code" value="{{ filter_item_code }}"
                     class="form-control" PLACEHOLDER="Item Code" id="input-code">
            </div>
          </div>
          <div class="col-sm-5">
            <div class="form-group">
              <label for="input-orderStatus">Order Status</label>
              <select {% if is_invoice == 1 %} disabled {% endif %} name="filter_orderStatus" id="input-orderStatus" value="{{ filter_orderStatus }}"
                      class="form-control">
                {% for k,v in order_status %}
                  <option value="{{ k }}"
                    {% if k == filter_orderStatus %}
                      selected
                    {% endif %}
                  >{{ v }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-3">
            <div class="form-group">
              <label for="inputOrderDateFrom">Order Date</label>
              <div class="datetimepicker-range">
                <div class="datetimepicker col-sm-6" style="padding: 0 4px 0 0" id='dataTimePickerForm'>
                  <input type="text" name="filter_orderDate_from" value="" class="form-control" id="inputOrderDateFrom"
                         placeholder="Pick a date..." style="padding-right: 20px" autocomplete="off">
                  <span class="title">From</span>
                  <span class="icon"><i class="giga icon-date-icon"></i></span>
                </div>
                <div class="datetimepicker col-sm-6" style="padding: 0 0 0 4px" id='dataTimePickerTo'>
                  <input type="text" name="filter_orderDate_to" value="" class="form-control" id="inputOrderDateTo"
                         placeholder="Pick a date..." style="padding-right: 20px" autocomplete="off">
                  <span class="title">To</span>
                  <span class="icon"><i class="giga icon-date-icon"></i></span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label for="input-orderStatus">Sales Order Matching</label>
              <select name="filter_associatedOrder" id="input-filter_associatedOrder"
                      value="{{ filter_associatedOrder }}" class="form-control">
                {% for k,v in order_associated %}
                  <option value="{{ k }}"
                    {% if k == filter_associatedOrder %}
                      selected
                    {% endif %}
                  >{{ v }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="col-sm-5" style="height: 70px;padding-top: 35px;text-align: right;">
            <div style="display: flex;justify-content: space-between;align-items: center">
              <div style="display: flex;justify-content: flex-start;align-items: center"><input type="checkbox" style="margin-right: 4px;margin-top: 0" name="filter_include_returns" {% if filter_include_returns == 'on' %}checked{% endif %}>
                <span>Include returns</span>
              </div>
              <div>
                <button type="button" id="filter_btn" class="btn btn-primary" onclick="filter(this)">Filter</button>
                <button class="btn btn-default reset-tip-none" data-toggle="tooltip" onclick="resetUrl(this);return false"
                        title="Reset" type="button" {% if is_invoice == 1 %} disabled {% endif %}>
                  <i class="giga icon-reset3"></i>
                </button>
                <button class="btn btn-default download-tip-none" data-toggle="tooltip" title="Download" {% if is_invoice == 1 %} disabled {% endif %}
                        onclick="downloadPurchaseOrder();return false" type="button">
                  <i class="giga icon-xiazai"></i>
                </button>
                <button class="btn btn-default invoice-btn invoice-special-large" onclick="invoiceFn(this);return false" type="button" data-toggle="tooltip"
                data-trigger="hover"
                 title="Click to select the Purchase Order that you want an invoice for. The invoice can only be generated for Purchase Orders with order date within 180 days and order status of 'Completed'.">
                  <i class="giga icon-fapiao icon-text-larger"></i>
                  &nbsp;<span class="normal-color invoice-line-height">Invoice</span>
                </button>
                <button class="btn generate-disabled  normal-display-none invoice-special-large" disabled>
                  <i class="giga icon-fapiao icon-text-larger"></i>
                  &nbsp;<span class="normal-color invoice-line-height">Generate</span>
                </button>
                <button class="btn btn-default generate-btn normal-display-none invoice-special-large" onclick="generateInvoice();return false" data-toggle="tooltip"
                data-trigger="hover"
                title="Click to generate Invoice.">
                  <i class="giga icon-fapiao icon-text-larger"></i>
                  &nbsp;<span class="normal-color invoice-line-height">Generate</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="table-select-list {% if is_invoice !=1 %} normal-display-none {% else %} normal-display-flex {% endif %}">
      <div>
        <input type="checkbox" class="pointer" id="selectAllValid"  onclick="selectAll(this.checked)" {% if is_all_select == 1%} checked {% endif %}/>
        <span class="text-bold ml-octal1 mr-14">ALL</span>
        <span>Total&nbsp;<span class="text-bold" id="invoiceCount">{{invoice_select_count}}</span>&nbsp;purchase order(s) selected</span>
      </div>
      <div>
        <button class="btn btn-default invoice-cancel-btn invoice-special-btn" onclick="cancelInvoice(this);return false" data-toggle="tooltip" title="Click to go back to non-selection status of orders." data-trigger="hover">
         <i class="giga icon-Group-1 invoice-cancel-icon"></i> 
        <span class="normal-color">Cancel</span>
      </button>
      </div> 
    </div>
    <div class="table-list-title">
      <div style="width: 90%;display: flex">
        <div style="width: 40%;text-align: center">Product Information</div>
        <div style="width: 10%;text-align: center">Seller</div>
        <div style="width: 20%;text-align: center">Unit Price</div>
        {% if is_europe %}
          <div style="width: 20%;text-align: center">Service Fee</div>
        {% endif %}
        <div style="width: 15%;text-align: center">Fulfillment</div>
        <div style="width: 15%;text-align: center">Purchase QTY</div>
      </div>
      <div style="width: 10%">
        <div style="width: 100%;text-align: center">Order Total</div>
      </div>
    </div>
    <div class="table-list-body" id="table-select-list-box">
      {% for purchaseOrder in purchaseOrders %}
        <div class="table-list-item">
          <div class="table-header">
            <div class="table-item-checkbox {% if is_invoice !=1 %} normal-display-none {% else %} normal-display-inline {% endif %}">
              <input type="checkbox" class="pointer" name="selected" onclick="invoiceSelect(this.checked)" {% if purchaseOrder.invoice_is_select ==true %} checked {% endif %} value="{{purchaseOrder.order_id}}"/>
            </div>
            <div class="table-header-flex-between">
              <div class="table-sale-order-id">Order ID : {{ purchaseOrder.order_id }}
                {% if (purchaseOrder.delivery_type==2) %}
                  <i class="giga icon-cwf" style="color: #1f5268;font-size: 15px;" data-toggle="tooltip"
                     data-original-title="{{ cwf }}"></i>
                {% endif %}
              </div>
              <div class="table-order-status to-be-paid">
                {% if purchaseOrder.order_status_id == 0 and purchaseOrder.leftSec>0 %}
                  <div data-id="{{ purchaseOrder.order_id }}" id="timer{{ purchaseOrder.order_id }}"
                       data-min="{{ purchaseOrder.minute }}" data-second="{{ purchaseOrder.second }}"
                       class="count-time count-time-flag" data-toggle="tooltip"
                       title="The order will be cancelled if not paid before the countdown ends."><i
                      style="margin-right: 8px" class="giga icon-Action-Time"></i>
                    <span name="minute">{{ purchaseOrder.minute }}</span>:
                    <span name="second">{{ purchaseOrder.second }}</span>
                  </div>
                {% endif %}
                <span>
                  {% for k,v in order_status %}
                    {% if k == purchaseOrder.order_status_id %}
                      {{ v }}
                    {% endif %}
                  {% endfor %}
                </span>
              </div>
            </div>
          </div>
          <div class="table-body">
            <div class="table-body-top">
              <div class="table-body-left">
                {% for key,lineData in purchaseOrder.lineDatas %}
                  <div class="table-body-left-item flex-align-center{% if key>4 %} no-display{% endif %}">
                    <div class="product-information">
                      <div class="flex-str">
                        <div class="picture" style="position: relative">
                          <img class="pic-w-40" src="{{ lineData.image_show }}" alt="">
                          <div class="big-img"
                               style="width: 150px;height: 150px;position: absolute;z-index: 99;left: 40px">
                            <img style="width: 100%;" src="{{ lineData.image_big }}" alt="">
                          </div>
                        </div>
                        <div>
                          {% if lineData.freight_tag %}
                            <span title="{{ lineData.product_name }}">
                              {{ lineData.name }}
                            </span>
                          {% else %}
                            <a class="order-des" href="{{ lineData.product_link }}" title="{{ lineData.product_name }}">
                              {{ lineData.name }}
                            </a>
                          {% endif %}
                          <p class="prd-tip">
                            {% if lineData.is_rebate %}
                              <a target="_blank" href="{{ lineData.url_rebate }}">
                                <img data-toggle="tooltip" style="padding-left: 1px;position: relative;top: -2px;"
                                     src="{{ rebate_logo }}" data-original-title="{{ lineData.tip_rebate }}">
                              </a>
                            {% endif %}
                            {% if lineData.type_id == 3 %}
                              {% if lineData.contract_id %}
                                {{ global_frontend_futures_second_sign | dprintf({'id':lineData.agreement_id,'s_id':lineData.agreement_no }) }}
                              {% else %}
                                {{ global_frontend_futures_sign | dprintf({'id':lineData.agreement_id,'s_id':lineData.agreement_no }) }}
                              {% endif %}
                            {% endif %}
                            {% if lineData.is_margin %}
                              <a href="{{ lineData.url_margin }}">
                                <span class="flag-margin-order">
                                  <span class="giga icon-margin" data-toggle="tooltip" title="{{ lineData.tip_margin }}"></span>
                                </span>
                              </a>
                            {% endif %}
                            {{ lineData.sku }}
                            {% if lineData.tag %}
                              <span class="tag_icon">
                              {% for tagDetail in lineData.tag %}
                                {{ tagDetail }}
                              {% endfor %}
                              </span>
                            {% endif %}
                            {% if lineData.freight_tag %}
                              <i
                                style="font-size:12px;font-style: normal;display: inline-block;width: 62px;text-align: center; height:20px;line-height:20px;color: #ff6600;background: #ffebde">Fulfillment</i>
                            {% endif %}
                          </p>
                        </div>
                      </div>
                    </div>
                    <div class="store">
                      <a class="store-name" target="_blank" href="{{ lineData.seller_url }}"
                         title=" {{ lineData.screenname }}"> {{ lineData.screenname_simple }}</a>
                      <p>
                        <a href="{{ lineData.seller_email_url }}" target="_blank"><i class="giga icon-mail-unopen"></i></a>
                      </p>
                    </div>
                    <div class="unit-price">
                      <span> {{ lineData.price_show }}</span>
                    </div>
                    {% if is_europe %}
                      <div class="service-fee">
                        <span> {{ lineData.service_fee_show }}</span>
                      </div>
                    {% endif %}
                    <div class="freight">
                      <span> {{ lineData.freight_show }}</span>
                    </div>
                    <div class="Purchase-QTY">
                      <span> {{ lineData.quantity }}</span>
                    </div>
                  </div>
                  {% if key==4 and purchaseOrder.lineDatas|length > 5 %}
                    <div class="show-more">
                      View&nbsp;{{ purchaseOrder.lineDatas|length-5 }}&nbsp;more item(s)&nbsp;<i
                        class="giga icon-arrow-down-outline-white"></i>
                    </div>
                  {% endif %}
                  {% if key==purchaseOrder.lineDatas|length-1 and purchaseOrder.lineDatas|length > 5 %}
                    <div class="pick-up no-display">
                      Minimize&nbsp;<i class="giga icon-sidebar-fold"></i>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              <div class="table-body-right flex-align-center">
                <div class="grand-total">
                  {% if purchaseOrder.discount_grand_total > 0 %}
                    <span>{{ purchaseOrder.final_grand_total_show }}</span><br/>
                    <span class="grand-total-show">{{ purchaseOrder.grand_total_show }}</span>
                  {% else %}
                    <span>{{ purchaseOrder.grand_total_show }}</span>
                  {% endif %}
                </div>
              </div>
            </div>
            <div class="table-body-bottom">
              <div class="table-body-bottom-time">Creation Time: {{ purchaseOrder.date_added }}</div>
              <div class="table-body-bottom-btns">
                {% for k,v in purchaseOrder['lineDatas'][0]['action_btn'] %}
                  {% if v == 'View' %}
                    <a class="btn btn-default btn-small btn-plain go-order-detail"
                       data-toggle="tooltip" title="View"
                       href="{{ detail_url }}{{ purchaseOrder.order_id }}" target="_blank">
                      View</a>
                  {% endif %}
                  {% if v == 'Pay' %}
                    <button class="btn btn-default btn-small btn-pay" data-toggle="tooltip" title="Pay" data-trigger="hover" data-delivery_type="{{ purchaseOrder.delivery_type }}"
                            onclick="payOrder('{{ pay_url }}','{{ purchaseOrder.order_id }}','{{ is_europe }}','{{ purchaseOrder.fee_order_ids }}','{{ purchaseOrder.purchase_run_id }}',this)"
                    >Pay
                    </button>
                  {% endif %}
                  {% if v == 'Cancel' %}
                    <button class="btn btn-default btn-small btn-plain" data-toggle="tooltip" title="Cancel" data-trigger="hover"
                            onclick="cancelConfirm('{{ purchaseOrder.order_id }}','{{ purchaseOrder.fee_order_count }}','{{ purchaseOrder.fee_order_nos }}',this)"
                      {# onclick="window.location.href='{{ detail_url }}{{ purchaseOrder.order_id }}'" #}
                    >Cancel
                    </button>
                  {% endif %}
                  {% if v == 'RMA' and purchaseOrder.delivery_type != 2 and purchaseOrder.rma_show %}
                    <a class="btn btn-default btn-small btn-plain"
                       data-toggle="tooltip" title="RMA"
                       data-trigger="hover"
                       target="_blank"
                       href="{{ url('account/rma_management', {'filter_order_id': purchaseOrder.order_id }) }}"
                    >RMA</a>
                  {% endif %}
                  {% if v == 'Reorder' and purchaseOrder.reorder_show %}
                    {% if purchaseOrder.unsupport_stock %}
                    <button class="btn btn-default btn-small disabled btn-action-disabled" data-toggle="tooltip" 
                            title="This (These) Seller’s products cannot be directly purchased for stock up. You must first upload a sales order and pay for the items, then ship the items immediately.">
                      Reorder
                    </button>
                    {% else %}
                    <button class="btn btn-default btn-small btn-plain" data-toggle="tooltip" title="Reorder" data-trigger="hover"
                            onclick="reorderAdd('{{ purchaseOrder.order_id }}')"
                            data-cnzz-event="purchase order management|PO_AddtoCart"
                    >Reorder
                    </button>
                    {% endif %}
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    {# 分页 #}
    <div class="row mt-2" style="margin-right: 0">
      <div class="col-sm-12 text-right pagination-flex">
        <ul id="bos_pagination"></ul>
      </div>
    </div>
    {# 分页 #}
  </div>
</div>

<script type="text/javascript" src="/catalog/view/javascript/jquery/datetimepicker/bootstrap-datetimepicker.min.js"
        charset="UTF-8"></script>
<script type="text/javascript" src="catalog/view/javascript/bootstrap/js/bootstrap-paginator.min.js"></script>
<script>
  var getAmerica;
  var is_invoice={{ is_invoice | js_var}}  //是否生成invoice
  var last_request_time={{last_request_time | js_var}} //上一次请求接口时间
  var is_first={{is_first | js_var }}  //是否是一次新的选择  0：否   1：是
  var is_all_select={{is_all_select | js_var}} //是否全部选中 0：否  1：是 
  var is_invoice_count={{invoice_select_count| js_var}} //选中总数
  var multipleChoice;
  var invoice_bool=false;
  if(('{{page_receive_select | json_encode}}') !='null'){
    window.sessionStorage.setItem('invoice_receive_select',('{{page_receive_select | json_encode}}'));
  }
  is_invoice == 1 ? null : window.sessionStorage.removeItem('invoice_receive_select');
  $(document).ready(function () {
    // 初始加载时，更改页面的路由
    window.history.pushState({}, 0, '{{ url("account/order#tab_purchase_order") }}');
    let filter_orderDate_from = '{{ filter_orderDate_from }}';
    let filter_orderDate_to = '{{ filter_orderDate_to }}';
    if (filter_orderDate_from) {
      filter_orderDate_from = filter_orderDate_from.substring(0, 10);
      $('#inputOrderDateFrom').val(filter_orderDate_from);
    }
    if (filter_orderDate_to) {
      filter_orderDate_to = filter_orderDate_to.substring(0, 10);
      $('#inputOrderDateTo').val(filter_orderDate_to);
    }
    showMoreClick();
    //#27606 美国invoice
    if($('.nav.nav-tabs.main').find('.active').find('a').attr('data-target') == '#tab_purchase_order'){
      getAmerica=$('.nav.nav-tabs.main').find('.active').find('a').attr('is_america');
      if(getAmerica == 1 && is_invoice !=1){ //美国
        $('.invoice-btn').removeClass('normal-display-none');
        $('.invoice-btn').addClass('normal-display-inline');
      }else{
        $('.invoice-btn').removeClass('normal-display-inline');
        $('.invoice-btn').addClass('normal-display-none');
      }
    }
  });
  var order_url = '{{ order_url }}';
  let timerIDArr = [];
  $(document).ready(function () { 
    $('#inputOrderDateFrom').datetimepicker({
      pickDate: true,
      pickTime: false,
      format: 'YYYY-MM-DD',
    });
    $('#inputOrderDateTo').datetimepicker({
      pickDate: true,
      pickTime: false,
      format: 'YYYY-MM-DD'
    });
   

    pagination()
    //倒计时
    // let timersNum = 10000;//定时器数量小于10000个
    // while(timersNum--) {
    //   clearInterval(timersNum);
    // }
    let countTimeArr = $(".count-time-flag");
    let countTimeInitArr = [];
    countTimeArr.each((i, item) => {
      let min = Number($(item).attr("data-min"));
      let second = Number($(item).attr("data-second"));
      let totalTime = min * 60 + second;
      let currentOrderId = $(item).attr("data-id");
      countTimeInitArr.push({
        "currentOrderId": currentOrderId,
        "totalTime": totalTime
      })
    })
    for (let i = 0; i < countTimeInitArr.length; i++) {
      (function (i) {
        let obj = 'timer' + countTimeInitArr[i].currentOrderId;
        countDown(i, countTimeInitArr[i].totalTime, function (msg) {
          let currentMinutes = msg.split(":")[0];
          let currentSeconds = msg.split(":")[1];
          if (currentMinutes < 10) {
            currentMinutes = "0" + currentMinutes
          }
          if (currentSeconds < 10) {
            currentSeconds = "0" + currentSeconds
          }
          $("#" + obj).find("span[name='minute']").html(currentMinutes);
          $("#" + obj).find("span[name='second']").html(currentSeconds);
          // 倒计时结束pay隐藏
          if (msg == '0:0') {
            $("#" + obj).parent().parent().next().find('.btn-pay').remove();
            $("#" + obj).remove();
          }
          // 倒计时结束pay隐藏
        })
      })(i)
    }
    //倒计时
  });

  function pagination() {
    if ({{ total_pages }}) {
      $('#bos_pagination').bootstrapPaginator({
        /*当前使用的是3版本的bootstrap*/
        bootstrapMajorVersion: 3,
        /*配置的字体大小是小号*/
        size: 'normal',
        /*当前页*/
        currentPage: {{ page }},
        /*一共多少页*/
        totalPages: {{ total_pages }},
        /*页面上最多显示几个含数字的分页按钮*/
        numberOfPages: 5,
        rowsOfPage: {{ page_limit }},
        total: {{ total }},
        onPageClicked: function (event, originalEvent, type, page) {
          clearTimer();
          let url;
          if(getAmerica == 1 && is_invoice == 1){ //#27606 针对美国invoice生成         
            url= order_url + '&' + $.param(getSearchQueryParams()) +getInvoiceParams()+ '&page=' + page;
          }else{
            url = order_url + '&' + $.param(getSearchQueryParams()) + '&page=' + page;
          }
          block.blockUI();
          $('#tab_purchase_order').load(url, function () {
            block.unBlockUI();
            if(getAmerica==1){
              returnFilterHtml(is_invoice_count,is_invoice); 
              if(is_invoice == 1){
                $('#input-orderStatus').val(5);
              }
            }
          });
        }
      });
    }
  }

  function getInvoiceParams(){
    let ret,invoiceCount,selectItemsNone,selectItemsIds,cancelSelectItems,cancelSelectId;
    invoiceCount=Number($('#invoiceCount').html());
    selectItemsNone= $('#table-select-list-box').find('input[name=\'selected\']:not(:checked)');
    selectItemsIds=eachDomHtml(selectItemsNone);

    cancelSelectItems = $('#table-select-list-box').find('input[name=\'selected\']:checked');
    cancelSelectId=eachDomHtml(cancelSelectItems);

    if($('#selectAllValid').prop("checked") || multipleChoice ){
      if(multipleChoice && $('#selectAllValid').prop("checked")){
        ret='&is_invoice='+1+'&last_request_time='+last_request_time+'&is_first='+1+'&is_all_select='+1;
      }else{ 
        let page_receive_select=window.sessionStorage.getItem('invoice_receive_select') || '';
        if(page_receive_select =='' && multipleChoice){  //区分反选
          ret='&is_invoice='+1+'&page_receive_select='+selectItemsIds+'&last_request_time='+last_request_time+'&is_first='+1+'&is_all_select='+0;
        }else{ //正常取消选中
          ret='&is_invoice='+1+'&page_select='+cancelSelectId+'&last_request_time='+last_request_time+'&is_first='+0+'&is_all_select='+0+'&receive_select='+selectItemsIds;     
        }
      }    
    }else{ //取消全选
      if(cancelSelectItems.length>0){//取消全选之后的选择
        let firstTag;
        if(invoiceCount == cancelSelectItems.length){
          firstTag=1;
        }else{  
          firstTag=0;
        }
        ret='&is_invoice='+1+'&page_select='+cancelSelectId+'&last_request_time='+last_request_time+'&is_first='+firstTag+'&is_all_select='+0+'&receive_select='+selectItemsIds;
      }else{ //全部取消
        let firstTag;
        if(invoiceCount == cancelSelectItems.length){
          firstTag=1;
          ret='&is_invoice='+1+'&last_request_time='+last_request_time+'&is_first='+1+'&is_all_select=0';
        }else{  
          firstTag=0;
          ret='&is_invoice='+1+'&page_select='+cancelSelectId+'&last_request_time='+last_request_time+'&is_first='+firstTag+'&is_all_select='+0+'&receive_select='+selectItemsIds;
        }
      }
    }
    return ret
  }

  function eachDomHtml(nodeDom){
    let ids = [];
    let stringIds=''
    nodeDom.each(function (index, item) {
      item = $(item);
      var id = parseInt(item.val());
      !!id && ids.push(id);
      stringIds=ids.join(',');
    });
    return stringIds;
  }

  function getSearchQueryParams() {
    //解决下拉选择设置disabled，序列化对象无效 
    is_invoice == 1 ? $('#input-orderStatus').removeAttr('disabled'): null;
    let form = $('#form-search');
    let s_params = form.serializeArray();
    let ret = {};
    s_params.forEach(function (item) {
      ret[item['name']] = item['value'];
    });

    if (ret.hasOwnProperty('filter_orderDate_from') && ret['filter_orderDate_from']) {
      ret['filter_orderDate_from'] = moment(ret['filter_orderDate_from']).format('YYYY-MM-DD 00:00:00');
    }
    // #5678 针对 filter_orderDate_to 需要做一些处理，后缀新增23:59:59
    if (ret.hasOwnProperty('filter_orderDate_to') && ret['filter_orderDate_to']) {
      ret['filter_orderDate_to'] = moment(ret['filter_orderDate_to']).format('YYYY-MM-DD 23:59:59');
    }
    return ret;
  }

  function cancelConfirm(order_id, feeOrderCount, feeOrderNos, obj) {
    let content = 'Are you sure you want to cancel the order(s)?';
    if (feeOrderCount > 0) {
      content = '<div>Are you sure you want to cancel the order(s)?</div>' +
        '<div class="content-con-sub-title">the following Purchase Order(s) will be canceled.<br>' + feeOrderNos + '</div>'
    }
    var tmplayer = layer.confirm(content, {
      title: 'Confirm',
      skin: 'yzc_layer',
      btn: ['Yes', 'No'], //按钮
      btnAlign: 'c'
    }, function () {
      $.ajax({
        url: '{{ url("account/order/cancelOrder") }}',
        type: 'post',
        data: {order_id: order_id},
        async: false,
        dataType: 'json',
        beforeSend: function () {
          layer.load(1, {shade: [0.3, '#000']});
        },
        success: function (result) {
          layer.closeAll();
          if (result['status']) {
            myToastFn(result['msg'], 'success');
            $('html, body').animate('slow');
            $(obj).parent().parent().parent().parent().find('.count-time').eq(0).remove();
            $(obj).parent().parent().parent().parent().find('.to-be-paid').eq(0).find('span').eq(0).text('Canceled');
            $(obj).prev().remove();
            $(obj).remove();
          } else {
            myToastFn(result['msg'], 'error');
          }
        },
        error: function (xhr, ajaxOptions, thrownError) {
          layer.closeAll();
          layerToast(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        },

      });
    }, function () {
      layer.close(tmplayer);
    });
  }
  {# 倒计时 #}
  function countDown(i, maxtime, fn) {
    let timer = setInterval(function () {
      if (!!maxtime) {
        var day = Math.floor(maxtime / 86400),
          hour = Math.floor((maxtime % 86400) / 3600),
          minutes = Math.floor((maxtime % 3600) / 60),
          seconds = Math.floor(maxtime % 60),
          msg = minutes + ":" + seconds;
        fn(msg);
        --maxtime;
      } else {
        clearInterval(timer);
        // 处理结束
        fn("0:0");
      }
    }, 1000);
    timerIDArr.push(timer);
  }

  function clearTimer() {
    for (let i = 0; i < timerIDArr.length; i++) {
      clearInterval(timerIDArr[i]);
    }
    timerIDArr.splice(0, timerIDArr.length);
  }

  $('#form-search input').keydown(function (e) {
    if (e.keyCode == 13) {
      filter($('#filter_btn'));
    }
  });

  // search
  function filter(item) {
    clearTimer();
    multipleChoice=false; //重置全选状态
    window.sessionStorage.removeItem('invoice_receive_select'); 
    let params = getSearchQueryParams();
    $(item).button('loading');
    block.blockUI();
    if(getAmerica == 1 && is_invoice == 1){ 
      $('#tab_purchase_order').load(order_url + '&' + $.param(params) +'&is_first='+1+ '&page=' + 1+'&is_invoice=1', function () {
        $('#input-orderStatus').val(5);
        initTimePicker(2,$('#inputOrderDateFrom').val(),$('#inputOrderDateTo').val());
        block.unBlockUI();
        $(item).button('reset');
        returnFilterHtml(is_invoice_count,is_invoice);   
      });
    }else{
      $('#tab_purchase_order').load(order_url + '&' + $.param(params), function () {
        block.unBlockUI();
        $(item).button('reset');
      });
    }
    return false;
  }
  {# 倒计时 #}
  //reset
  function resetUrl(item) {
    clearTimer();
    block.blockUI();
    $('#tab_purchase_order').load(order_url, function () {
      block.unBlockUI();
      $(item).button('reset');
    });
    return false;
  }

  // download
  function downloadPurchaseOrder() {
    let excel_url = '{{ url("account/order/purchaseOrderFilterByExcel") }}';
    window.location.href = excel_url + '&' + $.param(getSearchQueryParams());

  }

  function layerToast(message, time = 3000) {
    layer.msg(message, {time: time, skin: ''});
  }

  function reorderAdd(order_id) {
    let data = {order_id: order_id};
    $.ajax({
      url: '{{ url("account/order/reorderAdd") }}',
      type: 'post',
      data: data,
      async: false,
      dataType: 'json',
      beforeSend: function () {
        layer.load(1, {shade: [0.3, '#000']});
      },
      success: function (result) {
        layer.closeAll('loading');
        switch (result.error) {
          case 0:
            myToastFn(result.msg, 'success');
            $('html, body').animate('slow');
            $('#cart').load('{{ url("common/cart/info") }}');
            break;
          case 1:
            myToastFn(result.msg, 'error');
            break;
          case 2:
            layer.msg(result.msg, {area: ['600px'], time: 5000, id:'reorder_add_layer'});
            break;
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        layer.closeAll('loading');
        layerToast(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      },

    });
  }

  // 提示框
  function myToastFn(message, type) {
    $.toast({
      heading: false,
      text: message,
      position: 'top-center',
      showHideTransition: 'fade',
      icon: type,
      hideAfter: 3000,
      allowToastClose: false,
      loader: false
    })
  }

  function payOrder(url, param, is_europe, feeOrderId, purchaseRunId, obj) {
    // if(is_europe){
    let data = {order_id: param, fee_order_id: feeOrderId};
    let delivery_type = $(obj).data('delivery_type')
    if (purchaseRunId > 0) {
      //如果是有费用单，需要去二次支付
      let is_collection_from_domicile = {{ is_collection_from_domicile }};
      if (is_collection_from_domicile) {
        url = "{{ url('sales_order/confirm') }}";
      } else {
        url = "{{ url('account/sales_order/sales_order_management/salesOrderPurchaseOrderManagement') }}";
      }
      url = url + "&run_id=" + purchaseRunId + "&order_id=" + param;
    } else {
      url = url + param + '&is_virtual_pay=0';
    }
    $.ajax({
      url: '{{ url("account/order/judgeSalesOrderStatus") }}',
      type: 'post',
      data: data,
      async: false,
      dataType: 'json',
      beforeSend: function () {
        layer.load(1, {shade: [0.3, '#000']});
      },
      success: function (result) {
        layer.closeAll('loading');
        if (result.error) {
          var tmplayer = layer.confirm('The status of matched sales order has changed, the payment of this purchase order cannot be completed.', {
            title: 'Attention',
            skin: 'yzc_layer',
            btn: ['Cancel This Order'], //按钮
            btnAlign: 'c'
          }, function () {
            $(obj).next().trigger('click');
          }, function () {
            layer.close(tmplayer);
          });
        } else {
          if (delivery_type == 2) {
            url += '&order_source=sale';
          }
          window.open(url, '_blank');
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        layerToast(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
      },

    });
    // }

  }

  function showMoreClick() {
    $('#purchaseOrderList').on('click', '.show-more', function () {
      // 展开更多
      $(this).hide().siblings('.no-display').show().css('display', 'flex');
      $(this).siblings('.pick-up').show();
    }).on('click', '.pick-up', function () {
      // 收起
      $(this).hide().siblings('.no-display').hide();
      $(this).siblings('.show-more').show();
    })
  }

  //#27606 美国invoice
  function invoiceFn(v){
    block.blockUI();
    window.sessionStorage.removeItem('invoice_receive_select')
    $('.reset-tip-none,.download-tip-none').attr('disabled','disabled');
    $(v).tooltip('destroy');
    initTimePicker(1);
    $('#input-orderStatus').val(5);
    let url = order_url + '&' + $.param(getSearchQueryParams())+'&is_first='+1+'&page=1&is_invoice=1';
    $('#tab_purchase_order').load(url,function(){
      block.unBlockUI();
      initTimePicker(1);
      $('.invoice-btn').removeClass('normal-display-inline');
      $('.invoice-btn').addClass('normal-display-none');
      $('.generate-disabled,.table-select-list,.table-item-checkbox').removeClass('normal-display-none');
      $('.generate-disabled').addClass('normal-display-inline');
      $('.table-select-list,.table-item-checkbox').addClass('normal-display-flex');
    });
  }
  function initTimePicker(num,v1,v2){
    var minDate,maxDate,minDefaultDate;
    minDate= moment(new Date()).add(-180, 'days').format('YYYY-MM-DD');
    maxDate=moment(new Date()).add(-1,'days').format('YYYY-MM-DD');
    minDefaultDate=moment(new Date()).add(-7,'days').format('YYYY-MM-DD');
    $('#inputOrderDateFrom').datetimepicker().remove();
    $('#dataTimePickerForm').append(`<input type="text" name="filter_orderDate_from" value="" class="form-control" id="inputOrderDateFrom"
                         placeholder="Pick a date..." style="padding-right: 20px" autocomplete="off">`)
    $('#inputOrderDateTo').datetimepicker().remove();
    $('#dataTimePickerTo').append(`<input type="text" name="filter_orderDate_to" value="" class="form-control" id="inputOrderDateTo"
                         placeholder="Pick a date..." style="padding-right: 20px" autocomplete="off">`)
    if(num ==1){
      $('#inputOrderDateFrom').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD',
        minDate:minDate,
        maxDate:maxDate,
        defaultDate:minDefaultDate
      });
      $('#inputOrderDateTo').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD',
        minDate:minDate,
        maxDate:maxDate,
        defaultDate:maxDate
      });
    }else if(num == 2){
      $('#inputOrderDateFrom').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD',
        minDate:minDate,
        maxDate:maxDate,
        defaultDate:v1,
      });
      $('#inputOrderDateTo').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD',
        minDate:minDate,
        maxDate:maxDate,
        defaultDate:v2,
      });
    }else{ //取消状态
      $('#inputOrderDateFrom').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD',
        defaultDate:v1,
      });
      $('#inputOrderDateTo').datetimepicker({
        pickDate: true,
        pickTime: false,
        format: 'YYYY-MM-DD',
        defaultDate:v2,
      });
    }
  }
  function selectAll(check){
    $('#table-select-list-box').find('input[name*=\'selected\']').prop('checked',check);
    window.sessionStorage.removeItem('invoice_receive_select'); 
    if(check){
      multipleChoice=true;
      var pageCount=Number('{{ total |js_var }}');
      $('#invoiceCount').html(pageCount);
      returnBtnHtml(true);
    }else{
      multipleChoice=false;
      $('#invoiceCount').html(0);
      returnBtnHtml(false);
    }
  }
  function invoiceSelect(check){
    var invoiceCount =Number($('#invoiceCount').html());
    var pageCount=Number('{{ total |js_var }}');
    var selectCount;
    if(check){
      $('#invoiceCount').html(invoiceCount+1);
      selectCount=Number($('#invoiceCount').html());
      if(selectCount == pageCount){
        $("#selectAllValid").prop("checked", true);
      }
      returnBtnHtml(true);
    }else{
      $('#invoiceCount').html(invoiceCount-1);
      $("#selectAllValid").prop("checked", false);
      selectCount=Number($('#invoiceCount').html());
      if(selectCount == 0){returnBtnHtml(false);return}
    }
  }
  function returnFilterHtml(count,invoice_status){
    if(count >0 && invoice_status == 1){
      $('.invoice-btn,.generate-disabled').removeClass('normal-display-inline');
      $('.invoice-btn,.generate-disabled').addClass('normal-display-none');
      $('.invoice-btn').tooltip('destroy');
      $('.generate-btn').removeClass('normal-display-none');
      $('.generate-btn').addClass('normal-display-inline');
    }
    if(count == 0 && invoice_status == 1){  //invoice 之后点击了筛选查询条件
      $('.invoice-btn,.generate-btn').removeClass('normal-display-inline');
      $('.invoice-btn,.generate-btn').addClass('normal-display-none');
      $('.invoice-btn').tooltip('destroy');
      $('.generate-btn').tooltip('destroy');
      $('.generate-disabled').removeClass('normal-display-none');
      $('.generate-disabled').addClass('normal-display-inline');
    }
  }
  function returnBtnHtml(isShow){
    let invoiceCount=Number($('#invoiceCount').html())
    if(isShow&&invoiceCount>0){
      $('.generate-disabled').removeClass('normal-display-inline');
      $('.generate-disabled').addClass('normal-display-none');
      $('.generate-btn').removeClass('normal-display-none');
      $('.generate-btn').addClass('normal-display-inline');
    }else{
      $('.generate-disabled').removeClass('normal-display-none');
      $('.generate-disabled').addClass(' normal-display-inline');
      $('.generate-btn').removeClass('normal-display-inline');
      $('.generate-btn').addClass('normal-display-none');
    }
  }
  function generateInvoice(){
    //勾选总数是否大于5000
    var invoiceCount=Number($('#invoiceCount').html())
    if(invoiceCount>5000){
      var showTip = layer.confirm(
      `A maximum of 5000 purchase orders can be selected.`, {
      title: 'Notice',
      skin: 'oris-layer',
      btn: ['OK',] //按钮
    })
    }else{
      invoice_bool=false;
      var cancel = layer.confirm(
      `Are you sure to generate invoices for the selected Purchase
       Orders? (a separate invoice will be generated for each store)`, {
      title: 'Confirm',
      skin: 'oris-layer invoice-layer',
      btn: ['OK', 'Cancel'] //按钮
    }, function () {
      $('.invoice-layer .layui-layer-btn0').addClass('invoice-disabled');
      //layer.close(cancel);
      if(!invoice_bool){
        invoice_bool=true;
        var url= '{{ url("account/order/createInvoice") }}' + '&' + $.param(getSearchQueryParams()) +getInvoiceParams()+ '&page=' + 1; 
        $.ajax({
          url: url,
          type: 'get',
          async: true,
          dataType: 'json',
          success: function (result) {
            if(result.code == 200){
              //invoiceGenerateFn();
              layer.close(cancel);
              $('.nav.nav-tabs.main li').each(function(item){
                if($(this).find('a').attr('data-target')=='#tab_purchase_invoice'){
                  $(".nav-tabs li:eq('"+item+"')").addClass('active'); //切换至invoice 页面
                  $(".nav-tabs li:eq('"+item+"') a").trigger('click');
                  $('#tab_purchase_invoice').load(`{{ url("account/purchase_order/invoice")}}&page=1`);
                  $('#tab_purchase_order').load(order_url + '&' + $.param(getSearchQueryParams())+'&is_first='+1+'&page=1&is_invoice=0');
                  window.sessionStorage.removeItem('invoice_receive_select');
                }else{
                  $(this).removeClass('active');
                }
              })   
            }else{
              layerToast(result.msg);
              invoice_bool=false;
            }  
            $('.invoice-layer .layui-layer-btn0').removeClass('invoice-disabled');
          }, 
          error: function (xhr, ajaxOptions, thrownError) {
            $('.invoice-layer .layui-layer-btn0').removeClass('invoice-disabled');
            invoice_bool=false;
          },
        });
      }       
    }, function () {
      layer.close(cancel);
      $('.invoice-layer .layui-layer-btn0').removeClass('invoice-disabled');
      invoice_bool=false;
    });
    }
  }
  function invoiceGenerateFn(){
    $.ajax({
      url: '{{ url("account/purchase_order/invoice/generate") }}',
      type: 'get',
      async: true, //开启异步
      dataType: 'json',
      success: function (result) {
        
      },
      error: function (xhr, ajaxOptions, thrownError) {
       
      },
    });
  }
  function cancelInvoice(v){
    block.blockUI();
    multipleChoice=false;
    window.sessionStorage.removeItem('invoice_receive_select'); 
    initTimePicker(3,$('#inputOrderDateFrom').val(),$('#inputOrderDateTo').val());
    $(v).tooltip('destroy'); 
    let url = order_url + '&' + $.param(getSearchQueryParams())+'&is_first='+1+'&page=1&is_invoice=0';
    $('#tab_purchase_order').load(url,function(){
      block.unBlockUI();
    });
  }
</script>

<script src="catalog/view/javascript/jquery/jquery-2.1.1.min.js" type="text/javascript"></script>
<link href="catalog/view/javascript/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen"/>
<script src="catalog/view/javascript/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
{#<link href="catalog/view/javascript/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>#}
{#<link href="catalog/view/theme/yzcTheme/stylesheet/font_demo/iconfont.css" rel="stylesheet" type="text/css"/>#}
{#<link href="catalog/view/theme/yzcTheme/stylesheet/fonts.googleapis.com_open+sans.css" rel="stylesheet" type="text/css"/>#}
<link href="catalog/view/theme/yzcTheme/stylesheet/stylesheet.css?v={{ app_version }}" rel="stylesheet">
{#<link rel="icon" href="data:;base64,=">#}
{#<script type="text/javascript" src="catalog/view/javascript/layui/layui.all.js"></script>#}
<style>
  body{
    min-width: auto !important;
  }
</style>
<form   enctype="multipart/form-data" id="form-upload" >
  <div class="modal-body" >

    <div style="width:96%;margin: 0 auto;float: left;">
      <div style="float: left;width: 100%;margin-left: 2%">
        {% if type == 1 %}
          <span style="font-weight: bold;">Do you confirm to agree this rebate request? The system will recharge
            <span style="color: red">{{ amount_show }}</span> to buyer's line of credit automatically.
          </span>
        {% else %}
          <span style="font-weight: bold;">Do you confirm to decline this rebate request?
          </span>
        {% endif %}
      </div>
      <div style="float: left;width: 100%;">

        <div  id="commit"  style="float: left;width: 100%;text-align:left;margin-left: 2%;padding-top: 10px;">
          <span style="opacity: 0.2;color: #000000;font-weight: bold;float: left;width: 50%;margin-bottom: 10px;">COMMENTS</span>
          <span style="color: red;font-weight: bold;float: right;width: 50%;text-align: right;margin-bottom: 10px;">REQUIRED</span>
          <div class="form-group" style="margin-top: 10px;">
            <textarea name="comments"   style="resize: none;"  id="comments" class="form-control" rows="3" maxlength="2000"   ></textarea>
            <i style="position: relative;top:-20px;float: right;right:10px;opacity: 0.2;"><span class="count-change">0</span>/2000</i>
          </div>



        </div>
      </div>
    </div>

  </div>
  <div style="width:100%;float: right;text-align: center;margin-top: 60px;">
    <div class="page-seller-portal">

      <button type="button" id="submit_button" onclick="checkInputInfo('{{ type }}')"; class="btn btn-primary"  style="margin-right: 10px;" >SUBMIT</button>
      <button type="button" id="edit_button" class="btn btn-default" onclick="cancel_confirm()" style="margin-left: 10px;">CANCEL</button>
    </div>
  </div>
</form>

<script>
  $(function () {
//    $('[data-toggle="tooltip"]').tooltip();
    var text = $('#comments').val();
    var len = text.length;
    $('#comments').next().find('span').html(len);
    $('textarea').keyup(function () {
      var text = $(this).val();
      len = text.length;
      if (len > 2000) {
        return false;
      }
      $(this).next().find('span').html(len);
    })

  });


  function layerMsg(message, time = 2000) {
    parent.layer.msg(message, {time: time, skin: ''});
  }

  
  function checkInputInfo(type) {
    $('#submit_button').attr('disabled','disabled');
    var agreement_id = '{{ agreement_id }}' ;
    var len = $('textarea').val().length;
    if(len == 0){
      parent.layer.msg('Comments can not be left blank', {time: 2000, skin: ''});
      $('#submit_button').attr('disabled',false);
      return false;
    }
    var comments = $('#comments').val();
    var request_id = '{{ request_id }}';
    var param = {
      'comments': comments,
      'type': type,
      'agreement_id': agreement_id,
      'request_id':request_id
    };
    $.ajax({
      url: '{{ seller_action }}',
      dataType: 'json',
      type: 'post',
      data: param,
      beforeSend: function () {
        window.parent.layer.load();
      },
      success: function (json) {
        window.parent.layer.closeAll('loading');
        window.parent.layer.msg(json.msg,{time: 2000, skin: ''});
        if(json['code'] == 1){
          var index = parent.layer.getFrameIndex(window.name);
          parent.layer.close(index);
          window.parent.initRequest();
        }
      }
    });



    
  }
  
  function cancel_confirm() {
    var index = parent.layer.getFrameIndex(window.name);
    parent.layer.close(index);
  }

</script>

<script src="catalog/view/javascript/qrcode.js" type="text/javascript"></script>
<style>
  #wechat_payinfo .wechatLabel {
    color: grey;
    font-size: 15px;
  }

  #wechat_payinfo .wechatContent {
    color: black;
    font-size: 15px;
    margin-left: 0.5em;
  }
</style>
<div class="modal fade" id="wechatPayModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog" style="width: 700px">
    <div id="myForm" class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Please use WeChat to scan the QR code below to finish the payment.</h4>
      </div>
      <div class="modal-body" id="wechatBody" style="height: 250px;">
        <div class="col-sm-8 text-left">
          <div class="form-group" style="margin-top:3em;display: flex">
            <label class="wechatLabel">Total:</label>
            <span class="wechatContent" id="total"></span>
          </div>
          <div class="form-group" style="display: flex">
            <label class="wechatLabel">Current exchange rates:</label>
            <span class="wechatContent" id="rate"></span>
          </div>
          <div class="form-group" style="display: flex">
            <label class="wechatLabel">Amount to pay:</label>
            <span class="wechatContent" id="total_cny"></span>
          </div>
        </div>
        <div class="col-sm-4 text-right">
          <div id="qrcode">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>

  function checkWechatOrderStatus() {
    var loop = true;
    var feeOrderId = {{ fee_order_id }};
    $.ajax({
      url: 'index.php?route=extension/payment/wechat_pay/checkOrder&order_id={{ order_id }}&fee_order_id='+feeOrderId.toString(),
      dataType: 'json',
      success: function (json) {
        if (json['paid']) {
          loop = false;
          location.href = json['success'];
        }
        if (loop) {
          setTimeout("checkWechatOrderStatus()", 5000);
        }
      },
      error: function (xhr, ajaxOptions, thrownError) {
        var tmplayer = layer.alert(thrownError + "<br>" + xhr.statusText + "<br>" + xhr.responseText, {
          title: 'Message',
          btn: 'OK',
          skin: 'yzc_layer' //样式类名
          , closeBtn: 1
        }, function () {
          layer.close(tmplayer);
        });
      }
    });
  }

  //--></script>